

<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>api.js - Backendjs Documentation</title>
    
    <meta name="description" content="A Node.js library to create Web backends with minimal dependencies." />
    
    
    

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>

    
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-start.html">Getting Started</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-start.html#overview">Overview</a></li><li data-type='method' style='display: none;'><a href="tutorial-start.html#installing-backendjs">Installing backendjs</a></li><li data-type='method' style='display: none;'><a href="tutorial-start.html#creating-a-web-server">Creating a Web Server</a></li><li data-type='method' style='display: none;'><a href="tutorial-start.html#creating-a-module">Creating a module</a></li><li data-type='method' style='display: none;'><a href="tutorial-start.html#next-steps">Next steps</a></li></ul></li><li><a href="tutorial-modules.html">Modules</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-modules.html#npm-packages-as-modules">NPM packages as modules</a></li><li data-type='method' style='display: none;'><a href="tutorial-modules.html#message-passing">Message passing</a></li><li data-type='method' style='display: none;'><a href="tutorial-modules.html#default-methods">Default methods</a></li></ul></li><li><a href="tutorial-reference.html">Reference</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-reference.html#dependencies">Dependencies</a></li><li data-type='method' style='display: none;'><a href="tutorial-reference.html#configuration">Configuration</a></li><li data-type='method' style='display: none;'><a href="tutorial-reference.html#config-sources">Config sources</a></li><li data-type='method' style='display: none;'><a href="tutorial-reference.html#environment-variables">Environment variables</a></li><li data-type='method' style='display: none;'><a href="tutorial-reference.html#backend-library-development-mac-os-x-developers">Backend library development (Mac OS X, developers)</a></li></ul></li><li><a href="tutorial-config.html">Config parameters</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-config.html#api">api</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.access">api.access</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.acl">api.acl</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.csrf">api.csrf</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.files">api.files</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.images">api.images</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.passkey">api.passkey</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.redirect">api.redirect</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.routing">api.routing</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.session">api.session</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.signature">api.signature</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.static">api.static</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.users">api.users</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#api.ws">api.ws</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#app">app</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#aws">aws</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#cache">cache</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#db">db</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#events">events</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#ipc">ipc</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#jobs">jobs</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#logwatcher">logwatcher</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#push">push</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#queue">queue</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#sendmail">sendmail</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#sql">sql</a></li><li data-type='method' style='display: none;'><a href="tutorial-config.html#stats">stats</a></li></ul></li><li><a href="tutorial-bkjs.html">The bkjs tool</a><ul class='members'><li data-type='method' style='display: none;'><a href="tutorial-bkjs.html#environment">Environment</a></li><li data-type='method' style='display: none;'><a href="tutorial-bkjs.html#functions">Functions</a></li><li data-type='method' style='display: none;'><a href="tutorial-bkjs.html#extending-bkjs-tool">Extending bkjs tool</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-api.html">api</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api.html#.checkProxy">checkProxy</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.checkRateLimits">checkRateLimits</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.checkRedirectPlaceholders">checkRedirectPlaceholders</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.cleanupHeaders">cleanupHeaders</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.cleanupResult">cleanupResult</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.createWebServer">createWebServer</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getResultPage">getResultPage</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getTokenSecret">getTokenSecret</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.handleBody">handleBody</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.handleCleanup">handleCleanup</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.handleMetrics">handleMetrics</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.handleMultipart">handleMultipart</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.init">init</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.prepareOptions">prepareOptions</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.prepareRequest">prepareRequest</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.registerPreHeaders">registerPreHeaders</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.registerRateLimits">registerRateLimits</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.replacePath">replacePath</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendFile">sendFile</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendFormatted">sendFormatted</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendJSON">sendJSON</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendReply">sendReply</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendStatus">sendStatus</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.shutdown">shutdown</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.startMetrics">startMetrics</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.toParams">toParams</a></li></ul></li><li><a href="module-api_access.html">api/access</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_access.html#.allow">allow</a></li><li data-type='method' style='display: none;'><a href="module-api_access.html#.authenticate">authenticate</a></li><li data-type='method' style='display: none;'><a href="module-api_access.html#.authorize">authorize</a></li><li data-type='method' style='display: none;'><a href="module-api_access.html#.configureMiddleware">configureMiddleware</a></li><li data-type='method' style='display: none;'><a href="module-api_access.html#.middleware">middleware</a></li><li data-type='method' style='display: none;'><a href="module-api_access.html#.setUser">setUser</a></li></ul></li><li><a href="module-api_acl.html">api/acl</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_acl.html#.isAllowed">isAllowed</a></li><li data-type='method' style='display: none;'><a href="module-api_acl.html#.isAnonymous">isAnonymous</a></li><li data-type='method' style='display: none;'><a href="module-api_acl.html#.isAuthenticated">isAuthenticated</a></li><li data-type='method' style='display: none;'><a href="module-api_acl.html#.isDenied">isDenied</a></li><li data-type='method' style='display: none;'><a href="module-api_acl.html#.isMatched">isMatched</a></li><li data-type='method' style='display: none;'><a href="module-api_acl.html#.isPublic">isPublic</a></li><li data-type='method' style='display: none;'><a href="module-api_acl.html#.reset">reset</a></li></ul></li><li><a href="module-api_csrf.html">api/csrf</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_csrf.html#.checkToken">checkToken</a></li><li data-type='method' style='display: none;'><a href="module-api_csrf.html#.clearToken">clearToken</a></li><li data-type='method' style='display: none;'><a href="module-api_csrf.html#.getToken">getToken</a></li><li data-type='method' style='display: none;'><a href="module-api_csrf.html#.verifyToken">verifyToken</a></li></ul></li><li><a href="module-api_files.html">api/files</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_files.html#.copy">copy</a></li><li data-type='method' style='display: none;'><a href="module-api_files.html#.del">del</a></li><li data-type='method' style='display: none;'><a href="module-api_files.html#.detect">detect</a></li><li data-type='method' style='display: none;'><a href="module-api_files.html#.detectStore">detectStore</a></li><li data-type='method' style='display: none;'><a href="module-api_files.html#.getUrl">getUrl</a></li><li data-type='method' style='display: none;'><a href="module-api_files.html#.list">list</a></li><li data-type='method' style='display: none;'><a href="module-api_files.html#.put">put</a></li><li data-type='method' style='display: none;'><a href="module-api_files.html#.read">read</a></li><li data-type='method' style='display: none;'><a href="module-api_files.html#.send">send</a></li><li data-type='method' style='display: none;'><a href="module-api_files.html#.store">store</a></li></ul></li><li><a href="module-api_hooks.html">api/hooks</a></li><li><a href="module-api_images.html">api/images</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_images.html#.createAvatar">createAvatar</a></li><li data-type='method' style='display: none;'><a href="module-api_images.html#.createText">createText</a></li><li data-type='method' style='display: none;'><a href="module-api_images.html#.del">del</a></li><li data-type='method' style='display: none;'><a href="module-api_images.html#.getPath">getPath</a></li><li data-type='method' style='display: none;'><a href="module-api_images.html#.getUrl">getUrl</a></li><li data-type='method' style='display: none;'><a href="module-api_images.html#.isImage">isImage</a></li><li data-type='method' style='display: none;'><a href="module-api_images.html#.put">put</a></li><li data-type='method' style='display: none;'><a href="module-api_images.html#.save">save</a></li><li data-type='method' style='display: none;'><a href="module-api_images.html#.scale">scale</a></li><li data-type='method' style='display: none;'><a href="module-api_images.html#.send">send</a></li><li data-type='method' style='display: none;'><a href="module-api_images.html#.toPadding">toPadding</a></li></ul></li><li><a href="module-api_passkey.html">api/passkey</a></li><li><a href="module-api_redirect.html">api/redirect</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_redirect.html#.check">check</a></li></ul></li><li><a href="module-api_routing.html">api/routing</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_routing.html#.check">check</a></li></ul></li><li><a href="module-api_session.html">api/session</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_session.html#.check">check</a></li><li data-type='method' style='display: none;'><a href="module-api_session.html#.clear">clear</a></li><li data-type='method' style='display: none;'><a href="module-api_session.html#.create">create</a></li><li data-type='method' style='display: none;'><a href="module-api_session.html#.getCookie">getCookie</a></li><li data-type='method' style='display: none;'><a href="module-api_session.html#.makeCookie">makeCookie</a></li><li data-type='method' style='display: none;'><a href="module-api_session.html#.save">save</a></li><li data-type='method' style='display: none;'><a href="module-api_session.html#.setCookie">setCookie</a></li><li data-type='method' style='display: none;'><a href="module-api_session.html#.setup">setup</a></li></ul></li><li><a href="module-api_signature.html">api/signature</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_signature.html#.create">create</a></li><li data-type='method' style='display: none;'><a href="module-api_signature.html#.fromRequest">fromRequest</a></li><li data-type='method' style='display: none;'><a href="module-api_signature.html#.get">get</a></li><li data-type='method' style='display: none;'><a href="module-api_signature.html#.verify">verify</a></li></ul></li><li><a href="module-api_static.html">api/static</a></li><li><a href="module-api_users.html">api/users</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_users.html#.aadd">aadd</a></li><li data-type='method' style='display: none;'><a href="module-api_users.html#.add">add</a></li><li data-type='method' style='display: none;'><a href="module-api_users.html#.adel">adel</a></li><li data-type='method' style='display: none;'><a href="module-api_users.html#.aget">aget</a></li><li data-type='method' style='display: none;'><a href="module-api_users.html#.aupdate">aupdate</a></li><li data-type='method' style='display: none;'><a href="module-api_users.html#.auth">auth</a></li><li data-type='method' style='display: none;'><a href="module-api_users.html#.del">del</a></li><li data-type='method' style='display: none;'><a href="module-api_users.html#.get">get</a></li><li data-type='method' style='display: none;'><a href="module-api_users.html#.login">login</a></li><li data-type='method' style='display: none;'><a href="module-api_users.html#.logout">logout</a></li><li data-type='method' style='display: none;'><a href="module-api_users.html#.update">update</a></li></ul></li><li><a href="module-api_ws.html">api/ws</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api_ws.html#.broadcast">broadcast</a></li><li data-type='method' style='display: none;'><a href="module-api_ws.html#.notify">notify</a></li></ul></li><li><a href="module-app.html">app</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-app.html#.addModule">addModule</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.ainit">ainit</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.arunMethods">arunMethods</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.checkConfig">checkConfig</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.createRepl">createRepl</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.describeArgs">describeArgs</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.init">init</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.isOk">isOk</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.killBackend">killBackend</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.loadModules">loadModules</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.loadPackages">loadPackages</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.mime">mime</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.origin">origin</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.parseArgs">parseArgs</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.parseConfig">parseConfig</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.processArg">processArg</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.processArgs">processArgs</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.processEnvArgs">processEnvArgs</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.runMethod">runMethod</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.runMethods">runMethods</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.setHome">setHome</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.setHost">setHost</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.setLogInspect">setLogInspect</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.setRole">setRole</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.sortModules">sortModules</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.start">start</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.startRepl">startRepl</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.stop">stop</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.watchTmp">watchTmp</a></li></ul></li><li><a href="module-aws.html">aws</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwGetMetricData">aws.cwGetMetricData</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwListMetrics">aws.cwListMetrics</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwPutLogEvents">aws.cwPutLogEvents</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwPutMetricAlarm">aws.cwPutMetricAlarm</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwPutMetricData">aws.cwPutMetricData</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwlFilterLogEvents">aws.cwlFilterLogEvents</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbBatchGetItem">aws.ddbBatchGetItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbBatchWriteItem">aws.ddbBatchWriteItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbCreateTable">aws.ddbCreateTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbDeleteItem">aws.ddbDeleteItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbDeleteTable">aws.ddbDeleteTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbDescribeTable">aws.ddbDescribeTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbDescribeTimeToLive">aws.ddbDescribeTimeToLive</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbGetItem">aws.ddbGetItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbListTables">aws.ddbListTables</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbPutItem">aws.ddbPutItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbQueryTable">aws.ddbQueryTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbScanTable">aws.ddbScanTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbTransactWriteItems">aws.ddbTransactWriteItems</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbUpdateItem">aws.ddbUpdateItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbUpdateTable">aws.ddbUpdateTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbUpdateTimeToLive">aws.ddbUpdateTimeToLive</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbWaitForTable">aws.ddbWaitForTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ec2AssociateAddress">aws.ec2AssociateAddress</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ec2AttachNetworkInterface">aws.ec2AttachNetworkInterface</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ec2CreateImage">aws.ec2CreateImage</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ec2CreateTags">aws.ec2CreateTags</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ec2DeregisterImage">aws.ec2DeregisterImage</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ec2DescribeInstances">aws.ec2DescribeInstances</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ec2DescribeSubnets">aws.ec2DescribeSubnets</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ec2RunInstances">aws.ec2RunInstances</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ec2WaitForInstance">aws.ec2WaitForInstance</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.elb2DeregisterInstances">aws.elb2DeregisterInstances</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.elb2RegisterInstances">aws.elb2RegisterInstances</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.fromDynamoDB">aws.fromDynamoDB</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryACM">aws.queryACM</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryAS">aws.queryAS</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryCFN">aws.queryCFN</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryCW">aws.queryCW</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryCWL">aws.queryCWL</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryComprehend">aws.queryComprehend</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryDDB">aws.queryDDB</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryEC2">aws.queryEC2</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryECR">aws.queryECR</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryELB2">aws.queryELB2</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryElastiCache">aws.queryElastiCache</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryEvents">aws.queryEvents</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryIAM">aws.queryIAM</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryRekognition">aws.queryRekognition</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryS3">aws.queryS3</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.querySNS">aws.querySNS</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.querySSM">aws.querySSM</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.querySTS">aws.querySTS</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.querySecrets">aws.querySecrets</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryTranscribe">aws.queryTranscribe</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.s3CopyFile">aws.s3CopyFile</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.s3GetFile">aws.s3GetFile</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.s3List">aws.s3List</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.s3ParseUrl">aws.s3ParseUrl</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.s3Proxy">aws.s3Proxy</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.s3PutFile">aws.s3PutFile</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.signS3">aws.signS3</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsConfirmSubscription">aws.snsConfirmSubscription</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsCreatePlatformEndpoint">aws.snsCreatePlatformEndpoint</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsCreateTopic">aws.snsCreateTopic</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsDeleteEndpoint">aws.snsDeleteEndpoint</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsDeleteTopic">aws.snsDeleteTopic</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsListTopics">aws.snsListTopics</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsPublish">aws.snsPublish</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsSetEndpointAttributes">aws.snsSetEndpointAttributes</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsSetSubscriptionAttributes">aws.snsSetSubscriptionAttributes</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsSetTopicAttributes">aws.snsSetTopicAttributes</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsSubscribe">aws.snsSubscribe</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.snsUnsubscribe">aws.snsUnsubscribe</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ssmSendCommand">aws.ssmSendCommand</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ssmWaitForCommand">aws.ssmWaitForCommand</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.toDynamoDB">aws.toDynamoDB</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.batchGetSecrets">batchGetSecrets</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.configureJob">configureJob</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.detectLabels">detectLabels</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.ecsDescribeTasks">ecsDescribeTasks</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.ecsPrepareTask">ecsPrepareTask</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.ecsRunTask">ecsRunTask</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.ecsTaskProtection">ecsTaskProtection</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.getInstanceCredentials">getInstanceCredentials</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.getInstanceDetails">getInstanceDetails</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.getInstanceInfo">getInstanceInfo</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.getInstanceMeta">getInstanceMeta</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.getInstanceMetaToken">getInstanceMetaToken</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.getSecretValue">getSecretValue</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.getTaskDetails">getTaskDetails</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.listCertificates">listCertificates</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.parseXMLResponse">parseXMLResponse</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.queryAWS">queryAWS</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.queryECS">queryECS</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.queryEndpoint">queryEndpoint</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.queryRoute53">queryRoute53</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.queryRoute53Domains">queryRoute53Domains</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.querySES">querySES</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.querySQS">querySQS</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.queryService">queryService</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.querySign">querySign</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.readConfig">readConfig</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.readCredentials">readCredentials</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.route53Change">route53Change</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.route53Create">route53Create</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.route53Get">route53Get</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.route53List">route53List</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.sesSendEmail">sesSendEmail</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.sesSendRawEmail">sesSendRawEmail</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.sesSendRawEmail2">sesSendRawEmail2</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.sqsReceiveMessage">sqsReceiveMessage</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.sqsSendMessage">sqsSendMessage</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.stsAssumeRole">stsAssumeRole</a></li></ul></li><li><a href="module-cache.html">cache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-cache.html#.aclear">aclear</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.adel">adel</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.aget">aget</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.aincr">aincr</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.alock">alock</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.aput">aput</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.astats">astats</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.aunlock">aunlock</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.checkConfig">checkConfig</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.checkLimiter">checkLimiter</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.clear">clear</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.createClient">createClient</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.del">del</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.get">get</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.getClient">getClient</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.incr">incr</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.initClients">initClients</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.limiter">limiter</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.localLimiter">localLimiter</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.lock">lock</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.put">put</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.shutdown">shutdown</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.stats">stats</a></li><li data-type='method' style='display: none;'><a href="module-cache.html#.unlock">unlock</a></li></ul></li><li><a href="module-db.html">db</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-db.html#.aadd">aadd</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.abatch">abatch</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.abulk">abulk</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.acopy">acopy</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.acreate">acreate</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.add">add</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.adel">adel</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.adelAll">adelAll</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.adrop">adrop</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aget">aget</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aincr">aincr</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.alist">alist</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.applyPoolOptions">applyPoolOptions</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aput">aput</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aquery">aquery</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.ascan">ascan</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.asearch">asearch</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aselect">aselect</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.asql">asql</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.atransaction">atransaction</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aupdate">aupdate</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aupdateAll">aupdateAll</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aupgrade">aupgrade</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.batch">batch</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.bulk">bulk</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.cacheColumns">cacheColumns</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.checkCapacity">checkCapacity</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.configTypes">configTypes</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.configureCollectStats">configureCollectStats</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.convertError">convertError</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.convertRows">convertRows</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.copy">copy</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.create">create</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.createTables">createTables</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.del">del</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.delAll">delAll</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.describeTables">describeTables</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.drop">drop</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.existsPool">existsPool</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.get">get</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getCached">getCached</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getCapacity">getCapacity</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getIndexes">getIndexes</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getKeys">getKeys</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getPool">getPool</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getPoolTables">getPoolTables</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getPools">getPools</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getProcessRows">getProcessRows</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getQueryForKeys">getQueryForKeys</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.incr">incr</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.init">init</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.initColumns">initColumns</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.initConfig">initConfig</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.initTables">initTables</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.list">list</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.parseNameOp">parseNameOp</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.prepare">prepare</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.prepareColumn">prepareColumn</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.prepareQuery">prepareQuery</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.prepareValue">prepareValue</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.put">put</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.query">query</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.queryProcessSync">queryProcessSync</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.refreshColumns">refreshColumns</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.runProcessRows">runProcessRows</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.scan">scan</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.search">search</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.select">select</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.setConfig">setConfig</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.setProcessColumns">setProcessColumns</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.setProcessRow">setProcessRow</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sql">sql</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.transaction">transaction</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.update">update</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.updateAll">updateAll</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.upgrade">upgrade</a></li></ul></li><li><a href="module-events.html">events</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-events.html#.putEvent">putEvent</a></li></ul></li><li><a href="module-ipc.html">ipc</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-ipc.html#.broadcast">broadcast</a></li><li data-type='method' style='display: none;'><a href="module-ipc.html#.emitMsg">emitMsg</a></li><li data-type='method' style='display: none;'><a href="module-ipc.html#.initServer">initServer</a></li><li data-type='method' style='display: none;'><a href="module-ipc.html#.initWorker">initWorker</a></li><li data-type='method' style='display: none;'><a href="module-ipc.html#.newMsg">newMsg</a></li><li data-type='method' style='display: none;'><a href="module-ipc.html#.sendMsg">sendMsg</a></li></ul></li><li><a href="module-jobs.html">jobs</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-jobs.html#.cancelJob">cancelJob</a></li><li data-type='method' style='display: none;'><a href="module-jobs.html#.isCancelled">isCancelled</a></li><li data-type='method' style='display: none;'><a href="module-jobs.html#.loadCronjobs">loadCronjobs</a></li><li data-type='method' style='display: none;'><a href="module-jobs.html#.markCancelled">markCancelled</a></li><li data-type='method' style='display: none;'><a href="module-jobs.html#.scheduleCronjob">scheduleCronjob</a></li><li data-type='method' style='display: none;'><a href="module-jobs.html#.scheduleCronjobs">scheduleCronjobs</a></li><li data-type='method' style='display: none;'><a href="module-jobs.html#.submitJob">submitJob</a></li></ul></li><li><a href="module-lib.html">lib</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-lib.html#.AhoCorasick">AhoCorasick</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.__">__</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.aexecProcess">aexecProcess</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.afetch">afetch</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.afindProcess">afindProcess</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.areadFile">areadFile</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.areadFile">areadFile</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.arrayEqual">arrayEqual</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.arrayFlatten">arrayFlatten</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.arrayLength">arrayLength</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.arrayRemove">arrayRemove</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.arrayUnique">arrayUnique</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.aspawnProcess">aspawnProcess</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.autoType">autoType</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.base64ToJson">base64ToJson</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.call">call</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.cidrRange">cidrRange</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.clock">clock</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.configParse">configParse</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.copyFile">copyFile</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.cpuStats">cpuStats</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.daysInMonth">daysInMonth</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.decodeURIComponent">decodeURIComponent</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.decrypt">decrypt</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.deferCallback">deferCallback</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.deferInterval">deferInterval</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.deferShutdown">deferShutdown</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.doWhilst">doWhilst</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.domainName">domainName</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.dropPrivileges">dropPrivileges</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.encodeURIComponent">encodeURIComponent</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.encrypt">encrypt</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.entityToText">entityToText</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.escapeUnicode">escapeUnicode</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.everyParallel">everyParallel</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.everySeries">everySeries</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.execProcess">execProcess</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.fetch">fetch</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.findFile">findFile</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.findFileFilter">findFileFilter</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.findFileSync">findFileSync</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.findProcess">findProcess</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.findWords">findWords</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.forEach">forEach</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.forEachItem">forEachItem</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.forEachLimit">forEachLimit</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.forEachLine">forEachLine</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.forEachLineSync">forEachLineSync</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.forEachSeries">forEachSeries</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.forEvery">forEvery</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.forEveryLimit">forEveryLimit</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.forEverySeries">forEverySeries</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.fromBase32">fromBase32</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.fromBase62">fromBase62</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.fromBase64url">fromBase64url</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.gcStats">gcStats</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.getArg">getArg</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.getArgInt">getArgInt</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.getHashid">getHashid</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.getWorkers">getWorkers</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.getuid">getuid</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.hash">hash</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.heapStats">heapStats</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.inCidr">inCidr</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.int2ip">int2ip</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.ip2int">ip2int</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isArg">isArg</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isArray">isArray</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isDST">isDST</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isDate">isDate</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isEmpty">isEmpty</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isFlag">isFlag</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isFunc">isFunc</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isMatched">isMatched</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isNumber">isNumber</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isNumeric">isNumeric</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isObject">isObject</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isPositive">isPositive</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isPrefix">isPrefix</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isSimilar">isSimilar</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isString">isString</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isTimeRange">isTimeRange</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isTrue">isTrue</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isUnicode">isUnicode</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isUuid">isUuid</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isValidBool">isValidBool</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isValidNum">isValidNum</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isValidPositive">isValidPositive</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isValidVersion">isValidVersion</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isWord">isWord</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.jsonFormat">jsonFormat</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.jsonFormatPreset">jsonFormatPreset</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.jsonParse">jsonParse</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.jsonToBase64">jsonToBase64</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.killWorkers">killWorkers</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.loadLocale">loadLocale</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.localEpoch">localEpoch</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.log">log</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.makePath">makePath</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.makePathSync">makePathSync</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.matchAllRegexp">matchAllRegexp</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.matchRegexp">matchRegexp</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.memoryStats">memoryStats</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.moveFile">moveFile</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.murmurHash3">murmurHash3</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.networkInterfaces">networkInterfaces</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.networkStats">networkStats</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.newError">newError</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.normalize">normalize</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.notifyWorkers">notifyWorkers</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.now">now</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objClone">objClone</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objDescr">objDescr</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objExtend">objExtend</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objFlatten">objFlatten</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objGet">objGet</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objIncr">objIncr</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objKeys">objKeys</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objMerge">objMerge</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objMult">objMult</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objSearch">objSearch</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objSet">objSet</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.objSize">objSize</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.parallel">parallel</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.parseCookies">parseCookies</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.parseTime">parseTime</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.phraseSplit">phraseSplit</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.random">random</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.randomBytes">randomBytes</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.randomFloat">randomFloat</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.randomInt">randomInt</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.randomNum">randomNum</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.randomShort">randomShort</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.randomUInt">randomUInt</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.randomUShort">randomUShort</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.readFile">readFile</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.readFileSync">readFileSync</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.replaceRegexp">replaceRegexp</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.runCallback">runCallback</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.series">series</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.sfuuid">sfuuid</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.shuffle">shuffle</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.sign">sign</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.sleep">sleep</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.slug">slug</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.sortByVersion">sortByVersion</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.spawnProcess">spawnProcess</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.spawnSeries">spawnSeries</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.split">split</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.sprintf">sprintf</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.statSync">statSync</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.strCompress">strCompress</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.strDecompress">strDecompress</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.strTrim">strTrim</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.strWrap">strWrap</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.strftimeMap">strftimeMap</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.stringify">stringify</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.suuid">suuid</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.testRegexp">testRegexp</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.testRegexpObj">testRegexpObj</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.textToEntity">textToEntity</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.textToXml">textToXml</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.timingSafeEqual">timingSafeEqual</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toBase32">toBase32</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toBase62">toBase62</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toBase64url">toBase64url</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toBool">toBool</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toCamel">toCamel</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toDate">toDate</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toDigits">toDigits</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toDuration">toDuration</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toEmail">toEmail</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toFlags">toFlags</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toFormat">toFormat</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toMap">toMap</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toMilliseconds">toMilliseconds</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toMtime">toMtime</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toNumber">toNumber</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toParams">toParams</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toPrice">toPrice</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toRFC3339">toRFC3339</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toRegexp">toRegexp</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toRegexpMap">toRegexpMap</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toRegexpObj">toRegexpObj</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toSize">toSize</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toSkip32">toSkip32</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toString">toString</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toTemplate">toTemplate</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toTitle">toTitle</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toUncamel">toUncamel</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toUrl">toUrl</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toValue">toValue</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toVersion">toVersion</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.totp">totp</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.traceError">traceError</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.tryCall">tryCall</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.tryCatch">tryCatch</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.tryLater">tryLater</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.tryRequire">tryRequire</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.typeName">typeName</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.tzName">tzName</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.unescape">unescape</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.unicode2Ascii">unicode2Ascii</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.unlink">unlink</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.unlinkPath">unlinkPath</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.unlinkPathSync">unlinkPathSync</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.unlinkSync">unlinkSync</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.uuid">uuid</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.watchFiles">watchFiles</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.weekDate">weekDate</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.weekOfYear">weekOfYear</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.whilst">whilst</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.writeLines">writeLines</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.xmlParse">xmlParse</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.zeropad">zeropad</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#~onDeferCallback">onDeferCallback</a></li></ul><ul class='typedefs'><li data-type='typedef' style='display: none;'><a href="module-lib.html#.ParamsOptions">ParamsOptions</a></li></ul></li><li><a href="module-lib_JWT.html">lib/JWT</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-lib_JWT.html#.importPrivateKey">importPrivateKey</a></li><li data-type='method' style='display: none;'><a href="module-lib_JWT.html#.importPublicKey">importPublicKey</a></li><li data-type='method' style='display: none;'><a href="module-lib_JWT.html#.sign">sign</a></li><li data-type='method' style='display: none;'><a href="module-lib_JWT.html#.verify">verify</a></li></ul></li><li><a href="module-lib_respawn.html">lib/respawn</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-lib_respawn.html#.check">check</a></li></ul></li><li><a href="module-logger.html">logger</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-logger.html#.debug">debug</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.dev">dev</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.error">error</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.info">info</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.log">log</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.logger">logger</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.none">none</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.prefix">prefix</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.registerLevel">registerLevel</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.setDebugFilter">setDebugFilter</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.setFile">setFile</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.setLevel">setLevel</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.setSyslog">setSyslog</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.trace">trace</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.warn">warn</a></li></ul></li><li><a href="module-logwatcher.html">logwatcher</a></li><li><a href="module-metrics.html">metrics</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-metrics.html#.incr">incr</a></li><li data-type='method' style='display: none;'><a href="module-metrics.html#.take">take</a></li><li data-type='method' style='display: none;'><a href="module-metrics.html#.toJSON">toJSON</a></li></ul></li><li><a href="module-modules.html">modules</a></li><li><a href="module-push.html">push</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-push.html#.configureModule">configureModule</a></li><li data-type='method' style='display: none;'><a href="module-push.html#.init">init</a></li><li data-type='method' style='display: none;'><a href="module-push.html#.parseDevice">parseDevice</a></li><li data-type='method' style='display: none;'><a href="module-push.html#.send">send</a></li><li data-type='method' style='display: none;'><a href="module-push.html#.shutdown">shutdown</a></li></ul></li><li><a href="module-queue.html">queue</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-queue.html#.apublish">apublish</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.asubmit">asubmit</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.checkConfig">checkConfig</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.createClient">createClient</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.drop">drop</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.getClient">getClient</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.initClients">initClients</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.listen">listen</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.monitor">monitor</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.publish">publish</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.shutdown">shutdown</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.stats">stats</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.submit">submit</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.subscribe">subscribe</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.unlisten">unlisten</a></li><li data-type='method' style='display: none;'><a href="module-queue.html#.unsubscribe">unsubscribe</a></li></ul></li><li><a href="module-sendmail.html">sendmail</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-sendmail.html#.send">send</a></li></ul></li><li><a href="module-shell.html">shell</a></li><li><a href="module-sql.html">sql</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-sql.html#.column">column</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.create">create</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.delete">delete</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.drop">drop</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.expr">expr</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.get">get</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.insert">insert</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.limit">limit</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.quote">quote</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.select">select</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.time">time</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.update">update</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.updateExpr">updateExpr</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.upgrade">upgrade</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.value">value</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.valueIn">valueIn</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.where">where</a></li><li data-type='method' style='display: none;'><a href="module-sql.html#.where">where</a></li></ul></li><li><a href="module-stats.html">stats</a></li><li><a href="module-watcher.html">watcher</a></li></ul><h3>Classes</h3><ul><li><a href="Counter.html">Counter</a></li><li><a href="DbPool.html">DbPool</a><ul class='methods'><li data-type='method' style='display: none;'><a href="DbPool.html#aquery">aquery</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#cacheColumns">cacheColumns</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#cacheIndexes">cacheIndexes</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#closeDb">closeDb</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#configure">configure</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#convertError">convertError</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#exists">exists</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#nextToken">nextToken</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#openDb">openDb</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#prepare">prepare</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#prepareOptions">prepareOptions</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#prepareQuery">prepareQuery</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#query">query</a></li><li data-type='method' style='display: none;'><a href="DbPool.html#shutdown">shutdown</a></li></ul></li><li><a href="DbRequest.html">DbRequest</a><ul class='methods'><li data-type='method' style='display: none;'><a href="DbRequest.html#column">column</a></li></ul></li><li><a href="DynamoDBPool.html">DynamoDBPool</a></li><li><a href="ElasticsearchPool.html">ElasticsearchPool</a></li><li><a href="FakeTrace.html">FakeTrace</a></li><li><a href="FetchOptions.html">FetchOptions</a><ul class='methods'><li data-type='method' style='display: none;'><a href="FetchOptions.html#parseCookies">parseCookies</a></li><li data-type='method' style='display: none;'><a href="FetchOptions.html#toJSON">toJSON</a></li></ul></li><li><a href="Histogram.html">Histogram</a></li><li><a href="LRUCache.html">LRUCache</a><ul class='methods'><li data-type='method' style='display: none;'><a href="LRUCache.html#.clean">clean</a></li><li data-type='method' style='display: none;'><a href="LRUCache.html#.del">del</a></li><li data-type='method' style='display: none;'><a href="LRUCache.html#.get">get</a></li><li data-type='method' style='display: none;'><a href="LRUCache.html#.put">put</a></li></ul></li><li><a href="Meter.html">Meter</a></li><li><a href="Pool.html">Pool</a></li><li><a href="SqlPool.html">SqlPool</a><ul class='methods'><li data-type='method' style='display: none;'><a href="SqlPool.html#nextToken">nextToken</a></li><li data-type='method' style='display: none;'><a href="SqlPool.html#prepare">prepare</a></li><li data-type='method' style='display: none;'><a href="SqlPool.html#prepareUpdateExpr">prepareUpdateExpr</a></li><li data-type='method' style='display: none;'><a href="SqlPool.html#prepareUpsertExpr">prepareUpsertExpr</a></li><li data-type='method' style='display: none;'><a href="SqlPool.html#query">query</a></li></ul></li><li><a href="Timer.html">Timer</a></li><li><a href="TokenBucket.html">TokenBucket</a><ul class='methods'><li data-type='method' style='display: none;'><a href="TokenBucket.html#.configure">configure</a></li><li data-type='method' style='display: none;'><a href="TokenBucket.html#.consume">consume</a></li><li data-type='method' style='display: none;'><a href="TokenBucket.html#.equal">equal</a></li><li data-type='method' style='display: none;'><a href="TokenBucket.html#.toArray">toArray</a></li><li data-type='method' style='display: none;'><a href="TokenBucket.html#.toJSON">toJSON</a></li><li data-type='method' style='display: none;'><a href="TokenBucket.html#.toString">toString</a></li></ul></li><li><a href="Trace.html">Trace</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Trace.html#.destroy">destroy</a></li><li data-type='method' style='display: none;'><a href="Trace.html#.send">send</a></li><li data-type='method' style='display: none;'><a href="Trace.html#.start">start</a></li><li data-type='method' style='display: none;'><a href="Trace.html#.stop">stop</a></li><li data-type='method' style='display: none;'><a href="Trace.html#.toString">toString</a></li></ul></li><li><a href="module-cache.CacheClient.html">CacheClient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#applyOptions">applyOptions</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#applyReservedOptions">applyReservedOptions</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#close">close</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#del">del</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#get">get</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#incr">incr</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#limiter">limiter</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#lock">lock</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#put">put</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#stats">stats</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#unlock">unlock</a></li></ul></li><li><a href="module-cache.LocalClient.html">LocalClient</a></li><li><a href="module-cache.RedisClient.html">RedisClient</a></li><li><a href="module-cache.WorkerClient.html">WorkerClient</a></li><li><a href="module-push.APNClient.html">APNClient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-push.APNClient.html#send">send</a></li></ul></li><li><a href="module-push.FCMClient.html">FCMClient</a></li><li><a href="module-push.SNSClient.html">SNSClient</a></li><li><a href="module-push.WebpushClient.html">WebpushClient</a></li><li><a href="module-queue.EventBridgeClient.html">EventBridgeClient</a></li><li><a href="module-queue.JSONClient.html">JSONClient</a></li><li><a href="module-queue.LocalClient.html">LocalClient</a></li><li><a href="module-queue.NatsClient.html">NatsClient</a></li><li><a href="module-queue.QueueClient.html">QueueClient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-queue.QueueClient.html#channel">channel</a></li><li data-type='method' style='display: none;'><a href="module-queue.QueueClient.html#monitor">monitor</a></li><li data-type='method' style='display: none;'><a href="module-queue.QueueClient.html#schedule">schedule</a></li></ul></li><li><a href="module-queue.RedisClient.html">RedisClient</a></li><li><a href="module-queue.SNSClient.html">SNSClient</a></li><li><a href="module-queue.SQSClient.html">SQSClient</a></li><li><a href="module-queue.WorkerClient.html">WorkerClient</a></li></ul><h3>Global</h3><ul><li><a href="global.html#ConfigOptions">ConfigOptions</a></li><li><a href="global.html#DbConfigOptions">DbConfigOptions</a></li><li><a href="global.html#DbRequestColumn">DbRequestColumn</a></li><li><a href="global.html#DbRequestOptions">DbRequestOptions</a></li><li><a href="global.html#DbResultCallback">DbResultCallback</a></li><li><a href="global.html#DbTable">DbTable</a></li><li><a href="global.html#DbTableColumn">DbTableColumn</a></li><li><a href="global.html#DbUser">DbUser</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">api.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 *  Author: Vlad Seryakov vseryakov@gmail.com
 *  backendjs 2018
 */

const path = require('path');
const stream = require('stream');
const fs = require('fs');
const domain = require('domain');
const qs = require("qs");
const http = require('http');
const https = require('https');
const app = require(__dirname + '/app');
const lib = require(__dirname + '/lib');
const ipc = require(__dirname + '/ipc');
const metrics = require(__dirname + '/metrics');
const logger = require(__dirname + '/logger');

/**
 * @module api
 */

const api =

/**
 * HTTP API to the server from the clients, this module implements the basic HTTP(S) API functionality with some common features. The API module
 * incorporates the Express server which is exposed as __api.app__ object, the server spawns Web workers to perform actual operations, monitors
 * the worker processes if they die and restart them automatically.
 *
 * How many processes to spawn can be configured via __-server-max-workers__ config parameter.
 *
 * When an HTTP request arrives it goes over Express middleware, but before processing any registered routes there are several steps performed:
 * - the __req__ object which is by convention is a Request object, assigned with common backend properties to be used later:
 *   - user - an empty object which will be filled after by signature verification method, if successful, properties from the __bk_user__ table will be set
 *   - options - an object with internal state and control parameters. Every request always has an options object attached very
 *     early with some properties always present:
 *      - ip - cached IP address
 *      - host - cached host header from the request
 *      - hostname - cached host header without port
 *      - domain - domain part from the host
 *      - origin - full origin with protocol + host
 *      - path - parsed request url path
 *      - apath - an array with the path split by /
 *      - secure - if the request is encrypted, like https
 *      - appTimezone - milliseconds offset from the UTC provided in the header by the app
 * - access verification, can the request be satisfied without proper signature, i.e. is this a public request
 * - autherization, check the signature and other global or user specific checks
 * - when a API route found by the request url, it is called as any regular Express middlware
 *   - if there are registered pre processing callback they will be called during access or autherization phases
 *   - if inside the route a response was returned using __api.sendJSON__ method, registered post process callbacks will be called for such response
 *
 * Every request has the __trace__ property, either fake or X-Ray depending on the config, see metrics for usage
 *
 * ### Health enquiry
 *
 * When running with AWS load balancer there should be a url that a load balancer polls all the time and this must be very quick and lightweight request. For this
 * purpose there is an API endpoint __/ping__ that just responds with status 200. It is open by default in the default __api-allow-path__ config parameter.
 *
 */

module.exports = {
    name: "api",

    /**
     * @var {ConfigOptions[]} args
     */
    args: [
        { name: "err-(.+)", descr: "Error messages for various cases" },
        { name: "cap-(.+)", type: "int", strip: "cap-", descr: "Capability parameters" },
        { name: "max-request-queue", type: "number", min: 0, descr: "Max number of requests in the processing queue, if exceeds this value server returns too busy error" },
        { name: "timeout", type: "number", min: 0, max: 3600000, descr: "HTTP request idle timeout for servers in ms, how long to keep the connection socket open, this does not affect Long Poll requests" },
        { name: "keep-alive-timeout", type: "int", descr: "Number of milliseconds to keep the HTTP conection alive" },
        { name: "request-timeout", type: "int", min: 0, descr: "Number of milliseconds to receive the entire request from the client" },
        { name: "max-requests-per-socket", type: "int", min: 0, descr: "The maximum number of requests a socket can handle before closing keep alive connection" },
        { name: "port", type: "number", min: 0, descr: "port to listen for the HTTP server, this is global default" },
        { name: "bind", descr: "Bind to this address only, if not specified listen on all interfaces" },
        { name: "backlog", type: "int", descr: "The maximum length of the queue of pending connections, used by HTTP server in listen." },
        { name: "reuse-port", type: "bool", descr: "Allow multiple sockets on the same host to bind to the same port" },
        { name: "ssl", type: "map", obj: 'ssl', merge: 1, descr: "SSL params: port, bind, key, cert, pfx, ca, passphrase, crl, ciphers" },
        { name: "accesslog-disable", obj: "accesslog", type: "bool", descr: "Disable access logging in both file or syslog" },
        { name: "accesslog-file", obj: "accesslog", descr: "File for access logging" },
        { name: "accesslog-level", obj: "accesslog", type: "int", descr: "Syslog level priority, default is local5.info, 21 * 8 + 6" },
        { name: "accesslog-fields", obj: "accesslog", array: 1, type: "list", descr: "Additional fields from the request or user to put in the access log, prefix defines where the field is lcoated: q: - query, h: - headers, u: - user otherwise from the request", example: "-api-log-fields h:Referer,u:name,q:action" },
        { name: "errlog-max", obj: "errlog", type: "int", descr: "How many error messages to put in the log before throttling kicks in" },
        { name: "errlog-interval", obj: "errlog", type: "int", descr: "Interval for error log limiter, max errors per this interval" },
        { name: "errlog-ignore", obj: "errlog", type: "regexpobj", descr: "Do not show errors that match the regexp" },
        { name: "errlog-codes", obj: "errlog", type: "regexpobj", descr: "Error codes in exceptions to return in the response to the user, if not matched the errlog.message will be returned" },
        { name: "qs-options-(.+)", autotype: 1, obj: "qsOptions", strip: "qs-options-", nocamel: 1, descr: "Options to pass to qs when parsing the body: depth, arrayLimit, allowDots, comma, plainObjects, allowPrototypes, parseArrays" },
        { name: "query-token-secret", descr: "Name of the property to be used for encrypting tokens for pagination or other sensitive data, any property from bk_user can be used, if empty no secret is used, if not a valid property then it is used as the secret" },
        { name: "access-token-secret", descr: "A generic secret to be used for API access or signatures" },
        { name: "allow-configure-(web|middleware)", type: "regexp", descr: "Modules allowed to call configureWeb or Middleware, i.e. only allowed endpoints" },
        { name: "express-options", type: "json", obj: "express-options", merge: 1, logger: "warn", descr: "Set Express config options during initialization", example: '-api-express-options { "trust proxy": 1, "strict routing": true }' },
        { name: "body-methods", type: "list", upper: 1, descr: "HTTP methods allowed to have body" },
        { name: "body-types", type: "regexpobj", descr: "Collect full request body in the req.body property for the given MIME types in addition to default json/form posts, this is for custom body processing" },
        { name: "body-raw", type: "regexpobj", descr: "Do not parse the collected body for the following MIME content types, keep it as a string" },
        { name: "body-multipart", type: "regexpobj", descr: "URLs that expect multipart/form-data payloads, parsing will happend after the signature processed" },
        { name: "cors-origin", descr: "Origin header for CORS requests" },
        { name: "cors-allow", type: "regexpobj", descr: "Enable CORS requests if a request host/path matches the given regexp" },
        { name: "tz-header", descr: "Name for the timezone offset header a client can send for time sensitive requests, the backend decides how to treat this offset" },
        { name: "server-header", descr: "Custom Server: header to return for all requests" },
        { name: "rlimits-([a-z]+)$", obj: "rlimits", make: "$1", autotype: 1, descr: "Default rate limiter parameters, default interval is 1s, `ttl` is to expire old cache entries, message for error" },
        { name: "rlimits-(rate|max|interval|ttl|ip|delay|multiplier|queue)-(.+)", autotype: 1, obj: "rlimitsMap.$2", make: "$1", descr: "Rate limiter parameters by type for Token Bucket algorithm. `queue` to use specific queue, ttl` is to expire cache entries, `ip` is to limit by IP address as well", example: "api-rlimits-ip-ip=10\napi-rlimits-rate-/path=1\napi-rlimits-rate-GET/path=1" },
        { name: "rlimits-map-(.+)", type: "map", obj: "rlimitsMap.$1", merge: 1, descr: "Rate limiter parameters for Token Bucket algorithm. set all at once", example: "api-rlimits-map-/url=rate:1,interval:2000\napi-rlimits-map-GET/url=rate:10" },
        { name: "(query|header|upload)-limit", type: "number", descr: "Max size for query/headers/uploads, bytes" },
        { name: "(files|fields)-limit", type: "number", descr: "Max number of files or fields in uploads" },
        { name: "limiter-cache", descr: "Name of a cache for API rate limiting" },
        { name: "response-headers", type: "regexpmap", json: 1, descr: "An JSON object with list of regexps to match against the location and set response headers defined as a ist of pairs name, value...", example: 'api-response-headers={ "^/": ["x-frame-options","sameorigin","x-xss-protection","1; mode=block"] }' },
        { name: "cleanup-rules-(.+)", obj: "cleanupRules.$1", type: "map", merge: 1, nocamel: 1, descr: "Rules for the cleanupResult per table, ex. api-cleanup-rules-bk_user=email:0,phone:1" },
        { name: "cleanup-strict", type: "bool", descr: "Default mode for cleanup results" },
        { name: "request-cleanup", type: "list", array: 1, descr: "List of fields to explicitely cleanup on request end" },
        { name: "query-defaults-([a-z0-9_]+)-(.+)", obj: "queryDefaults.$2", make: "$1", autotype: 1, descr: "Global query defaults for getQuery, can be path specific", example: "-api-query-defaults-max-name 128 -api-query-defaults-max-/endpoint-name 255" },
        { name: "delays-(.+)", type: "int", obj: "delays", nocamel: 1, descr: "Delays in ms by status and code, useful for delaying error responses to slow down brute force attacks", example: "-api-delays-401 1000 -api-delays-403:DENY -1" },
        { name: "restart-hours", type: "list", datatype: "int", descr: "List of hours when to restart api workers, only done once for each hour" },
        { name: "trace-options", type: "map", obj: "trace-options", merge: 1, descr: "Options for tracing, host where to send if not local, path:regexp for URLs to be traced, interval:Interval in ms how often to trace requests, must be > 0 to enable tracing" },
        { name: "exit-on-error", type: "bool", descr: "Exit on uncaught exception in the route handler" },
        { name: "restart", descr: "On address in use error condition restart the specified servers, this assumes an external monitor like monit to handle restarts" },
        { name: "proxy-(.+)", obj: "proxy", type: "regexp", make: "$1", nocamel: 1, descr: "Proxy matched requests by path to given host" },
    ],

    /** @var {int} port - HTTP port to listen to for Express app,
     * @default 8000
     */
    port: process.env.BKJS_PORT || 8000,

    /** @var {string} bind - listen on the specified local interfcae,
     * @default 0.0.0.0
     */
    bind: '0.0.0.0',

    backlog: 5000,

    ssl: { port: 443, bind: '0.0.0.0' },

    // Rate limits
    rlimitsMap: {},
    rlimits: {
        ttl: 86400000,
        message: "Access limit reached, please try again later in %s.",
    },
    delays: {},

    responseHeaders: [],
    traceOptions: {},
    expressOptions: {},
    bodyMethods: ["POST", "PUT", "PATCH"],

    // All listening servers
    servers: [],

    // Incoming data limits, bytes
    filesLimit: 10,
    fieldsLimit: 100,

    /** @var {int} - file limit for multi-part uploads
      * @default
      */
    uploadLimit: 25000000,

    /** @var {int} - toal size of request query
      * @default
      */
    queryLimit: 64000,

    /** @var {int} - total size of all headers
      * @default
      */
    headerLimit: 64000,

    // Connection timeouts
    timeout: 30000,
    keepAliveTimeout: 61000,
    requestTimeout: 0,

    qsOptions: {
        plainObjects: true
    },

    tzHeader: "bk-tz",
    accessTokenSecret: "",

    corsAllow: null,
    corsOrigin: "*",
    corsCredentials: true,
    corsMethods: ['OPTIONS', 'HEAD', 'GET', 'POST', 'PUT', 'PATCH', 'DELETE'],

    // Properties to be cleaned up on finish
    requestCleanup: ["options", "user", "signature", "body", "raw_body", "trace"],
    cleanupRules: {},

    restart: "server,web,process",

    // Metrics and stats
    metrics: {
        req: new metrics.Timer(),
        que: new metrics.Histogram(),
        running: 0,
        busy_count: 0,
        large_count: 0,
        bad_count: 0,
        err_count: 0,
    },

    maxRequestQueue: 0,
    limiterCache: "local",

    accesslog: {
        fields: [],
        level: 174,
    },

    // Error reporter throttle
    errlog: {
        max: 100,
        interval: 30000,
        ignore: lib.toRegexpObj(null, [ "Range Not Satisfiable", "Precondition Failed" ]),
    },

    /** @var {object} - used by {@link module:api.toParams} global defaults, passed as data */
    queryDefaults: {
        "*": {
            maxlist: 512,
        },
        "*.json": {
            max: 4000,
        },
        "*.token": {
            max: 2000,
        },
        "*.string": {
            max: 512,
        },
        "*.text": {
            max: 512,
        },
        "*.obj": {
            max: 32000
        },
        "*.object": {
            max: 32000
        },
        "*.array": {
            max: 32000
        },
    },

    errInternalError: "Internal error occurred, please try again later",
    errTooLarge: "Unable to process the request, it is too large",
};

/**
 * Initialize API layer, this must be called before the `api` module can be used but it is called by the server module automatically so `api.init` is
 * rearely need to called directly, only for new server implementation or if using in the shell for testing.
 *
 * During the init sequence, this function calls `configureMiddleware` and `configureWeb` methods of all modules.
 *
 * The api uses its own request parser that places query parameters into `req.query` or `req.body` depending on the method.
 *
 * For GET method, `req.query` contains all url-encoded parameters, for POST method `req.body`
 * contains url-encoded parameters or parsed JSON payload or multipart payload.
 *
 * @memberof module:api
 * @method init
 */
api.init = function(options, callback)
{
    if (typeof options == "function") callback = options, options = null;
    if (!options) options = {};

    // Shutdown signal from the server process
    if (app.isWorker) {
        ipc.on("api:restart", () => {
            api.shutdown(() => { process.exit(0) });
        });
    }

    // These will not be used outside of this call
    this.express = require('express');
    this.app = this.express();

    // Acccess logging, always goes into api.accessLog, it must be a stream
    if (!this.accesslog.disable) {
        this.configureAccessLog();
        this.app.use(this.handleAccessLog.bind(this));
    }

    // Early request setup and checks
    this.app.use(this.startServerRequest.bind(this));

    // Proxies must be setup early before to keep all data in the stream
    if (!lib.isEmpty(this.proxy)) {
        api.app.use((req, res, next) => {
            if (api.checkProxy("web", req, res)) return;
            next();
        });
    }

    this.app.use(this.handleHeaders.bind(this));

    // Metrics starts early, always enabled
    this.app.use(this.startMetrics.bind(this));

    // Default parsers
    this.app.use(this.handleBody.bind(this));

    // Config options for Express
    for (const p in this.expressOptions) {
        this.app.set(p, this.expressOptions[p]);
    }

    lib.series([
        function(next) {

            // Assign custom middleware including security, if the signature is disabled then the middleware
            // handler may install some other authentication module and in such case
            // must setup `req.user` with the current user record
            app.runMethods("configureMiddleware", options, { allow: api.allowConfigureMiddleware }, next);
        },

        function(next) {

            // Parse multipart payload, depends on formidable availability, disable if not found
            _formidable = lib.tryRequire('formidable', { logger: "debug", message: "multipart uploads are disabled" });

            if (_formidable) {
                api.app.use((req, res, next) => {
                    if (!req.is('multipart/form-data')) return next("route");
                    if (!lib.testRegexpObj(req.options.path, api.bodyMultipart)) return next("route");
                    api.handleMultipart(req, res, (err) => (next(err || "route")));
                });
            }

            // Setup routes from the loaded modules
            app.runMethods("configureWeb", options, { allow: api.allowConfigureWeb }, next);
        },

        function(next) {
            // For health checks
            api.app.get("/ping", (req, res) => {
                api.sendStatus(res, { contentType: "text/plain" });
            });

            // Static paths and templating setup
            app.runMethods("configureStaticWeb", options, { allow: api.allowConfigureMiddleware }, next);
        },

        function(next) {
            // Default error handler to show errors in the log, throttle the output to keep the log from overflow
            if (api.errlogLimiterMax &amp;&amp; api.errlogLimiterInterval) {
                api.errlogLimiterToken = new metrics.TokenBucket(api.errlogLimiterMax, 0, api.errlogLimiterInterval);
            }

            // The last route is to return an error
            api.app.use((err, req, res, next) => {
                api.sendReply(res, err);
            });

            api.configureWebServers();

            // Notify the server about new worker server
            ipc.sendMsg("api:ready", { id: app.workerId || process.pid, port: api.port, ready: true });

            // Performs graceful web worker restart
            api._restartInterval = setInterval(() => {
                if (lib.isFlag(api.restartHours, new Date().getHours())) {
                    logger.info('restarting web workers:', api.restartHours);
                    ipc.sendMsg("api:restart");
                }
            }, 3600000);

            next();
        },
    ], callback, true);
}

/**
 * Gracefully close all connections, call the callback after that
 * @memberof module:api
 * @method shutdown
 */
var _exiting;

api.shutdown = function(options, callback)
{
    if (_exiting) return lib.tryCall(callback);
    _exiting = true;
    logger.debug("shutdown:", app.name, app.role);

    clearInterval(api._restartInterval);
    delete api._restartInterval;
    api.metrics.req.end();

    // Make workers not ready during the shutdown
    ipc.sendMsg("api:shutdown", { id: app.workerId || process.pid, pid: process.pid, port: api.port });

    app.runMethods("shutdownServer", { direct: 1, parallel: 1 }, () => {
        delete api.app;
        _exiting = false;
        lib.tryCall(callback);
    });
}

api.shutdownServer = function(options, callback)
{
    lib.forEach([ "server", "sslServer" ], (name, next) => {
        if (!api[name]) return next();
        var err, server = api[name];
        delete api[name];
        try {
            server.close();
            server.closeAllConnections();
            server.closeIdleConnections();
        } catch (e) {
            err = e
        }
        logger.log("shutdownServer:", api.name, app.role, name, "closed", err);
        next();
    }, callback, true);
}

api.configureWebServers = function(options, callback)
{
    // Start http server
    if (this.port) {
        api.server = this.createWebServer({
            name: "http",
            port: this.port,
            bind: this.bind,
            restart: this.restart,
            timeout: this.timeout,
            keepAliveTimeout: this.keepAliveTimeout,
            requestTimeout: this.requestTimeout,
            maxRequestsPerSocket: this.maxRequestsPerSocket,
            maxHeaderSize: this.headerLimit,
            reusePort: this.reusePort,
        }, this.handleServerRequest);
    }

    // Start SSL server
    if (this.ssl?.port &amp;&amp; (this.ssl.key || this.ssl.pfx)) {
        api.sslServer = this.createWebServer({
            name: "https",
            ssl: this.ssl,
            port: this.ssl.port,
            bind: this.ssl.bind,
            restart: this.restart,
            timeout: this.timeout,
            keepAliveTimeout: this.keepAliveTimeout,
            requestTimeout: this.requestTimeout,
            maxRequestsPerSocket: this.maxRequestsPerSocket,
            maxHeaderSize: this.headerLimit,
            reusePort: this.reusePort,
        }, this.handleServerRequest);
    }

    app.runMethods("configureWebServer", options, { direct: 1 }, callback);
}

// Setup access log stream
api.configureAccessLog = function()
{
    if (logger.syslog) {
        this.accesslog.stream = new stream.Stream();
        this.accesslog.stream.writable = true;
        this.accesslog.stream.write = (data) => { logger.syslog.log(api.accesslog.level, data); return true; };
    } else
    if (this.accesslog.file) {
        this.accesslog.stream = fs.createWriteStream(this.accesslog.file, { flags: 'a' });
        this.accesslog.stream.on('error', (err) => { logger.error('accessLog:', err); api.accessLog = null; });
    } else {
        this.accesslog.stream = logger;
    }
}

api.handleAccessLog = function(req, res, next)
{
    var startTime = new Date();
    var end = res.end;
    res.end = function(chunk, encoding) {
        res.end = end;
        res.end(chunk, encoding);
        if (req._accessLog || !api.accesslog.stream) return;
        req._accessLog = true;
        var now = new Date();
        var line = req.options.ip + " - " +
                   (api.accesslog.file ? '[' + now.toUTCString() + ']' : "-") + " " +
                   req.method + " " +
                   (req.accessLogUrl || req.originalUrl || req.url) + " " +
                   (req.httpProtocol || "HTTP") + "/" + req.httpVersionMajor + "/" + req.httpVersionMinor + " " +
                   res.statusCode + " " +
                   (req.options.clength || '-') + " - " +
                   (now - startTime) + " ms - " +
                   (req.headers['user-agent'] || "-") + " " +
                   (req.user?.id || "-");
        // Append additional fields
        for (let v of api.accesslog.fields) {
            switch (v[1] == ":" ? v[0] : "") {
            case "q":
                v = req.query[v.substr(2)];
                break;
            case "h":
                v = req.get(v.substr(2));
                break;
            case "u":
                v = req.user &amp;&amp; req.user[v.substr(2)];
                break;
            default:
                v = req[v];
            }
            if (typeof v == "object") v = "";
            line += " " + (v || "-");
        }
        if (api.accesslog.file) line += "\n";
        api.accesslog.stream.write(line);
    }
    next();
}

api.startServerRequest = function(req, res, next)
{
    // Fake i18n methods
    req.__ = res.__ = res.locals.__ = lib.__;

    // Request queue size
    if (api.maxRequestQueue &amp;&amp; api.metrics.running >= api.maxRequestQueue) {
        api.metrics.busy_count++;
        return api.sendReply(res, 503, "Server is unavailable");
    }

    // Setup request common/required properties
    api.prepareRequest(req);

    // Perform internal routing
    api.routing.check(req, "path");

    // Rate limits by IP address and path, early before all other filters
    api.checkRateLimits(req, { type: ["ip", "path"] }, (err) => {
        if (err) {
            metrics.incr(api.metrics, err.type + '_count');
            return api.sendReply(res, err);
        }
        logger.debug("startServerRequest:", req.options);
        next();
    });
}

// Start Express middleware processing wrapped in the node domain
api.handleServerRequest = function(req, res)
{
    logger.dev("handleServerRequest:", api.port, req.url);
    if (!api.app) return res.end();

    var d = domain.create();
    d.on('error', (err) => {
        logger.error('handleServerRequest:', api.port, req.path, lib.traceError(err));
        if (!res.headersSent) api.sendReply(res, err);
        api.shutdown({}, () => { process.exit(0); });
    });
    d.add(req);
    d.add(res);
    d.run(api.app, req, res);
}

/**
 * Prepare request options that the API routes will merge with, can be used by pre process hooks, initialize
 * required properties for subsequent use
 * @param {IncomingRequest} req
 * @memberof module:api
 * @method prepareRequest
 */
api.prepareRequest = function(req)
{
    // Cache the path so we do not need reparse it every time
    var path = req.path || "/";
    var apath = path.substr(1).split("/");

    // Port can only be 0-65535
    const host = req.host?.toLowerCase() || '';
    const colon = host.search(/:\d{0,6}$/);
    const hostname = colon > 0 ? host.slice(0, colon) : host;

    req.options = {
        ops: {},
        ip: req.ip,
        host,
        hostname,
        domain: lib.domainName(hostname),
        origin: `${req.protocol}://${host}`,
        path: path,
        apath: apath,
        secure: req.secure ? "s": "",
        mtime: Date.now(),
        clength: lib.toNumber(req.get("content-length")),
        ctype: req.get("content-type") || "",
    };

    var sc = req.options.ctype.indexOf(";");
    if (sc > 0) req.options.ctype = req.options.ctype.substr(0, sc).trim();

    req.__ = lib.__.bind(req);
    if (req.res) {
        if (!req.res.locals) req.res.locals = {};
        req.res.locals.__ = req.res.__ = lib.__.bind(req.res);
    }

    this.prepareOptions(req);
    logger.debug("prepareRequest:", req.options);
}

/**
 * Parse or re-parse special headers about app version, language and timezone, it is called early to parse headers first and then
 * right after the query parameters are available, query values have higher priority than headers.
 * @memberof module:api
 * @method prepareOptions
 */
api.prepareOptions = function(req)
{
    // Timezone offset from UTC passed by the client, we just keep it, how to use it is up to the application
    if (!req.options.appTimezone) {
        req.options.appTimezone = lib.toNumber(req.query[this.tzHeader] || req.headers[this.tzHeader], { dflt: 0, min: -720, max: 720 }) * 60000;
    }

    // Authorization user or token
    var auth = req.headers.authorization;
    if (auth) {
        let idx = auth.indexOf(" ");
        req.options.auth_type = auth.substr(0, idx);
        req.options.auth_user = auth.substr(idx + 1);
        if (req.options.auth_type == "Basic") {
            auth = Buffer.from(req.options.auth_user, 'base64').toString();
            idx = auth.indexOf(':');
            req.options.auth_user = auth.substr(0, idx);
            req.options.auth_passwd = auth.substr(idx + 1);
        }
    }
}

api.handleHeaders = function(req, res, next)
{
    var location = req.options.hostname + req.options.path;

    if (!api.serverHeader) {
        api.serverHeader = app.version;
    }
    res.header('Server', api.serverHeader);

    // Allow cross site requests
    if (lib.testRegexpObj(location, api.corsAllow)) {
        res.header('Access-Control-Allow-Origin', api.corsOrigin);
        res.header('Access-Control-Allow-Headers', ['content-type', api.signature.header, api.tzHeader].join(", "));
        res.header('Access-Control-Allow-Methods', api.corsMethods.join(", "));
        res.header('Access-Control-Allow-Credentials', api.corsCredentials);
        // Return immediately for preflight requests
        if (req.method == 'OPTIONS' &amp;&amp; req.get('Access-Control-Request-Method')) {
            return res.sendStatus(204);
        }
    }

    // Set response header by location
    for (const i in api.responseHeaders) {
        const rule = api.responseHeaders[i];
        if (!lib.isArray(rule.value)) continue;
        if (lib.testRegexpObj(req.options.path, rule) || lib.testRegexpObj(location, rule)) {
            for (let j = 0; j &lt; rule.value.length - 1; j += 2) {
                if (rule.value[j + 1]) res.setHeader(rule.value[j], rule.value[j + 1]); else res.removeHeader(rule.value[j]);
            }
        }
    }
    logger.debug('handleHeaders:', api.port, req.method, req.connection.remoteAddress, req.options, req.headers);

    // Redirect before processing the request
    location = api.redirect.check(req);
    if (location) return api.sendStatus(res, location);

    if (req.headers.cookie) {
        req.cookies = lib.parseCookies(req.headers.cookie);
    }

    next();
}

/**
 * This is supposed to be called at the beginning of request processing to start metrics and install the handler which
 * will be called at the end to finalize the metrics and call the cleanup handlers.
 * @memberof module:api
 * @method startMetrics
 */
api.startMetrics = function(req, res, next)
{
    req._timer = this.metrics.req.start();
    this.metrics.que.update(++this.metrics.running);

    var end = res.end;
    res.end = function(chunk, encoding) {
        res.end = end;
        res.end(chunk, encoding);
        api.handleMetrics(req);
        api.handleCleanup(req);
    }

    // Register trace for the request, by default use fake tracer unless explicity marked to use real metrics
    if (api.traceOptions?.interval > 0) {
        if ((!api._traceTime || req.options.mtime - api._traceTime > api.traceOptions.interval) &amp;&amp;
            api.traceOptions?.path?.test &amp;&amp; api.traceOptions.path.test(req.options.path)) {
            var opts = {
                _host: api.traceOptions?.host,

                service: {
                    version: app.version,
                },
                annotations: {
                    tag: app.instance.tag || app.id,
                    role: app.role,
                }
            };
            if (app.instance.type == "aws") {
                opts.aws = {};
                if (app.instance.container) {
                    opts.aws.ecs = {
                        container: app.instance.container,
                        container_id: app.instance.container_id,
                    };
                }
                if (app.instance.image) {
                    opts.aws.ec2 = {
                        instance_id: app.instance.id,
                        ami_id: app.instance.image,
                    };
                }
            }
            req.trace = new metrics.Trace(opts);
            api._traceTime = req.options.mtime;
        }
    }
    if (!req.trace) req.trace = new metrics.FakeTrace();

    next();
}

/**
 * Finish metrics collection about the current rquest
 * @memberof module:api
 * @method handleMetrics
 */
api.handleMetrics = function(req)
{
    req.elapsed = req._timer?.end();
    delete req._timer;

    this.metrics.running--;
    if (req.res.statusCode) {
        metrics.incr(this.metrics, req.res.statusCode + "_count");
    }
    if (req.res.statusCode >= 400 &amp;&amp; req.res.statusCode &lt; 500) {
        this.metrics.bad_count++;
    }
    if (req.res.statusCode >= 500) {
        this.metrics.err_count++;
    }
    req.trace.stop(req);
    req.trace.send();
    req.trace.destroy();
}

/**
 * Call registered cleanup hooks and clear the request explicitly
 * @memberof module:api
 * @method handleCleanup
 */
api.handleCleanup = function(req)
{
    var hooks = this.hooks.find('cleanup', req.method, req.options.path);
    lib.forEverySeries(hooks, (hook, next) => {
        logger.debug('cleanup:', req.method, req.options.path, hook.path);
        hook.callback(req, next);
    }, () => {
        for (const p in req) {
            if (p.startsWith("__") || api.requestCleanup.includes(p)) {
                for (const c in req[p]) delete req[p][c];
                if (!lib.isObject(req[p])) delete req[p];
            }
        }
        for (const p in req.files) {
            if (req.files[p] &amp;&amp; req.files[p].path) {
                fs.unlink(req.files[p].path, (err) => { if (err) logger.error("cleanup:", err); });
            }
        }
    }, true);
}

/**
 * Parse incoming query parameters in the request body, this is default middleware called early before authenticatoion.
 * Only methods in `-api-body-methods` processed, defaults are POST/PUT/PATCH.
 * Store parsed parameters in the `req.body`.
 * @memberof module:api
 * @method handleBody
 */
api.handleBody = function(req, res, next)
{
    if (req._body) return next();

    switch (req.options.ctype) {
    case "text/json":
    case 'application/json':
    case 'application/x-www-form-urlencoded':
    case "text/xml":
    case "application/xml":
        req.setEncoding('utf8');
        break;

    default:
        // Custom types to be collected
        if (!lib.testRegexpObj(req.options.ctype, this.bodyTypes)) return next();
        req.setEncoding('binary');
    }

    if (req.options.clength > 0 &amp;&amp; req.options.clength >= this.queryLimit) {
        this.metrics.large_count++;
        logger.debug("handleBody:", "too large:", req.path, req.headers);
        return next(lib.newError({ message: "too large", _msg: api.errTooLarge, status: 413, length: req.options.clength }));
    }

    req._body = true;
    var buf = '', size = 0;
    var sig = this.signature.get(req);

    req.on('data', (chunk) => {
        size += chunk.length;
        if (size > api.queryLimit) {
            this.metrics.large_count++;
            logger.debug("handleBody:", "too large:", req.path, req.headers, buf);
            return next(lib.newError({ message: "too large", _msg: api.errTooLarge, status: 413, maxsize: api.queryLimit, length: size }));
        }
        buf += chunk;
    });
    req.on('end', () => {
        try {
            if (size > api.queryLimit) {
                this.metrics.large_count++;
                logger.debug("handleBody:", "too large:", req.path, req.headers, buf);
                return next(lib.newError({ message: "too large", _msg: api.errTooLarge, status: 413, maxsize: api.queryLimit, length: size }));
            }

            // Verify data checksum before parsing
            if (sig?.checksum &amp;&amp; lib.hash(buf) != sig.checksum) {
                return next(lib.newError("invalid data checksum"));
            }

            switch (lib.testRegexpObj(req.options.path, api.bodyRaw) ? null : req.options.ctype) {
            case "text/json":
            case "application/json":
                if (!api.bodyMethods.includes(req.method)) break;
                req.body = lib.jsonParse(buf, { datatype: "object", logger: "debug" });
                req.raw_body = buf;
                break;

            case "application/x-www-form-urlencoded":
                if (!api.bodyMethods.includes(req.method)) break;
                req.body = buf.length ? qs.parse(buf, api.qsOptions) : {};
                req.raw_body = buf;
                break;

            default:
                req.body = buf;
            }
            api.prepareOptions(req);
            next();
        } catch (err) {
            err.status = 400;
            err.title = "handleBody";
            next(err);
        }
    });
}

var _formidable;

/**
 * Parse multipart forms for uploaded files, this must be called explicitly by the endpoints that need uploads.
 * The api module handles uploads automatically for configured paths via `-api-body-multipart` config parameter.
 * @param {object} req - Express Request
 * @param {object} res - Express Response
 * @param {function} next
 *
 * @example
 *
 * api.app.post("/upload", api.handleMultipart, (req, res, next) => {
 *   if (req.files.file) ....
 * })
 *
 * // Another global way to handle uploads for many endpoints is to call it for all known paths at once before the actual upload handlers.
 *
 * api.app.post(/^\/upload\//, api.handleMultipart, (req, res, next) => (next("route")));
 * ...
 * api.app.post("/upload/icon", (req, res, next) => {
 * ...
 * api.app.post("/upload/icon", (req, res, next) => {
 *
 *
 * @memberof module:api
 * @method handleMultipart
 */
api.handleMultipart = function(req, res, next)
{
    if (!req.is('multipart/form-data')) return next();

    const opts = {
        uploadDir: app.tmpDir,
        allowEmptyFiles: true,
        keepExtensions: true,
        maxFiles: api.filesLimit,
        maxFileSize: api.uploadLimit,
        maxFields: api.fieldsLimit,
        maxFieldsSize: api.queryLimit,
    };

    const form = _formidable.formidable(opts);
    const trace = req.trace.start("handleMultipart");

    var data = {}, files = {};

    form.on('field', (name, val) => {
        if (Array.isArray(data[name])) {
            data[name].push(val);
        } else
        if (data[name]) {
            data[name] = [data[name], val];
        } else {
            data[name] = val;
        }
    });
    form.on('file', (name, val) => {
        val = val.toJSON();
        val.path = val.filepath;
        val.name = val.originalFilename;
        files[name] = val;
    });
    form.on('progress', (bytesReceived, bytesExpected) => {
        if (bytesExpected &lt; api.uploadLimit) return;
        this.metrics.large_count++;
        form.emit("error", lib.newError({ message: "too large", _msg: api.errTooLarge, status: 413, maxsize: api.uploadLimit, length: bytesExpected }));
    });

    form.parse(req, (err) => {
        logger.debug("handleMultipart:", err, req.path, req.headers, data, Object.keys(files));
        if (err) {
            if (err &amp;&amp; /maxFile|maxField|maxTotal/.test(err.message)) {
                this.metrics.large_count++;
                err._msg = api.errTooLarge;
                err.status = 413;
            }
            trace.stop(err);
            return next(err);
        }
        try {
            req.body = qs.parse(data, api.qsOptions);
            req.files = files;
            trace.stop();
            next();
        } catch (e) {
            e.status = 400;
            e.title = "handleMultipart";
            trace.stop(e);
            next(e);
        }
    });
}

/**
 * Replace redirect placeholders
 * @param {object} req - Express Request
 * @param {string} pathname - redirect path, it may contain placeholders in the form: @name@:
 * - HOST - full host name from header
 * - IP - remote IP address
 * - DOMAIN - domain from the hostname
 * - PATH([1-9])? - full path or a part
 * - URL - full url
 * - BASE - basename from the path no extention
 * - FILE - base file name with extention
 * - DIR - directory name only
 * - SUBDIR - last part of the directory path
 * - EXT - file extention
 * - QUERY - stringified query
 * @return {string} possibly new path
 * @memberof module:api
 * @method checkRedirectPlaceholders
 */
api.checkRedirectPlaceholders = function(req, pathname)
{
    return pathname.replace(/@(HOST|IP|DOMAIN|PATH([1-9])?|URL|BASE|FILE|DIR|SUBDIR|EXT|QUERY)@/g, function(_, m) {
        switch (m.substr(0, 2)) {
        case "HO": return req.options.host;
        case "IP": return req.options.ip;
        case "DO": return req.options.domain;
        case "PA": return m[4] > 0 ? req.options.apath.slice(m[4]).join("/") : req.options.path;
        case "UR": return req.url;
        case "BA": return path.basename(req.options.path).split(".").shift();
        case "FI": return path.basename(req.options.path);
        case "DI": return path.dirname(req.options.path);
        case "SU": return path.dirname(req.options.path).split("/").pop();
        case "EX": return path.extname(req.options.path);
        case "QU": return qs.stringify(req.query);
        }
    });
}


/**
 * Web proxy: checkProxy("web", req, res)
 * WS proxy: checkProxy("ws", req, socket, head)
 * @returns {string} - a host matched or undefined
 * @memberof module:api
 * @method checkProxy
 */
api.checkProxy = function(type, ...args)
{
    const req = args[0];
    const path = req.path || req.url;

    for (const host in api.proxy) {
        if (!lib.testRegexp(path, api.proxy[host])) continue;

        if (!api._proxy) {
            api._proxy = require("http-proxy").createProxyServer({});
        }
        const opts = {
            target: "https://" + host,
            ws: true,
            changeOrigin: true,
            hostRewrite: true,
            cookieDomainRewrite: "localhost",
            headers: {
                origin: host
            }
        }
        logger.debug("proxy:", opts, req.options);
        api._proxy[type](...args, opts);
        return host;
    }
}

/**
 * For now just convert cookies into an object so logger can process
 * @memberof module:api
 * @method cleanupHeaders
 */
api.cleanupHeaders = function(headers)
{
    if (!headers) return headers;
    if (headers.cookie) {
        headers.cookie = lib.parseCookies(headers.cookie);
    }
    if (headers["set-cookie"]) {
        headers["set-cookie"] = lib.parseCookies(headers["set-cookie"]);
    }
    return headers;
}

/**
 * Create a Web server with options and request handler, returns a server object.
 *
 * Options can have the following properties:
 * @param {int} port - port number is required
 * @param {string} [bind] - address to bind
 * @param {string} [restart] - name of the processes to restart on address in use error, usually "web"
 * @param {objext} [ssl] - an object with SSL options for TLS createServer call
 * @param {int} [timeout] - number of milliseconds for the request timeout
 * @param {int} [keepAliveTimeout] - number of milliseconds to keep the HTTP connecton alive
 * @param {int} [requestTimeout] - number of milliseconds to receive the entire request from the client
 * @param {int} [maxRequestsPerSocket] - number of requests a socket can handle before closing keep alive connection
 * @param {int} [maxHeaderSize] - maximum length of request headers in bytes
 * @param {boolean} [reusePort] - allows multiple sockets on the same host to bind to the same port
 * @param {string} [name] - server name to be assigned
 * @memberof module:api
 * @method createWebServer
 */
api.createWebServer = function(options, callback)
{
    if (!options?.port) {
        logger.error('createWebServer:', 'invalid options', options);
        return null;
    }
    var server;
    if (options.ssl) {
        var opts = lib.objClone(options.ssl);
        for (const p in options) if (p != "ssl") opts[p] = options[p];
        server = https.createServer(opts, callback);
    } else {
        server = http.createServer(options, callback);
    }
    if (options.timeout) {
        server.timeout = options.timeout;
    }
    server.serverPort = options.port;
    if (options.name) {
        server.serverName = options.name;
    }
    if (options.keepAliveTimeout) {
        server.keepAliveTimeout = options.keepAliveTimeout;
        server.headersTimeout = Math.round(options.keepAliveTimeout * 1.25);
    }
    server.requestTimeout = options.requestTimeout || 0;
    server.maxRequestsPerSocket = options.maxRequestsPerSocket || null;
    server.on('error', (err) => {
        logger.error(app.role + ':', 'port:', options.port, lib.traceError(err));
        // Restart backend processes on address in use
        if (err.code == 'EADDRINUSE' &amp;&amp; options.restart) {
            app.killBackend(options.restart, "SIGKILL", () => { process.exit(0) });
        }
    });

    try {
        server.listen({
            port: options.port,
            host: options.bind,
            backlog: options.backlog,
            reusePort: options.reusePort,
        });
    } catch (e) {
        logger.error('server: listen:', options, e);
        server = null;
    }
    logger.log("createWebServer:", options);
    return server;
}

// API stats if running
api.configureCollectStats = function(options)
{
    if (!api.app) return;
    var m = metrics.toJSON(api.metrics, { reset: 1, take: /_count$/ });
    options.stats.api_req_count = m.req.meter.count;
    options.stats.api_req_rate = m.req.meter.rate;
    options.stats.api_res_time = m.req.histogram.med;
    options.stats.api_que_size = m.que.med;
    for (const p in m) {
        if (p.endsWith("_count")) options.stats["api_" + p] = m[p];
    }
}

require(__dirname + "/api/util");
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> using the <a href="https://github.com/vseryakov/docdash">docdash</a> theme.
</footer>


<script src="scripts/search.js" defer></script>



<script src="scripts/collapse.js" defer></script>



</body>
</html>
