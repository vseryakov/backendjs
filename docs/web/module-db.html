<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>db - Backendjs Documentation</title>
    
    <meta name="description" content="A Node.js library to create Web backends with minimal dependencies." />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h3>Tutorials</h3><ul><li><a href="tutorial-start.html">Getting started</a><ul class='typedefs'></ul></li><li><a href="tutorial-app.html">Application structure</a><ul class='typedefs'></ul></li><li><a href="tutorial-reference.html">Reference</a><ul class='typedefs'></ul></li><li><a href="tutorial-bkjs.html">The bkjs tool</a><ul class='typedefs'></ul></li><li><a href="tutorial-methods.html">Module lifecycle</a><ul class='typedefs'></ul></li><li><a href="tutorial-config.html">Config parameters</a><ul class='typedefs'></ul></li></ul><h3>Modules</h3><ul><li><a href="module-api.html">api</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-api.html#.checkProxy">checkProxy</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.checkRateLimits">checkRateLimits</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.checkRedirectPlaceholders">checkRedirectPlaceholders</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.cleanupHeaders">cleanupHeaders</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.cleanupResult">cleanupResult</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.createServer">createServer</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getResultPage">getResultPage</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.getTokenSecret">getTokenSecret</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.handleBody">handleBody</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.handleCleanup">handleCleanup</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.handleMetrics">handleMetrics</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.handleMultipart">handleMultipart</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.init">init</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.prepareOptions">prepareOptions</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.prepareRequest">prepareRequest</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.registerPreHeaders">registerPreHeaders</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.registerRateLimits">registerRateLimits</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendFile">sendFile</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendFormatted">sendFormatted</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendJSON">sendJSON</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendReply">sendReply</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.sendStatus">sendStatus</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.shutdown">shutdown</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.startMetrics">startMetrics</a></li><li data-type='method' style='display: none;'><a href="module-api.html#.toParams">toParams</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-app.html">app</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-app.html#.addModule">addModule</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.checkConfig">checkConfig</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.createRepl">createRepl</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.describeArgs">describeArgs</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.init">init</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.isOk">isOk</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.killBackend">killBackend</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.loadModules">loadModules</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.loadPackages">loadPackages</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.mime">mime</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.parseArgs">parseArgs</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.parseConfig">parseConfig</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.processArg">processArg</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.processArgs">processArgs</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.processEnvArgs">processEnvArgs</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.processName">processName</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.runMethods">runMethods</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.setHome">setHome</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.setHost">setHost</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.setLogInspect">setLogInspect</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.shutdown">shutdown</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.sortModules">sortModules</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.start">start</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.startRepl">startRepl</a></li><li data-type='method' style='display: none;'><a href="module-app.html#.watchTmp">watchTmp</a></li></ul><ul class='typedefs'><li data-type='typedef' style='display: none;'><a href="module-app.html#~ConfigOptions">ConfigOptions</a></li></ul></li><li><a href="module-aws.html">aws</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwGetMetricData">aws.cwGetMetricData</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwListMetrics">aws.cwListMetrics</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwPutLogEvents">aws.cwPutLogEvents</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwPutMetricAlarm">aws.cwPutMetricAlarm</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwPutMetricData">aws.cwPutMetricData</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.cwlFilterLogEvents">aws.cwlFilterLogEvents</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbBatchGetItem">aws.ddbBatchGetItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbBatchWriteItem">aws.ddbBatchWriteItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbCreateTable">aws.ddbCreateTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbDeleteItem">aws.ddbDeleteItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbDeleteTable">aws.ddbDeleteTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbDescribeTable">aws.ddbDescribeTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbGetItem">aws.ddbGetItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbPutItem">aws.ddbPutItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbQueryTable">aws.ddbQueryTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbScanTable">aws.ddbScanTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbTransactWriteItems">aws.ddbTransactWriteItems</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbUpdateItem">aws.ddbUpdateItem</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbUpdateTable">aws.ddbUpdateTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbUpdateTimeToLive">aws.ddbUpdateTimeToLive</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.ddbWaitForTable">aws.ddbWaitForTable</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryCW">aws.queryCW</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.queryCWL">aws.queryCWL</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.querySQS">aws.querySQS</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.sqsReceiveMessage">aws.sqsReceiveMessage</a></li><li data-type='method' style='display: none;'><a href="module-aws.html#.aws.sqsSendMessage">aws.sqsSendMessage</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-cache.html">cache</a><ul class='typedefs'></ul></li><li><a href="module-db.html">db</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-db.html#.aadd">aadd</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.abatch">abatch</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.abulk">abulk</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.acopy">acopy</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.acreate">acreate</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.add">add</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.adel">adel</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.adelAll">adelAll</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.adrop">adrop</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aget">aget</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aincr">aincr</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.ajoin">ajoin</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.alist">alist</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.applyPoolOptions">applyPoolOptions</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aput">aput</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aquery">aquery</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.ascan">ascan</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.asearch">asearch</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aselect">aselect</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.asql">asql</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.atransaction">atransaction</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aupdate">aupdate</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aupdateAll">aupdateAll</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.aupgrade">aupgrade</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.batch">batch</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.bulk">bulk</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.cacheColumns">cacheColumns</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.configTypes">configTypes</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.convertError">convertError</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.convertRows">convertRows</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.copy">copy</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.create">create</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.createTables">createTables</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.del">del</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.delAll">delAll</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.describeTables">describeTables</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.drop">drop</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.dropTables">dropTables</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.get">get</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getCached">getCached</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getConfig">getConfig</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getPool">getPool</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getPoolTables">getPoolTables</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getPools">getPools</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.getProcessRows">getProcessRows</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.incr">incr</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.init">init</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.initColumns">initColumns</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.initConfig">initConfig</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.initTables">initTables</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.join">join</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.list">list</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.prepare">prepare</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.prepareColumn">prepareColumn</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.prepareReq">prepareReq</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.prepareRow">prepareRow</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.put">put</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.query">query</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.queryProcessSync">queryProcessSync</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.refreshColumns">refreshColumns</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.runProcessRows">runProcessRows</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.scan">scan</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.search">search</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.select">select</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.setConfig">setConfig</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.setProcessColumns">setProcessColumns</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.setProcessRow">setProcessRow</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sql">sql</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlCacheColumns">sqlCacheColumns</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlColumn">sqlColumn</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlCreate">sqlCreate</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlDelete">sqlDelete</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlDrop">sqlDrop</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlExpr">sqlExpr</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlGet">sqlGet</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlInsert">sqlInsert</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlLimit">sqlLimit</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlPrepare">sqlPrepare</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlQuery">sqlQuery</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlQuote">sqlQuote</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlSelect">sqlSelect</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlTime">sqlTime</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlUpgrade">sqlUpgrade</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlUpgrade">sqlUpgrade</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlValue">sqlValue</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlValueIn">sqlValueIn</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.sqlWhere">sqlWhere</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.transaction">transaction</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.update">update</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.updateAll">updateAll</a></li><li data-type='method' style='display: none;'><a href="module-db.html#.upgrade">upgrade</a></li></ul><ul class='typedefs'><li data-type='typedef' style='display: none;'><a href="module-db.html#~DBColumn">DBColumn</a></li><li data-type='typedef' style='display: none;'><a href="module-db.html#~DBConfigOptions">DBConfigOptions</a></li><li data-type='typedef' style='display: none;'><a href="module-db.html#~DBRequest">DBRequest</a></li><li data-type='typedef' style='display: none;'><a href="module-db.html#~DBRequestOptions">DBRequestOptions</a></li><li data-type='typedef' style='display: none;'><a href="module-db.html#~DBResultCallback">DBResultCallback</a></li><li data-type='typedef' style='display: none;'><a href="module-db.html#~DBTable">DBTable</a></li></ul></li><li></li><li><a href="module-db_elasticsearch.html">db/elasticsearch</a><ul class='typedefs'></ul></li><li><a href="module-events.html">events</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-events.html#.putEvent">putEvent</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-httpGet.html">httpGet</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-httpGet.html#.ahttpGet">ahttpGet</a></li><li data-type='method' style='display: none;'><a href="module-httpGet.html#~httpGet">httpGet</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-ipc.html">ipc</a><ul class='typedefs'></ul></li><li><a href="module-jobs.html">jobs</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-jobs.html#.submitJob">submitJob</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-lib.html">lib</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-lib.html#.base64ToJson">base64ToJson</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.clock">clock</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.configParse">configParse</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.daysInMonth">daysInMonth</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.decodeURIComponent">decodeURIComponent</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.encodeURIComponent">encodeURIComponent</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.entityToText">entityToText</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.escapeUnicode">escapeUnicode</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.fromBase32">fromBase32</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.fromBase62">fromBase62</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.fromBase64url">fromBase64url</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isDST">isDST</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.isTimeRange">isTimeRange</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.jsonFormat">jsonFormat</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.jsonFormatPreset">jsonFormatPreset</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.jsonParse">jsonParse</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.jsonToBase64">jsonToBase64</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.localEpoch">localEpoch</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.now">now</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.parseCookies">parseCookies</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.parseTime">parseTime</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.strftimeMap">strftimeMap</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.stringify">stringify</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.textToEntity">textToEntity</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.textToXml">textToXml</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toAge">toAge</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toBase32">toBase32</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toBase62">toBase62</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toBase64url">toBase64url</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toBool">toBool</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toCamel">toCamel</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toClamp">toClamp</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toDate">toDate</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toDigits">toDigits</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toDuration">toDuration</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toEmail">toEmail</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toFlags">toFlags</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toFormat">toFormat</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toMtime">toMtime</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toNumber">toNumber</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toParams">toParams</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toPrice">toPrice</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toRFC3339">toRFC3339</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toRegexp">toRegexp</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toRegexpMap">toRegexpMap</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toRegexpObj">toRegexpObj</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toSize">toSize</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toString">toString</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toTemplate">toTemplate</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toTitle">toTitle</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toUncamel">toUncamel</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toUrl">toUrl</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toValue">toValue</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.toVersion">toVersion</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.tzName">tzName</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.unescape">unescape</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.unicode2Ascii">unicode2Ascii</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.weekDate">weekDate</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.weekOfYear">weekOfYear</a></li><li data-type='method' style='display: none;'><a href="module-lib.html#.xmlParse">xmlParse</a></li></ul><ul class='typedefs'><li data-type='typedef' style='display: none;'><a href="module-lib.html#.ParamsOptions">ParamsOptions</a></li></ul></li><li><a href="module-logger.html">logger</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-logger.html#.debug">debug</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.dev">dev</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.error">error</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.info">info</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.log">log</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.logger">logger</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.none">none</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.prefix">prefix</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.registerLevel">registerLevel</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.setDebugFilter">setDebugFilter</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.setFile">setFile</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.setLevel">setLevel</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.setOptions">setOptions</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.setSyslog">setSyslog</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.trace">trace</a></li><li data-type='method' style='display: none;'><a href="module-logger.html#.warn">warn</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-logwatcher.html">logwatcher</a><ul class='typedefs'></ul></li><li><a href="module-metrics.html">metrics</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-metrics.html#.toJSON">toJSON</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-modules.html">modules</a><ul class='typedefs'></ul></li><li><a href="module-push.html">push</a><ul class='typedefs'><li data-type='typedef' style='display: none;'><a href="module-push.html#~callback">callback</a></li></ul></li><li><a href="module-queue.html">queue</a><ul class='typedefs'></ul></li><li><a href="module-sendmail.html">sendmail</a><ul class='typedefs'></ul></li><li><a href="module-stats.html">stats</a><ul class='typedefs'></ul></li><li><a href="module-ws.html">ws</a><ul class='typedefs'></ul></li></ul><h3>Classes</h3><ul><li><a href="Counter.html">Counter</a><ul class='typedefs'></ul></li><li><a href="Pool.html">Pool</a><ul class='typedefs'></ul></li><li><a href="WebpushClient.html">WebpushClient</a><ul class='typedefs'></ul></li><li><a href="module-cache.CacheClient.html">CacheClient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#applyOptions">applyOptions</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#clear">clear</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#close">close</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#del">del</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#get">get</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#incr">incr</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#limiter">limiter</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#lock">lock</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#put">put</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#stats">stats</a></li><li data-type='method' style='display: none;'><a href="module-cache.CacheClient.html#unlock">unlock</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-cache.LocalClient.html">LocalClient</a><ul class='typedefs'></ul></li><li><a href="module-cache.RedisClient.html">RedisClient</a><ul class='typedefs'></ul></li><li><a href="module-cache.WorkerClient.html">WorkerClient</a><ul class='typedefs'></ul></li><li><a href="module-db.DBPool.html">DBPool</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#bindValue">bindValue</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#cacheColumns">cacheColumns</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#cacheIndexes">cacheIndexes</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#close">close</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#configure">configure</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#convertError">convertError</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#exists">exists</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#nextToken">nextToken</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#open">open</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#prepare">prepare</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#prepareOptions">prepareOptions</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#prepareRow">prepareRow</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#query">query</a></li><li data-type='method' style='display: none;'><a href="module-db.DBPool.html#shutdown">shutdown</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-db.SqlPool.html">SqlPool</a><ul class='typedefs'></ul></li><li><a href="module-db_elasticsearch.ElasticsearchPool.html">ElasticsearchPool</a><ul class='typedefs'></ul></li><li><a href="module-httpGet.httpGetRequest.html">httpGetRequest</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-httpGet.httpGetRequest.html#parseCookies">parseCookies</a></li><li data-type='method' style='display: none;'><a href="module-httpGet.httpGetRequest.html#toJSON">toJSON</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-queue.EventBridgeClient.html">EventBridgeClient</a><ul class='typedefs'></ul></li><li><a href="module-queue.JSONClient.html">JSONClient</a><ul class='typedefs'></ul></li><li><a href="module-queue.LocalClient.html">LocalClient</a><ul class='typedefs'></ul></li><li><a href="module-queue.NatsClient.html">NatsClient</a><ul class='typedefs'></ul></li><li><a href="module-queue.QueueClient.html">QueueClient</a><ul class='methods'><li data-type='method' style='display: none;'><a href="module-queue.QueueClient.html#channel">channel</a></li><li data-type='method' style='display: none;'><a href="module-queue.QueueClient.html#monitor">monitor</a></li><li data-type='method' style='display: none;'><a href="module-queue.QueueClient.html#schedule">schedule</a></li></ul><ul class='typedefs'></ul></li><li><a href="module-queue.RedisClient.html">RedisClient</a><ul class='typedefs'></ul></li><li><a href="module-queue.SNSClient.html">SNSClient</a><ul class='typedefs'></ul></li><li><a href="module-queue.SQSClient.html">SQSClient</a><ul class='typedefs'></ul></li><li><a href="module-queue.WorkerClient.html">WorkerClient</a><ul class='typedefs'></ul></li></ul><h3>Global</h3><ul><li><a href="global.html#ExponentiallyMovingWeightedAverage">ExponentiallyMovingWeightedAverage</a></li><li><a href="global.html#Meter">Meter</a></li><li><a href="global.html#_skip32table">_skip32table</a></li><li><a href="global.html#lib">lib</a></li><li><a href="global.html#mod">mod</a></li><li><a href="global.html#net">net</a></li><li><a href="global.html#perf_hooks">perf_hooks</a></li><li><a href="global.html#runMethod">runMethod</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">db</h1>
    

    




<section>

<header>
    
        
            
        
            
        
    
</header>

<article>
    
        <div class="container-overview">
        
            

            
                

    

    <h4 class="name" id="module:db"><span class="type-signature"></span>module:db<span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>The Database API, a thin abstraction layer on top of SQLite, PostgreSQL, DynamoDB, Elasticsearch.</p>
<p>The idea is to not introduce a new abstraction layer on top of all databases but to make
the API usable for common use cases.</p>
<p>On the source code level access to all databases will be possible using
this API but any specific usage like SQL queries syntax or data types available only for some databases will not be
unified or automatically converted. Instead it is passed to the database directly.</p>
<p>Only conversion between JavaScript types and
database types is unified to some degree meaning JavaScript data type will be converted into the corresponding
data type supported by any particular database and vice versa.</p>
<p>Basic CRUD operations are supported for all database and modelled after NoSQL usage, this means no SQL joins are supported
by the API, only single table access. SQL joins can be passed as SQL statements directly to the database using low level
<a href="module-db.html#.query">module:db.query</a> API call, all high level operations like add/put/del perform SQL generation for single table on the fly.</p>
<p>The common convention is to pass options object with flags that are common for all drivers along with specific,
this options object can be modified with new properties but all driver should try not to
modify or delete existing properties, so the same options object can be reused in subsequent operations.</p>
<p>All queries and update operations ignore properties that starts with underscore.</p>
<p>Before the DB functions can be used the <code>app.init</code> MUST be called first, the typical usage:</p>
<pre class="prettyprint source lang-js"><code>const { core, db } = require(&quot;backendjs&quot;);
app.init((err) => {
  db.add(...
  ...
});
</code></pre>
<p>All database methods can use default db pool or any other available db pool by using <code>pool: name</code> in the options. If not specified,
then default db pool is used, <code>none</code> is default if no -db-pool config parameter specified in the command line or the config file.</p>
<p>Even if the specified pool does not exist, the default pool will be returned, this allows to pre-confgure the app with different pools
in the code and enable or disable any particular pool at any time.</p>
<p>To use PostgreSQL db pool to get a record and update the current pool:</p>
<pre class="prettyprint source lang-js"><code>db.get(&quot;bk_user&quot;, { login: &quot;123&quot; }, { pool: &quot;pg&quot; }, (err, row) => {
  if (row) db.update(&quot;bk_user&quot;, row);
});
const user = await db.aget(&quot;bk_user&quot;, { login: &quot;123&quot; });
</code></pre>
<p>Most database pools can be configured with options <code>min</code> and <code>max</code> for number of connections to be maintained, so no overload will happen and keep warm connection for
faster responses. Even for DynamoDB which uses HTTPS this can be configured without hitting provisioned limits which will return an error but
put extra requests into the waiting queue and execute once some requests finished.</p>
<pre class="prettyprint source"><code>db-pg-pool-max = 100
db-dynamodb-pool-max = 100
</code></pre>
<p>Also, to spread functionality between different databases it is possible to assign some tables to the specific pools using <code>db-X-pool-tables</code> parameters
thus redirecting the requests to one or another databases depending on the table, this for example can be useful when using fast but expensive
database like DynamoDB for real-time requests and slower SQL database running on some slow instance for rare requests, reports or statistics processing.</p>
<p>To run the backend with default PostgreSQL database but keep all config parametrs in the DynamoDB table for availability:</p>
<pre class="prettyprint source"><code>db-pool = pg
db-dynamodb-pool = default
db-dynamodb-pool-tables = bk_config
</code></pre>
<p>The following databases are supported with the basic db methods: <code>Sqlite, PostgreSQL, DynamoDB, Elasticsearch</code></p>
<p>All public <code>db.get|put|update|del|select|list</code> operations have corresponding promisifed method starting with <code>a</code>, like <code>db.get</code> -&gt; <code>db.aget</code>,...</p>
<p>Multiple pools of the same type can be opened, just add <code>N</code> suffix to all database config parameters where N is a number,
referer to such pools in the code as <code>poolN</code> or by an alias.</p>
<pre class="prettyprint source"><code>db-sqlite1-pool = /path/billing
db-sqlite1-pool-max = 10
db-sqlite1-pool-options = journal_mode:OFF
db-sqlite1-pool-alias = billing
</code></pre>
<p>and in the Javascript:</p>
<pre class="prettyprint source lang-js"><code> db.select(&quot;bills&quot;, { status: &quot;ok&quot; }, { pool: &quot;billing&quot; }, lib.log)
 await db.aselect(&quot;bills&quot;, { status: &quot;ok&quot; }, { pool: &quot;billing&quot; })
</code></pre>
<p>To enable stats collection for a pool it must be explicitly set via config options,
additionally collect stats individually for a list of tables</p>
<pre class="prettyprint source"><code>db-dynamodb-pool-options = metrics:1
db-dynamodb-pool-metrics-tables = bk_config, bk_user
</code></pre></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>roles</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>additional roles to be used for DB config</p></td>
        </tr>

    
    </tbody>
</table>

































            
                




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Shell command interface for <code>bksh</code></p>
<p>This module is supposed to be extended with commands, the format is `shell.cmdNAME``</p>
<p>where <code>NAME</code> is he commnd name in camel case</p>
<p>For example:</p>
<pre class="prettyprint source lang-javascript"><code>const { shell } = require(&quot;backendjs&quot;);
const shell = bkjs.shell;

shell.cmdMyCommand = function(options) { console.log(&quot;hello&quot;); return &quot;continue&quot; }
</code></pre>
<p>Now if i call <code>bksh -my-command</code> it will print hello and launch the repl,
instead of retuning continue if the command must exit just call <code>process.exit()</code></p>
<p>Run <code>bksh -help</code> to see all registered shell commands</p>
<p>Any command may return special string to indicate how to treat the flow:</p>
<ul>
<li>stop - stop processing commands and create REPL</li>
<li>continue - do not exit and continue processing other commands or end with REPL</li>
<li>all other values will result in returning from the run assuming the command will decide what to do, exit or continue running, no REPL is created</li>
<li><code>-noexit</code> - in the command line keep the shell running after executing the command</li>
<li><code>-exit</code> - exit with error if no shell command found</li>
<li><code>-exit-timeout MS</code> - will be set to ms to wait before exit</li>
<li><code>-shell-delay MS</code> - will wait before running the command</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































            
        
        </div>
    

    

    

    
        <h3 class="subsection-title">Classes</h3>

        <dl>
            <dt><a href="module-db.DBPool.html">DBPool</a></dt>
            <dd></dd>
        
            <dt><a href="module-db.SqlPool.html">SqlPool</a></dt>
            <dd></dd>
        </dl>
    

    
        <h3 class="subsection-title">Type Definitions</h3>

        
                
<h4 class="name" id="~DBColumn">DBColumn</h4>





<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Database column definition</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>type</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>column type, supported types:</p>
<ul>
<li><code>int, bigint, log, real, float, number</code> -  numeric types</li>
<li><code>bool, boolean</code> -  stored as boolean type</li>
<li><code>text, string</code> -  text types</li>
<li><code>date, time, timestamp</code> -  Date stored in database supported type, usually as text in SQL</li>
<li><code>mtime</code> -  timestamp in milliseconds</li>
<li><code>clock</code> -  timestamp in nanoseconds</li>
<li><code>json</code> -  stored as JSON text but converted to/from native Javascript objects</li>
<li><code>obj, object</code> -  native JSON object type</li>
<li><code>array</code> -  native JSON array type</li>
<li><code>list, set</code> -  store a list of primitive types, strings and/or numbers</li>
<li><code>random</code> -  generates a random number in <a href="module-db.html#.add">module:db.add</a>/<a href="module-db.html#.put">module:db.put</a> methods</li>
<li><code>ttl</code> -  in add/put save as timestamp in the future to be expired by database (DynamoDB)</li>
<li><code>uuid, suuid, sfuuid</code> -  autogenerate the column value with UUID,
optional <code>prefix</code> property will be prepended, <code>{ type: &quot;uuid&quot;, prefix: &quot;u_&quot; }</code>,
see module:lib.uuid, module:lib.suuid, module:lib.tuuid</li>
<li><code>now</code> -  defines a column to be automatically filled with the current timestamp, <code>{ type: &quot;now&quot; }</code></li>
<li><code>counter</code> -  defines a columns that will be automatically incremented by the <a href="module-db.html#.incr">module:db.incr</a> command, on creation it is set with 0</li>
<li><code>uid</code> -  defines a columns to be automatically filled with the current user id, this assumes that user object is passed in the options from the API level</li>
<li><code>uname</code> -  defines a columns to be automatically filled with the current user name, this assumes that user object is passed in the options from the API level</li>
<li><code>ttl</code> -  mark the column to be auto expired, can be set directly to time in the future or use one of: <code>days</code>, <code>hours</code>, <code>minutes</code> as a interval in the future</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>primary</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>column is part of the primary key, for composite keys the number defines the place starting with 1</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>unique</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>column is part of an unique key, the number defines the order if it is composite key</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>index</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>column is part of an index, the value is a number for the column position in the index</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>uniqueN</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>additonal unique indexes where N is 1..25</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>indexN</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>additonal indexes where N is 1..25</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>foreign_key</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>foreign key reference</p>
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>reference table name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>name</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>reference table primary key</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ondelete</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>action on delete, cascade, ...</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>custom</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>additional SQL statements</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>value</code></td>
            

            <td class="type">
            
                
<span class="param-type">any</span>



            
            </td>

            

            

            <td class="description last"><p>default value for the column</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>len</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>column length (SQL)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>not_null</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>true if should be NOT NULL (SQL)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>not_zero</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>true if should be saved with 0 value</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>auto</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>true for AUTO_INCREMENT column (SQL)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>max</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>ignore the column if a <code>text</code>, <code>json</code> or <code>obj</code> value is greater than specified limit, unless <code>trunc</code> is provided</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>trunc</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>truncate the column value, the value will be truncated before saving into the DB, uses the <code>max</code> as the limit</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>maxlist</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>max number of items in the <code>list</code> or <code>array</code> column types</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pub</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>make a column as public, used by <a href="module-api.html#.sendJSON">module:api.sendJSON</a> in cleanup mode.
<strong>this is very important property because it allows anybody to see it when used with the default API functions, i.e. anybody with valid
credentials can retrieve all public columns from all other tables, and if one of the other tables is user table this may expose some personal information,
so by default only a few columns are marked as public in the <code>bk_user</code> table</strong></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pub_admin</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>a generic read permission requires <code>options.isAdmin</code> when used with <code>api.cleanResult</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pub_staff</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>a generic read permission requires <code>options.isStaff</code> when used with <code>api.cleanResult</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pub_types</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>a role or a list of roles which further restrict access to a public column to only users with specified roles</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>priv_types</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>a role or a list of roles which excplicitely deny access to a column for users with specified roles</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>priv</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>an opposite for the pub property, if defined this property should never be returned to the client by the API handlers</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>internal</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if set then this property can only be updated by admin/root or with `isInternal`` property</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>readonly</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>only add/put operations will use the value, incr/update will not affect the value</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>writeonly</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>only incr/update can change this value, add/put will ignore it</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noresult</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>delete this property from the result, mostly for joined artificial columns which used for indexes only</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>lower</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>make string value lowercase</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>upper</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>make string value uppercase</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>strip</code></td>
            

            <td class="type">
            
                
<span class="param-type">regexp</span>



            
            </td>

            

            

            <td class="description last"><p>if a regexp perform replace on the column value before saving</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>trim</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>strim string value of whitespace</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cap</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>capitalize into a title with lib.toTitle</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>word</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>if a number only save nth word from the value, split by <code>separator</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>clock</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>for <code>now</code> type use high resolution clock in nanoseconds</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>epoch</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>for <code>now</code> type save as seconds since the Epoch, not milliseconds</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>multiplier</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>for numeric columns apply this multipliers before saving</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>increment</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>for numeric columns add this value before saving</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>decimal</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>for numeric columns convert into fixed number using this number of decimals</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>format</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>a function (val, req) =&gt; {} that must return new value for the given column, for custom formatting</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>prefix</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>prefix to be prepended for autogenerated columns: <code>uuid</code>, <code>suuid</code>, <code>sfuuid</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>separator</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>to be used as a separator in join or lists depending on the column properties</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>list</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>splits the column value into an array, uses the <code>separator</code> property</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>not_empty</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>do not allow empty columns, if not provided it is filled with the default value, for SQL same as not_null</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>skip_empty</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>ignore the column if the value is empty, i.e. null or empty string</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>fail_ifempty</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>returtn an error if there is no  value for the column, this is checked during record preprocessing</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;any></span>



            
            </td>

            

            

            <td class="description last"><p>an array with allowed values, ignore the column if not present in the list</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values_map</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;any></span>



            
            </td>

            

            

            <td class="description last"><p>an array of pairs to be checked for exact match and be replaced with the next item, [&quot;&quot;, null, &quot;&quot;, undefined, &quot;null&quot;, &quot;&quot;]
join properties below</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>allow_pools</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>to restrict to specific DB pools only, updates will skip this column if pool is not present</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>a list with property names that must be joined together before performing a db operation,
it will use the given record to produce new property, this will work both ways, to the db and when reading a
record from the db it will split joined property and assign individual
properties the value from the joined value. Empty properties will be still joined as empty strings.
It always uses the original value even if one of the properties has been joined already.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>unjoin</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>split the join column into respective columns on retrieval</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_keep</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>keep the joined column value, if not specified the joined column is deleted after unjoined</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_ops</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>an array with operations for which perform columns join only, if not specified it applies for all operations,
allowed values: <code>add, put, incr, update, del, get, select</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_ifempty</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>only join if the column value is not provided</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_skip</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>can be used to restrict joins, it is a list with columns that should not be joined</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_pools</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>can be an array with pool names which are allowed to do the join, other pools will skip joining this column.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_nopools</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>can be an array with pool names which are not allowed to do the join, other pools will skip joining this column</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_strict</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>can be used to perform join only if all columns in the list are not empty, so the join
is for all columns or none</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_all</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>can be used to proceed and join empty values, without it the any join stops on firtst empty value but
marked to be checked later in case the empty column is not empty anymore in case of uuid or other auto-generated column type.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_force</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>can be used to force the join regardless of the existing value, without it if the existing value contains the
separator it is skipped</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_hash</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>can be used to store a hash of the joined column to reduce the space and make the result value easier to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_cap|join_lower|join_upper</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>convert the joined value with toTitle, lower or upper case</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_process</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>a function(req, value, obj, col) - must return a value to be used, the value is joined already</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>custom</code></td>
            

            <td class="type">
            
                
<span class="param-type">any</span>



            
            </td>

            

            

            <td class="description last"><p>database specific instructions to apply when creating a table or column</p>
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>sql</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>apply for all SQL databases</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>sqlite</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>SQLite specific instructions</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pg</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>PostgreSQL specific instructions</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>dynamodb</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>DynamoDB specific properties</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>elasticsearch</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>Elasticsearch specific properties</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<div class="description usertext">
    <p>Database column definition</p>
</div>



    <h5 class="h5-types">Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>



        </li>
    </ul>






            
                
<h4 class="name" id="~DBConfigOptions">DBConfigOptions</h4>





<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Common options for the pools that customize behaviour</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>upgrade</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>perform alter table instead of create</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>typesMap</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>type mapping, convert lowercase type into other type supported by any specific database</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noDefaults</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>ignore default value if not supported (Cassandra)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noNulls</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>NOT NULL restriction is not supported (Cassandra)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noMultiSQL</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>return as a list, the driver does not support multiple SQL commands</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noLengths</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>ignore column length for columns (Cassandra)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noIfExists</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>do not support IF EXISTS on table or indexes</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noCompositeIndex</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>does not support composite indexes (Cassandra)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noAuto</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>no support for auto increment columns</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>skipNull</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>object with operations which dont support null(empty) values</p></td>
        </tr>

    
    </tbody>
</table>






<div class="description usertext">
    <p>Common options for the pools that customize behaviour</p>
</div>








            
                
<h4 class="name" id="~DBRequest">DBRequest</h4>





<dl class="details">
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>op</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>DB operation, one of get, put, incr, update, select, ...</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pool</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>a DB pool used for this operation</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>a DB table name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>text</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            

            <td class="description last"><p>native DB query, SQL or etc...</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>obj</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>a query object</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>an object with optional properties for the operation</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>keys</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>a list of table primary keys</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>custom</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>an object for custom columns</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>columns</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>an object with table's columns</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>column</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>returns a column object by name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>now</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>timestamp when this is created, ms</p></td>
        </tr>

    
    </tbody>
</table>








    <h5 class="h5-types">Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>



        </li>
    </ul>






            
                
<h4 class="name" id="~DBRequestOptions">DBRequestOptions</h4>





<dl class="details">
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>may have the following properties:</p>
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>pool</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>name of the database pool where to execute this query.
The difference with the high level functions that take a table name as their firt argument, this function must use pool
explicitely if it is different from the default. Other functions can resolve
the pool by table name if some tables are assigned to any specific pool by configuration parameters <code>db-pool-tables</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>filterrows</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>function to filter rows not to be included in the result, returns a new result set, args are: function(req, rows)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>processrows</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>function to process rows in the result, returns a new result, args are: function(req, rows), this result will be put in cache
if requested so this may be used for preparing cached results, it must return an array</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>processasync</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>function to process result rows via async callback, return a new result in the callback, the function is: function(req, rows, callback),
the callback is function(err, rows)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>syncMode</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>skip columns preprocessing and dynamic values for pool sync and backup restore</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>logger_db</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>log results at the end with this level or <code>debug</code> by default</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>logger_error</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>log errors with this level instead  of <code>error</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>logger_error</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>a log level to report about the errors, default is 'error', if an object it can specify different log levels by err.code, * is default level for not matched codes</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ignore_error</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>
|

<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>clear errors occurred as it never happen, do not report in the log, if an array then only matched codes will be cleared</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noprocessrows</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if true then skip post processing result rows, return the data as is, this will result in returning combined columns as it is</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noconvertrows</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if true skip converting the data from the database format into Javascript data types, it uses column definitions</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>nopreparerow</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if true skip row preparation and columns processing, the req.obj is passed as is, useful for syncing between pools
for the table to convert values returned from the db into the the format defined by the column</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>total</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if true then it is supposed to return only one record with property <code>count</code>, skip all post processing and convertion</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>info_obj</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>to return the record just processed in the info object as <code>obj</code> property, it will include all generated and updated columns</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>result_obj</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>to return the query record as result including all post processing and new generated columns, this is not what <code>returning</code> property does, it only
returns the query record with new columns from memory</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>keep_req</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>on return do not clear out the request object, by default all properties are deleted to free up memory</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>keep_obj</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>only preserve op, obj, table properties in the reqest after return</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cached</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if true then run getCached version directly</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>nocache</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>disable caching even if configured for the table</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ops</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>operators to use for comparison for properties, an object with column name and operator.
Common operators are, some databases may support other specific ops:</p>
<pre class="prettyprint source lang->,"><code>between, match, regexp, iregexp, begins_with, not_begins_with, ends_with, not_ends_with,
like, like%, ilike%, contains, not_contains```</code></pre></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>opsMap</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>operator mapping between supplied operators and actual operators supported by the db</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>typesMap</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>type mapping between supplied and actual column types, an object</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>select</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>a list of columns or expressions to return or all columns if not specified, only existing columns will be returned</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>select_all</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>a list of columns or expressions to return, passed as is to the underlying driver</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>start</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>start records with this primary key, this is the next_token passed by the previous query</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>count</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>how many records to return</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>first</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>a convenient option to return the first record from the result or null (similar to <code>db.get</code> method)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>last</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>similar to first but return last record</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>how to join condition expressions, default is AND</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>joinOps</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>operators to use to combine several expressions in case when an array of values is given, supports `and|or|AND|OR``</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>sort</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>sort by this column. if null then no sorting must be done at all, records will be returned in the order they are kept in the DB.
<em>NOTE: For DynamoDB this may affect the results if columns requsted are not projected in the index, with sort
<code>select</code> property might be used to get all required properties. For Elasticsearch if sort is null then scrolling scan will be used,
if no <code>timeout</code> or <code>scroll</code> are given the default is 1m.</em></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>sort_timeout</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>for pagination how long to keep internal state in millisecons, depends on the DB, for example for Elasticsearch it corresponds
to the scroll param and defaults to 60000 (1m)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>desc</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if sorting, do in descending order</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>page</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>starting page number for pagination, uses count to find actual record to start, for SQL databases mostly</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>unique</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>specified the column name to be used in determining unique records, if for some reasons there are multiple records in the location
table for the same id only one instance will be returned</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cacheKey</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>exlicit key for caching, return from the cache or from the DB and then cache it with this key, works the same as <code>get</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cacheKeyName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>a name of one of the cache keys to use, it must be defined by a <code>db-cache-keys-table-name</code> parameter</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>aliases</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>an object with mapping between artificial name to real column name, useful in or_$/and_$ conditions with same column but different values,
alternative is to append aliases with <em>$, like name</em>$ or name_$$, the name must be a valid column name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>custom_columns</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>an array of pairs to define global or artificial columns, the format is: [ RegExp, type, ...], useful with aliases</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>no_columns</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>do not check for actual columns defined in the pool tables and add all properties from the obj, only will work for NoSQL dbs,
by default all properties in the obj not described in the table definition for the given table will be ignored.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>skip_columns</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>ignore properties by name listed in the this array, the most use case is to skip autogeneratd columns like &quot;now&quot;</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>








    <h5 class="h5-types">Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>



        </li>
    </ul>






            
                

    

    <h4 class="name" id="~DBResultCallback"><span class="type-signature"></span>DBResultCallback<span class="signature">(err, rows, info)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>This callback is called by all DB methods</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>err</code></td>
            

            <td class="type">
            
                
<span class="param-type">Error</span>



            
            </td>

            

            

            <td class="description last"><p>and error object or null i fno errors</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>rows</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;object></span>



            
            </td>

            

            

            <td class="description last"><p>a list of result rows, in case of error it is an empty list</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>info</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>an object with information about the last query:</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>inserted_oid</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>new generated ID</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>affected_rows</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>how many rows were affected by this operation</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>next_token</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>next to ken to pass for pagination</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>consumed_capacity</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>DynamoDB specific about capacity consumed</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>























            
                
<h4 class="name" id="~DBTable">DBTable</h4>





<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Database table object, each property represents a column</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>name1</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBColumn</span>



            
            </td>

            

            

            <td class="description last"><p>column1</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>name2</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBColumn</span>



            
            </td>

            

            

            <td class="description last"><p>column2</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>...</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBColumn</span>



            
            </td>

            

            

            <td class="description last"><p>more columns</p></td>
        </tr>

    
    </tbody>
</table>






<div class="description usertext">
    <p>Database table object, each property represents a column</p>
</div>



    <h5 class="h5-types">Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>



        </li>
    </ul>






            
    
    
    

     

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="~args"><span class="type-signature type-signature-inner">(inner) </span>args<span class="type-signature"> :Array.&lt;ConfigOptions></span></h4>





<dl class="details">
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>







    <h5 class="h5-types">Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Array.&lt;ConfigOptions></span>



        </li>
    </ul>






        
            
<h4 class="name" id="~bk_config"><span class="type-signature type-signature-inner, constant">(inner, constant) </span>bk_config<span class="type-signature"></span></h4>





<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Config table schema</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <p>Config table schema</p>
</div>








        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    <h4 class="name" id=".aadd"><span class="type-signature type-signature-static">(static) </span>aadd<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.add</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data, info } = await db.aadd("bk_user", { id: '123', login: 'admin', name: 'test' })</code></pre>





        
            

    

    <h4 class="name" id=".abatch"><span class="type-signature type-signature-static">(static) </span>abatch<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.batch</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".abulk"><span class="type-signature type-signature-static">(static) </span>abulk<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.bulk</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".acopy"><span class="type-signature type-signature-static">(static) </span>acopy<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.copy</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".acreate"><span class="type-signature type-signature-static">(static) </span>acreate<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.create</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".add"><span class="type-signature type-signature-static">(static) </span>add<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Insert new object into the database
Note: SQL, DynamoDB drivers are fully atomic but other drivers may be subject to race conditions</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an actual record to be updated, primary key properties must be specified</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.add("bk_user", { id: '123', login: 'admin', name: 'test' }, (err, rows, info) => {
 });</code></pre>





        
            

    

    <h4 class="name" id=".adel"><span class="type-signature type-signature-static">(static) </span>adel<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.del</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, info } = db.adel("bk_user", { login: '123' });
console.log('deleted:', info.affected_rows);</code></pre>





        
            

    

    <h4 class="name" id=".adelAll"><span class="type-signature type-signature-static">(static) </span>adelAll<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.delAll</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".adrop"><span class="type-signature type-signature-static">(static) </span>adrop<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.drop</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".aget"><span class="type-signature type-signature-static">(static) </span>aget<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.get</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data } = await db.aget("bk_user", { login: '12345' });</code></pre>





        
            

    

    <h4 class="name" id=".aincr"><span class="type-signature type-signature-static">(static) </span>aincr<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.incr</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data, info } = await db.aincr("bk_counter", { id: '123', like0: 1, invite0: 1 })</code></pre>





        
            

    

    <h4 class="name" id=".ajoin"><span class="type-signature type-signature-static">(static) </span>ajoin<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.join</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".alist"><span class="type-signature type-signature-static">(static) </span>alist<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.list</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data } = db.alist("bk_user", ["id1", "id2"]);
console.log(data);</code></pre>





        
            

    

    <h4 class="name" id=".applyPoolOptions"><span class="type-signature type-signature-static">(static) </span>applyPoolOptions<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Apply a config parameter to live DB pool, used in config args <code>update</code> callback to make a config value live</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".aput"><span class="type-signature type-signature-static">(static) </span>aput<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.put</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data } = await db.aput("bk_user", { id: '123', login: 'test', name: 'test' })</code></pre>





        
            

    

    <h4 class="name" id=".aquery"><span class="type-signature type-signature-static">(static) </span>aquery<span class="signature">(req, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {Promise}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of <a href="module-db.html#.query">module:db.query</a> with the same parameters,
no exceptions are raised or reject, only resolve is called with an object <code>{ err, data, info }</code></p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>req</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequest</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>
















<h5 class="h5-returns">Returns:</h5>

        


<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>



    </dd>
</dl>

    




    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data } = await db.aquery({ text: "SELECT ....." }, { pool: "sqlite" });</code></pre>





        
            

    

    <h4 class="name" id=".ascan"><span class="type-signature type-signature-static">(static) </span>ascan<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.scan</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".asearch"><span class="type-signature type-signature-static">(static) </span>asearch<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.search</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".aselect"><span class="type-signature type-signature-static">(static) </span>aselect<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.select</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data } = await db.aselect("bk_user", { type: 'admin' });</code></pre>





        
            

    

    <h4 class="name" id=".asql"><span class="type-signature type-signature-static">(static) </span>asql<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.sql</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".atransaction"><span class="type-signature type-signature-static">(static) </span>atransaction<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.transaction</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".aupdate"><span class="type-signature type-signature-static">(static) </span>aupdate<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.update</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data, info } = await db.aupdate("bk_user", { login: 'test', name: 'Test')
 if (!err &amp;&amp; !info?.affected_rows) logger.error("no updates")</code></pre>





        
            

    

    <h4 class="name" id=".aupdateAll"><span class="type-signature type-signature-static">(static) </span>aupdateAll<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.updateAll</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".aupgrade"><span class="type-signature type-signature-static">(static) </span>aupgrade<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.upgrade</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".batch"><span class="type-signature type-signature-static">(static) </span>batch<span class="signature">(list`)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Perform a batch of operations at the same time, all operations for the same table will be run
together one by one but different tables will be updated in parallel.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>list`</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>an array of objects to get/put/delete from the database in the format:</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.op</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    <code>add</code>
                
                </td>
            

            <td class="description last"><p>is one of get, add, incr, put, update, del</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.table</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>which table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.obj</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>an object with data</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.options</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>params for the operation, optional</p>
<ul>
<li>options can have the following:</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.concurrency</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>number of how many operations to run at the same time, 1 means sequential</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.no_errors</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>will stop on first error, because operations will be run in parallel some operations still may be performed</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.factorCapacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>a capacity factor to apply to the write capacity if present, by default it is used write capacity at 100%</p>
<p>On return the second arg to the callback is a list of records with errors as the input record with added property <code>errstatus</code> and <code>errmsg</code>,
for get ops the result will be retrieved record if exists.</p>
<p>One advantage using this with <code>op: get</code> over <a href="module-db.html#.list">module:db.list</a> is caching,
<a href="module-db.html#.get">module:db.get</a> may use both local and remote caches but db.list always hits the database.</p></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>var ops = [ { table: "bk_counter", obj: { id:1, like:1 } },
             { op: "put", table: "bk_user", obj: { login: "test", id:1, name:"test" }]
 db.batch(ops, { factorCapacity: 0.5 }, lib.log);</code></pre>





        
            

    

    <h4 class="name" id=".bulk"><span class="type-signature type-signature-static">(static) </span>bulk<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Bulk operations, it will be noop if the driver does not support it.
The input format is the same as for the <code>db.batch</code> method.</p>
<p>On return the second arg to the callback is a list of records with errors, same input record with added property <code>errstatus</code> and <code>errmsg</code></p>
<p>NOTE: DynamoDB only supports add/put/del only and 25 at a time, if more specified it will send multiple batches</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>var ops = [ { table: "bk_counter", obj: { id:1, like:1 } },
            { op: "del", table: "bk_user", obj: { login: "test1" } },
            { op: "incr", table: "bk_counter", obj: { id:2, like:1 } },
            { table: "bk_user", obj: { login: "test2", id:2, name:"test2" } }]
db.bulk(ops, { pool: "elasticsearch" }, lib.log);</code></pre>





        
            

    

    <h4 class="name" id=".cacheColumns"><span class="type-signature type-signature-static">(static) </span>cacheColumns<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Reload all columns into the cache for the pool, options can be a pool name or an object like <code>{ pool: name }</code>.
if <code>tables</code> property is an arary it asks to refresh only specified tables if that is possible.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".configTypes"><span class="type-signature type-signature-static">(static) </span>configTypes<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build a list of all config types we want to retrieve, based on the <code>db-config-map</code> parameters that defines which fields to use for config types.</p>
<ul>
<li>for each <code>top</code> item it create a mix of all main items below</li>
<li>for each <code>main</code> item it creates a mix of all `other`` items</li>
</ul>
<p>top... -&gt; each of top-main... -&gt; each of top-main-other...</p>
<p>Most common config parameters: runMode, appName, role, roles, tag, region</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>top is runMode(prod), main is role(shell),tag(local), other is region(none)
 - prod
 - prod-shell
 - prod-shell-none
 - prod-local
 - prod-local-none</code></pre>





        
            

    

    <h4 class="name" id=".convertError"><span class="type-signature type-signature-static">(static) </span>convertError<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Convert native database error in some generic human readable string</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".convertRows"><span class="type-signature type-signature-static">(static) </span>convertRows<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Convert rows returned by the database into the Javascript format or into the format
defined by the table columns.
The following special properties in the column definition chnage the format:</p>
<ul>
<li>
<p>type = json - if a column type is json and the value is a string returned will be converted into a Javascript object</p>
</li>
<li>
<p>dflt property is defined for a json type and record does not have a value it will be set to specified default value</p>
</li>
<li>
<p>list - split the value into an array, optional .separator property can be specified</p>
</li>
<li>
<p>unjoin - a true value or a list of names, it produces new properties by splitting the value by a separator and assigning pieces to
separate properties using names from the list, this is the opposite of the <code>join</code> property and is used separately if
splitting is required, if joined properties already in the record then no need to split it. If not a list
the names are used form the join property.</p>
<p>Example:
db.describeTables([ { user: { id: {}, name: {}, pair: { join: [&quot;left&quot;,&quot;right&quot;], unjoin: 1 } } ]);</p>
<pre><code>      db.put(&quot;test&quot;, { id: &quot;1&quot;, type: &quot;user&quot;, name: &quot;Test&quot;, left: &quot;123&quot;, right: &quot;000&quot; })
      db.select(&quot;test&quot;, {}, lib.log)
</code></pre>
</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".copy"><span class="type-signature type-signature-static">(static) </span>copy<span class="signature">(table, query, options<span class="signature-attributes">opt</span>, callback<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Copy records from one table to another between different DB pools or regions
Returns stats how many copied or errors</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>name of the table to copy</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>a query condition for the table</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>sort</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>index to use for query</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>minCapacity</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>capacity minimum for read/writes, it will override actual DB capacity</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>factorCapacity</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>factor the actual capacity for reads/writes</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>stopOnError</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>stop the copy on first DB error, otherwise ignore errors</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>region</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>other region where to copy</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>sourcePool</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>original pool, default if not provided</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pool</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>other DB pool</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>file</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>dump the data into a file as JSON</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>preprocess</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>a function(table, row, options) to be called before the update, if it returns true the record will be skipped</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>posprocess</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>a function(table, row, options, next) to be called after the record is copied, for recursive or joined cases</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>reget</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if set the actual record will read using db.get, for cases when db.scan returns only partial record as in DynamoDB cases with indexes</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>incremental</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if set, try to read the latest record in the other table and continue from there, uses <code>sort</code> index in desc order</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>batch</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>a number of records to copy at once using the bulk operation</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>syncMode</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if set enabled the update mode in which all values are preserved and not pre-processed, default is 1</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>queryOptions</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>pass options to scan operations</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>updateOptions</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>pass options to update/bulk operations</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBResultCallback</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>























        
            

    

    <h4 class="name" id=".create"><span class="type-signature type-signature-static">(static) </span>create<span class="signature">(table, schema, options<span class="signature-attributes">opt</span>, callback)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Create a table using column definitions represented as a list of objects. Each column definition may
contain the following properties:</p>
<p>Some properties may be defined multiple times with number suffixes like: <code>unique1, unique2, index1, index2</code> to create more than one index for the table, same
properties define a composite key in the order of definition or sorted by the property value, for example: <code>{ a: { index:2 }, b: { index:1 } }</code> will create index (b,a)
because of the <code>index:</code> property value being not the same. If all index properties are set to 1 then a composite index will use the order of the properties.*</p>
<p>NOTE: Index creation is not required and all index properties can be omitted, it can be done more effectively using native tools for any specific database,
this format is for simple and common use cases without using any other tools but it does not cover all possible variations for every database. But all indexes and
primary keys created outside of the backend application will be detected properly by <a href="module-db.html#.cacheColumns">module:db.cacheColumns</a> and by each pool <code>cacheIndexes</code> methods.</p>
<p>Each database pool also can support native options that are passed directly to the driver in the options, these properties are
defined in the object with the same name as the db driver, all properties are combined, for example to define provisioned throughput for the DynamoDB index:</p>
<p>DynmamoDB:</p>
<p>To create a DynamoDB table with global secondary index, the first index property if not the same as primary key hash defines global index, if it is the same then local,
or if the second key column contains <code>global</code> property then it is a global index as well, below we create global secondary index on property 'name' only,
in the example above it was local secondary index for id and name. Also a local secondary index is created on <code>id,title</code>.</p>
<p>DynamoDB projection is defined by a <code>projections</code> property, can be a number/boolean or an array with index numbers for regular columns
but the hash property can provide its own projections for whole index at once, can be ALL or a list of attributes.</p>
<p>When using real DynamoDB creating a table may take some time, for such cases if <code>options.waitTimeout</code> is not specified it defaults to 1min,
so the callback is called as soon as the table is active or after the timeout whichever comes first.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>schema</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBTable</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an object with table schema</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBConfigOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>options for the database driver</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>response handler</p></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.create("test_table", {
     id: { primary: 1, type: "int", index: 1, custom: { dynamodb: { readCapacity: 50, writeCapacity: 50 } } },
     type: { primary: 2, pub: 1, projections: 1 },
     name: { index: 1, pub: 1 } }
 });

 db.create("test_table", {
     id: { primary: 1, type: "int", index1: 1 },
     type: { primary: 2, projections: [0] },
     name: { index: 1, projections: 1 },
     title: { index1: 1, projections: [1] } },
     descr: { index: 2, projections: [0, 1] },
 });</code></pre>





        
            

    

    <h4 class="name" id=".createTables"><span class="type-signature type-signature-static">(static) </span>createTables<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Create or upgrade the tables for the given pool</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".del"><span class="type-signature type-signature-static">(static) </span>del<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Delete an object in the database, no error if the object does not exist</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>object with column values</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.del("bk_user", { login: '123' }, (err, rows, info) => {
    console.log('deleted:', info.affected_rows);
 });</code></pre>





        
            

    

    <h4 class="name" id=".delAll"><span class="type-signature type-signature-static">(static) </span>delAll<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Delete all records that match given condition, one by one, the input is the same as for <code>db.select</code> and every record
returned will be deleted using <code>db.del</code> call. The callback will receive on completion the err and all rows found and deleted.
Special properties that can be in the options for this call:</p>
<ul>
<li>ops - query operations to retrieve records to be deleted</li>
<li>count - how many matching records to delete</li>
<li>delScan - if true force to use db.scan instead of native <code>delAll</code> for the given pool</li>
<li>delOptions - options to be passed to the db.del if needed, this is useful so select and del options will not be mixed up</li>
<li>delCollect - if true return all deleted rows in the callback, oherwise just the number of rows deleted</li>
<li>factorCapacity - write capqcity factor for delete operations, default is 0.35</li>
<li>concurrency - how many delete requests to execute at the same time by using lib.forEachLimit.</li>
<li>ignore_error - continue deleting records even after an error</li>
<li>delProcess - a function callback that will be called for each row before deleting it, this is for some transformations of the record properties
in case of complex columns that may contain concatenated values as in the case of using DynamoDB. The callback will be called
as <code>options.delProcess(row, options, info)</code>. If it returns non-empty value the scan will stop and return it as the error.</li>
<li>delFilter - a function that must return something to the callback in order to skip the current record. <code>options.delFilter(row, options, (skip) =&gt; {})</code></li>
<li>batch - delete using bulk operations, all functions must accept an array of rows instead</li>
</ul>
<p>If no <code>options.select</code> is specified only the primary keys will be returned or collected</p>
<p>If <code>db-skip-drop</code> matches the table name and there is no query provided it will exit with error</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".describeTables"><span class="type-signature type-signature-static">(static) </span>describeTables<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Define new tables or extend/customize existing tables. Table definitions are used with every database operation,
on startup, the backend read all existing table columns from the database and cache them in the memory but some properties
like public columns are only specific to the backend so to mark such columns the table with such properties must be described
using this method. Only columns with changed properties need to be specified, other columns will be left as it is.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.describeTables({
             bk_user: { name: { pub: 1 },
                        test: { id: { primary: 1, type: "int" },
                        name: { pub: 1, index: 1 }
         }});</code></pre>





        
            

    

    <h4 class="name" id=".drop"><span class="type-signature type-signature-static">(static) </span>drop<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Drop a table</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".dropTables"><span class="type-signature type-signature-static">(static) </span>dropTables<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Delete all specified tables from the specific pool or all active pools if <code>options.pool</code> is empty, <code>tables</code> can be a list of tables or an
object with table definitions</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".get"><span class="type-signature type-signature-static">(static) </span>get<span class="signature">(table, query, options<span class="signature-attributes">opt</span>, callback)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Retrieve one record from the database by primary key, returns found record or null if not found</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to read</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an object with primary key(s)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBResultCallback</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>NOTE: On return the <code>info.cached</code> will be set to</p>
<ul>
<li>1 if retrieved from top level cache</li>
<li>2 if retrieved from level 2 cache</li>
<li>0 if retrieved from db and put in the cache</li>
</ul></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.get("bk_user", { login: '12345' }, function(err, row) {
   if (row) console.log(row.name);
});</code></pre>





        
            

    

    <h4 class="name" id=".getCached"><span class="type-signature type-signature-static">(static) </span>getCached<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Retrieve cached result or put a record into the cache prefixed with table:key[:key...]
Options accept the same parameters as for the usual get action but it is very important that all the options
be the same for every call, especially <code>select</code> parameters which tells which columns to retrieve and cache.
Additional options:</p>
<ul>
<li>prefix - prefix to be used for the key instead of table name</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.getCached("get", "bk_user", { login: req.query.login }, { select: "latitude,longitude" }, function(err, row) {
     var distance = lib.geoDistance(req.query.latitude, req.query.longitude, row.latitude, row.longitudde);
 });</code></pre>





        
            

    

    <h4 class="name" id=".getConfig"><span class="type-signature type-signature-static">(static) </span>getConfig<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return all config records for the given instance, the result will be sorted most relevant at the top</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".getPool"><span class="type-signature type-signature-static">(static) </span>getPool<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return database pool by name or default pool, options can be a pool name or an object with { pool: name } to return
the pool by given name. This call always returns a valid pool object, in case no requested pool found, it returns
the default pool, in case of invalid pool name it returns <code>none</code> pool.
A special pool <code>none</code> always returns empty result and no errors.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".getPoolTables"><span class="type-signature type-signature-static">(static) </span>getPoolTables<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return all tables know to the given pool, returned tables are in the object with
column information merged from cached columns from the database with description columns
given by the application. If <code>options.names</code> is 1 then return just table names as a list.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".getPools"><span class="type-signature type-signature-static">(static) </span>getPools<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return a list of all active database pools, returns list of objects with name: and type: properties</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".getProcessRows"><span class="type-signature type-signature-static">(static) </span>getProcessRows<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Returns a list of hooks to be used for processing rows for the given table</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".incr"><span class="type-signature type-signature-static">(static) </span>incr<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Counter operation, increase or decrease column values, similar to update but all specified columns except primary
key will be incremented, use negative value to decrease the value.
If no <code>options.updateOps</code> object specified or no 'incr' operations are provided then
all columns with type 'counter' will be used for the action <code>incr</code></p>
<p><em>Note: The record must exist already for SQL databases, for DynamoDB and Cassandra a new record will be created
if does not exist yet.</em> To disable upsert pass <code>noupsert</code> in the options.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an actual record to be updated, primary key properties must be specified</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.incr("bk_counter", { id: '123', like0: 1, invite0: 1 }, (err, rows, info) => {
  });</code></pre>





        
            

    

    <h4 class="name" id=".init"><span class="type-signature type-signature-static">(static) </span>init<span class="signature">(callback)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Initialize all database pools. the options may containt the following properties:</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options.createTables</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>if true then create new tables or upgrade tables with new columns</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>























        
            

    

    <h4 class="name" id=".initColumns"><span class="type-signature type-signature-static">(static) </span>initColumns<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Merge cached columns into tables</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".initConfig"><span class="type-signature type-signature-static">(static) </span>initConfig<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Load configuration from the config database, must be configured with <code>db-config</code> pointing to the database pool where bk_config table contains
configuration parameters.</p>
<p>The priority of the parameters goes from the most broad to the most specific, most specific always wins, this allows
for very flexible configuration policies defined by the app or place where instances running and separated by the run mode.
See `db.getConfigTypes`` for more details.</p>
<p>The options takes the following properties:</p>
<ul>
<li>force - if true then force to refresh and reopen all db pools</li>
<li>table - a table where to read the config parameters, default is bk_config</li>
</ul>
<p>Do not create/upgrade tables and indexes when reloading the config, this is to
avoid situations when maintenance is being done and any process reloading the config may
create indexes/columns which are not missing but being provisioned or changed.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".initTables"><span class="type-signature type-signature-static">(static) </span>initTables<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Merge all tables from all modules</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".join"><span class="type-signature type-signature-static">(static) </span>join<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Join the given list of records with the records from other table by primary key.
The properties from the joined table will be merged with the original rows preserving the existing properties</p>
<ul>
<li>options.keys defines custom primary key to use instead of table's primary key</li>
<li>options.keysMap - an object that defines which property should be used for a key in the given rows, this is
for cases when actual primary keys in the table are different from the rows properties.</li>
<li>options.columnsMap - save properties with a different name using this mapping object</li>
<li>options.existing is 1 then return only joined records.</li>
<li>options.override - joined table properties will replace the original table existing properties</li>
<li>options.attach - specifies a property name which will be used to attach joined record to the original record, no merging will occur, for
non-existing records an empty object will be attached</li>
<li>options.incr can be a list of property names that need to be summed up with each other, not overriden</li>
<li>options.nomerge - do not merge lists, just return new rows as is</li>
</ul>
<p>A special case when table is empty <code>db.join</code> just returns same rows to the callback, this is
for convenience of doing joins on some conditions and trigger it by setting the table name or skip the join completely.</p>
<p>Example:</p>
<pre><code>     db.join(&quot;bk_user&quot;, [{id:&quot;123&quot;,key1:1},{id:&quot;234&quot;,key1:2}], lib.log)
     db.join(&quot;bk_user&quot;, [{aid:&quot;123&quot;,key1:1},{aid:&quot;234&quot;,key1:2}], { keysMap: { id: &quot;aid&quot; }}, lib.log)
     db.join(&quot;bk_user&quot;, [{id:&quot;123&quot;,state:&quot;NY&quot;},{id:&quot;234&quot;,state:&quot;VA&quot;}], { columnsMap: { state: &quot;astate&quot; }}, lib.log)
</code></pre></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".list"><span class="type-signature type-signature-static">(static) </span>list<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Convenient helper to retrieve all records by primary key, the obj must be a list with key property or a string with list of primary key column</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>
|

<span class="param-type">Array.&lt;object></span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>list of records</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.list("bk_user", ["id1", "id2"], (err, rows) => { console.log(err, rows) });
 db.list("bk_user", "id1,id2", (err, rows) => { console.log(err, rows) });</code></pre>





        
            

    

    <h4 class="name" id=".prepare"><span class="type-signature type-signature-static">(static) </span>prepare<span class="signature">()</span><span class="type-signature"> &rarr; {DBRequest}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Prepare for execution for the given operation: add, del, put, update,...
Returns prepared object to be passed to the driver's .query method.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>

























<h5 class="h5-returns">Returns:</h5>

        
<div class="param-desc">
    <ul>
<li>a request object</li>
</ul>
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">DBRequest</span>



    </dd>
</dl>

    







        
            

    

    <h4 class="name" id=".prepareColumn"><span class="type-signature type-signature-static">(static) </span>prepareColumn<span class="signature">()</span><span class="type-signature"> &rarr; {object}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Prepare a column for an operation, convert aliases, types and ops according to the request and pool mapping</p>
<p>The op in the name after _$ takes precedence over the options.ops</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>

























<h5 class="h5-returns">Returns:</h5>

        
<div class="param-desc">
    <ul>
<li>an object with final column details: { name, type, op, value, join }</li>
</ul>
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">object</span>



    </dd>
</dl>

    




    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>{ name_$contains: "cat" } // means use the `contains` op for the column `name`</code></pre>





        
            

    

    <h4 class="name" id=".prepareReq"><span class="type-signature type-signature-static">(static) </span>prepareReq<span class="signature">()</span><span class="type-signature"> &rarr; {DBRequest}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Prepare a DB request object with required properties</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>

























<h5 class="h5-returns">Returns:</h5>

        
<div class="param-desc">
    <ul>
<li>a request object</li>
</ul>
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">DBRequest</span>



    </dd>
</dl>

    







        
            

    

    <h4 class="name" id=".prepareRow"><span class="type-signature type-signature-static">(static) </span>prepareRow<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Preprocess an object for a given operation, convert types, assign defaults...</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".put"><span class="type-signature type-signature-static">(static) </span>put<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Add/update an object in the database, if object already exists it will be replaced with all new properties from the obj</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an actual record to be updated, primary key properties must be specified</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.put("bk_user", { id: '123', login: 'test', name: 'test' }, function(err, rows, info) {
 });</code></pre>





        
            

    

    <h4 class="name" id=".query"><span class="type-signature type-signature-static">(static) </span>query<span class="signature">(req, options<span class="signature-attributes">opt</span>, callback<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Execute query using native database driver, the query is passed directly to the driver.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>req</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequest</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an object with request required data</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>optional properties customizations</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBResultCallback</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>an error or result</p></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.query({ text: "SELECT a.id,c.type FROM bk_user a,bk_icon c WHERE a.id=c.id and a.id=?", values: ['123'] }, { pool: 'pg' }, (err, rows, info) => {
    ...
});</code></pre>





        
            

    

    <h4 class="name" id=".queryProcessSync"><span class="type-signature type-signature-static">(static) </span>queryProcessSync<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Post process hook to be used for replicating records to another pool, this is supposed to be used as this:</p>
<p>The conditions when to use it is up to the application logic.</p>
<p>It does not deal with the destination pool to be overloaded, all errors will be ignored, this is for simple and light load only</p>
<p>The destination poll must have tables to be synced configured:</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db-elasticsearch-pool-tables=table1,table2
db.setProcessRow("post", "*", (req, row) => { db.queryProcessSync("elasticsearch", req, row) });</code></pre>





        
            

    

    <h4 class="name" id=".refreshColumns"><span class="type-signature type-signature-static">(static) </span>refreshColumns<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Refresh columns for all pools which need it</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".runProcessRows"><span class="type-signature type-signature-static">(static) </span>runProcessRows<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Run registered pre- or post- process callbacks.</p>
<ul>
<li><code>type</code> is one of the <code>pre</code> or 'post`</li>
<li><code>table</code> - the table to run the hooks for, usually the same as req.table but can be '*' for global hooks</li>
<li><code>req</code> is the original db request object with the following required properties: <code>op, table, obj, options, info</code>,</li>
<li><code>rows</code> is the result rows for post callbacks and the same request object for pre callbacks.</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".scan"><span class="type-signature type-signature-static">(static) </span>scan<span class="signature">(rowCallback, endCallback<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Convenient helper for scanning a table for some processing, rows are retrieved in batches and passed to the callback until there are no more
records matching given criteria. The obj is the same as passed to the <code>db.select</code> method which defined a condition which records to get.
The rowCallback must be present and is called for every row or batch retrieved and second parameter which is the function to be called
once the processing is complete. At the end, the callback will be called just with 1 argument, err, this indicates end of scan operation.
Basically, db.scan is the same as db.select but can be used to retrieve large number of records in batches and allows async processing of such records.
To hint a driver that scanning is in progress the <code>options.scanning</code> will be set to true.</p>
<p>Parameters:</p>
<ul>
<li>table - table to scan</li>
<li>query - an object with query conditions, same as in <code>db.select</code></li>
<li>options - same as in <code>db.select</code>, with the following additions:</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options.count</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>size of every batch, default is 100</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.limit</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>total number of records to scan</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.start</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>the primary key to start the scan from</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.search</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>use search instead of select, for ElasticSearch,...</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.batch</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>if true rowCallback will be called with all rows from the batch, not every row individually, batch size is defined by the count property</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.sync</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>as batch mode but the rowCallback is called synchronously as <code>rowCallback(row, info)</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.concurrency</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>how many rows to process at the same time, if not given process sequentially</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.noscan</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>if 1 no scan will be performed if no primary keys are specified</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.emptyscan</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>if 0 no empty scan will be performed when no table columns in the query to be used as a filter</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.fullscan</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>if 1 force to scan full table without using any primary key conditons, use all query properties for all records (DynamoDB)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.useCapacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>triggers to use specific capacity, default is <code>read</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.factorCapacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>a factor to apply for the read capacity limit and triggers the capacity check usage, default is <code>0.9</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.tableCapacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>use a different table for capacity throttling instead of the <code>table</code>, useful for cases when the row callback performs
writes into that other table and capacity is different</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.capacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>a full capacity object to pass to select calls</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>rowCallback</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>process records when called like this `callback(rows, next, info)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>endCallback</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBResultCallback</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>end of scan when called like this: `callback(err)</p></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>// Copy all users from one db into another
  db.scan("bk_user", {}, { count: 10, pool: "dynamodb" }, (row, next) => {
     db.add("bk_user", row, { pool: "pg" }, next);
  }, (err) => { });</code></pre>





        
            

    

    <h4 class="name" id=".search"><span class="type-signature type-signature-static">(static) </span>search<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Perform full text search on the given table, the database implementation may ignore table name completely
in case of global text index.</p>
<p>Query in general is a text string with the format that is supported by the underlying driver,
the db module <em>DOES NOT PARSE</em> the query at all if the driver supports full text search, otherwise it behaves like <code>select</code>.</p>
<p>Options make take the same properties as in the <code>select</code> method.</p>
<p>A special query property <code>q</code> may be used for generic search in all fields.</p>
<p>Without full text search support in the driver this may return nothing or an error.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.search("bk_user", { type: "admin", q: "john*" }, { pool: "elasticsearch" }, lib.log);
 db.search("bk_user", "john*", { pool: "elasticsearch" }, lib.log);
 await db.asearch("bk_user", "john*", { pool: "elasticsearch" });</code></pre>





        
            

    

    <h4 class="name" id=".select"><span class="type-signature type-signature-static">(static) </span>select<span class="signature">(table, query, options<span class="signature-attributes">opt</span>, callback)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Select objects from the database that match supplied conditions.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to read</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an object with properties for the condition, all matching records will be returned.
Columns may contain deep property path can be used as well, like <code>prop.subprop</code>,
the top level column must be defined to work, this is for DBs that support JSON objects like DymamoDB, Elasticsearch.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBResultCallback</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>// get by primary key

db.select("bk_message", { id: '123' }, { count: 2 }, (err, rows) => {  });

// async version
const rows = await db.aselect("bk_message", { id: '123' }, { count: 2 });

// get all icons with type greater or equal to 2

db.select("bk_icon", { id: '123', type: '2' }, { select: 'id,type', ops: { type: 'ge' } }, (err, rows) => { });

// get unread msgs sorted by time, recent first

db.select("bk_message", { id: '123', status: 'N:' }, { sort: "status", desc: 1, ops: { status: "begins_with" } }, (err, rows) => { });

// scan users with custom filter, not by primary key: by exact zipcode

db.select("bk_user", { zipcode: '20000' }, (err, rows) => { });

// select users by type for the last day

db.select("bk_user", { type: 'admin', mtime: Date.now()-86400000 }, { ops: { type: "contains", mtime: "gt" } }, (err, rows) => { });

// select users by JSON sub property using Elasticsearch

db.select("bk_user", { "settings.status": "ok" }, { pool: "elasticsearch" }, (err, rows) => { });</code></pre>





        
            

    

    <h4 class="name" id=".setConfig"><span class="type-signature type-signature-static">(static) </span>setConfig<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Update and create a DB config record for the given name/type, updates the last record only</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".setProcessColumns"><span class="type-signature type-signature-static">(static) </span>setProcessColumns<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Add a callback to be called after each cache columns event, it will be called for each pool separately.
The callback to be called may take options argument and it is called in the context of the pool.</p>
<p>The primary goal for this hook is to allow management of the existing tables which are not own by the
backendjs application. For such tables, because we have not created them, we need to define column properties
after the fact and to keep column definitions in the app for such cases is not realistic. This callback will
allow to handle such situations and can be used to set necessary propeties to the table columns.</p>
<p>Example, a few public columns, allow an admin to see all the columns</p>
<pre><code>    db.setProcessColumns(function() {
        var cols = db.getColumns(&quot;users&quot;, { pool: this.name });
        for (var p in  cols) {
            if ([&quot;id&quot;,&quot;name&quot;].indexOf(p) &gt; -1) cols[p].pub = 1; else cols[p].admin = 1;
        }
    })
</code></pre></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".setProcessRow"><span class="type-signature type-signature-static">(static) </span>setProcessRow<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Assign a processRow callback for a table, this callback will be called for every row on every result being retrieved from the
specified table thus providing an opportunity to customize the result.</p>
<p>type defines at what time the callback will be called:</p>
<ul>
<li><code>pre</code> - making a request to the db on the query record</li>
<li><code>post</code> - after the request finished to be called on the result rows</li>
</ul>
<p>All assigned callback to this table will be called in the order of the assignment.</p>
<p>The callback accepts 2 arguments: function(req, row)
where:</p>
<ul>
<li><code>req</code> - the original request for a db operation with required
<ul>
<li><code>op</code> - current db operation, like add, put, ....</li>
<li><code>table</code> -  current table being updated</li>
<li><code>obj</code> - the record with data</li>
<li><code>pool</code> - current request db pool name</li>
<li><code>options</code> - current request db options</li>
<li><code>info</code> - an object returned with special properties like affected_rows, next_token, only passed to the <code>post</code> callbacks</li>
</ul>
</li>
<li><code>row</code> - a row from the result</li>
</ul>
<p>When producing complex properties by combining other properties it needs to be synchronized using both pre and post
callbacks to keep the record consistent.</p>
<p><strong>For queries returning rows, if the callback returns true for a row it will be filtered out and not included in the final result set.</strong></p>
<p>Example</p>
<pre><code> db.setProcessRow(&quot;post&quot;, &quot;bk_user&quot;, (req, row) =&gt; {
     if (row.birthday) row.age = Math.floor((Date.now() - lib.toDate(row.birthday))/(86400000*365));
 });

 db.setProcessRow(&quot;post&quot;, &quot;icons&quot;, (req, row) =&gt; {
     if (row.type == &quot;private&quot; &amp;&amp; row.id != req.options.user.id) return true;
 });
</code></pre></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sql"><span class="type-signature type-signature-static">(static) </span>sql<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Execute arbitrary SQL-like statement if the pool supports it, values must be an Array with query parameters or can be omitted.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.sql("SELECT * FROM bk_property WHERE value=? LIMIT 1", [1], { pool: "sqlite", count: 10 }, lib.log)
 db.sql("SELECT * FROM bk_property", { pool: "dynamodb" }, lib.log)
 db.sql("SELECT * FROM bk_property", { pool: "dynamodb", count: 10 }, lib.log)</code></pre>





        
            

    

    <h4 class="name" id=".sqlCacheColumns"><span class="type-signature type-signature-static">(static) </span>sqlCacheColumns<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Cache columns using the information_schema</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlColumn"><span class="type-signature type-signature-static">(static) </span>sqlColumn<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return properly quoted column name if it is a keyword</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlCreate"><span class="type-signature type-signature-static">(static) </span>sqlCreate<span class="signature">(pool, req)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Create SQL table using table definition</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>pool</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>database pool</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>req</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequest</span>



            
            </td>

            

            

            <td class="description last"><p>request object</p></td>
        </tr>

    
    </tbody>
</table>























        
            

    

    <h4 class="name" id=".sqlDelete"><span class="type-signature type-signature-static">(static) </span>sqlDelete<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL statement for delete</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlDrop"><span class="type-signature type-signature-static">(static) </span>sqlDrop<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Create SQL DROP TABLE statement</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlExpr"><span class="type-signature type-signature-static">(static) </span>sqlExpr<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL expressions for the column and value
options may contain the following properties:</p>
<ul>
<li>op - SQL operator, default is =</li>
<li>type - can be data, string, number, float, expr, default is string</li>
<li>value - default value to use if passed value is null or empty</li>
<li>min, max - are used for numeric values for validation of ranges</li>
<li>expr - for op=expr, contains sprintf-like formatted expression to be used as is with all '%s' substituted with actual value</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlGet"><span class="type-signature type-signature-static">(static) </span>sqlGet<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Get one object from the database,
options may define the following properties:</p>
<ul>
<li>select is list of columns or expressions to return</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlInsert"><span class="type-signature type-signature-static">(static) </span>sqlInsert<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL insert statement</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlLimit"><span class="type-signature type-signature-static">(static) </span>sqlLimit<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL orderby/limit/offset conditions, config can define defaults for sorting and paging</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlPrepare"><span class="type-signature type-signature-static">(static) </span>sqlPrepare<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Prepare SQL statement for the given operation</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlQuery"><span class="type-signature type-signature-static">(static) </span>sqlQuery<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Execute a SQL statements</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlQuote"><span class="type-signature type-signature-static">(static) </span>sqlQuote<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Quote value to be used in SQL expressions</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlSelect"><span class="type-signature type-signature-static">(static) </span>sqlSelect<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Select object from the database,
options may define the following properties:</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>req.options.select</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>is list of columns or expressions to return</p></td>
        </tr>

    
    </tbody>
</table>























        
            

    

    <h4 class="name" id=".sqlTime"><span class="type-signature type-signature-static">(static) </span>sqlTime<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return time formatted for SQL usage as ISO, if no date specified returns current time</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlUpgrade"><span class="type-signature type-signature-static">(static) </span>sqlUpgrade<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Create ALTER TABLE ADD COLUMN statements for missing columns</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlUpgrade"><span class="type-signature type-signature-static">(static) </span>sqlUpgrade<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL statement for update</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlValue"><span class="type-signature type-signature-static">(static) </span>sqlValue<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return properly quoted value to be used directly in SQL expressions, format according to the type</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlValueIn"><span class="type-signature type-signature-static">(static) </span>sqlValueIn<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return list in format to be used with SQL IN ()</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlWhere"><span class="type-signature type-signature-static">(static) </span>sqlWhere<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL where condition from the keys and object values, returns SQL statement to be used in WHERE</p>
<ul>
<li>query - properties for the condition, in case of an array the primary keys for IN condition will be used only,
a property named or$ or and$ will be treated as a sub-expression if it is an object. Add a number if need multiple OR/AND conditions like
or$$, or$$,...</li>
<li>options may contains the following properties:
<ul>
<li>pool - pool to be used for driver specific functions</li>
<li>ops - an object for comparison operators for primary key, default is equal operator</li>
<li>aliases - an object with column aliases, for cases when more than one time the same column mut be used</li>
</ul>
</li>
<li>join - how to join all expressions, default is AND</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".transaction"><span class="type-signature type-signature-static">(static) </span>transaction<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Same as the <code>db.bulk</code> but in transaction mode, all operations must succeed or fail. Not every driver can support it,
in DynamoDB case only 10 operations can be done at the same time, if the list is larger then it will be sequentially run with batches of 25 records.</p>
<p>In case of error the second arg will contain the records of the failed batch</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".update"><span class="type-signature type-signature-static">(static) </span>update<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Update existing object in the database.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an actual record to be updated, primary key properties must be specified</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>ops</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>object for comparison operators for primary key, default is equal operator</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>opsMap</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>operator mapping into supported by the database</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>typesMap</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>type mapping for properties to be used in the condition</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>aliases</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>an object to map column aliases in the query in case the same column is used ultiple times</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>expected</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>an object with the condition for the update, it is used in addition to the primary keys condition from the <code>obj</code>,
a property named $or/$and will be treated as a sub-expression if it is an object. For multiple OR/AND use
$$or, $$$or,...</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>expectedJoin</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>how to join expected expressions: OR, AND, default is AND</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>upsert</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>create a new record if it does not exist</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>syncMode</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>skip columns preprocessing and dynamic values for pool sync and backup restore</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>updateOps</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>an object with column names and operations to be performed on the named column</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>incr</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>increment by given value</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>add</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>add an item to the list</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>del</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>remove an item from the list</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>set</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>to update as it is, for reseting counters forexample</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>concat</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>concatenate given value, for strings if the database supports it</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>append</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>append to the list of values, only for lists if the database supports it</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>prepend</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>insert at the beginning of the list, depends on the database</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>not_exists</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>only update if not exists or null</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>typesOps</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>an object that defines updateOps operation by column type, for example <code>typesOps: { list: &quot;add&quot; }</code> will
make sure all lists will have updateOps set as add if not specified explicitly</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.update("bk_user", { login: 'test', id: '123' }, (err, rows, info) => {
   console.log('updated:', info.affected_rows);
 });

 db.update("bk_user", { login: 'test', id: '123', first_name: 'Mr' }, { pool: pg' }, (err, rows, info) => {
    console.log('updated:', info.affected_rows);
 });

 db.update("bk_user", { login: 'test', first_name: 'John' }, { expected: { first_name: "Carl" } }, (err, rows, info) => {
    console.log('updated:', info.affected_rows);
 });

 db.update("bk_user", { login: 'test', first_name: 'John' }, { expected: { or$: { first_name: "Carl", g1: null }, aliases: { g1: "first_name" } }, (err, rows, info) => {
    console.log('updated:', info.affected_rows);
 });</code></pre>





        
            

    

    <h4 class="name" id=".updateAll"><span class="type-signature type-signature-static">(static) </span>updateAll<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Update all records that match given condition in the <code>query</code>, one by one, the input is the same as for <code>db.select</code> and every record
returned will be updated using <code>db.update</code> call by the primary key, so make sure options.select include the primary key for every row found by the select.</p>
<p>All properties from the <code>obj</code> will be set in every matched record.</p>
<p>The callback will receive on completion the err and all rows found and updated. This is mostly for non-SQL databases and for very large range it may take a long time
to finish due to sequential update every record one by one.
Special properties that can be in the options for this call:</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options.select</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>select columns, if not specified only the primary keys will be returned or collected</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.updateOptions</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>options to be passed to the db.update if needed, this is useful so select and update options will not be mixed up</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.updateCollect</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>if true return all updated rows in the callback otherwise just the number of updated rows</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.factorCapacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>write capacity factor for update operations, default is 0.25</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.op</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>by default it uses db.update but the <code>op</code> can be set to <code>put</code> or <code>add</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.updateProcess</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>a function callback that will be called for each row before updating it, this is for some transformations of the record properties
in case of complex columns that may contain concatenated values as in the case of using DynamoDB. The callback will be called
as <code>options.updateProcess(row, options)</code>. If it returns non-empty value the update will stop and return it as the error.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.updateFilter</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>a function that must return something to the callback in order to skip the current record. <code>options.updateFilter(row, options, (skip) =&gt; {})</code></p></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>// update birthday format if not null

 db.updateAll("bk_user",
     { birthday: 1 },
     { mtime: Date.now() },
     { ops: { birthday: "not null" },
     updateProcess: function(r, o) {
        r.birthday = lib.strftime(new Date(r.birthday, "%Y-%m-D"));
     },
     updateFilter: function(r, o, cb) {
       cb(r.status == 'ok');
  } }, (err, count) => {
    console.log(count, "rows updated");
  });</code></pre>





        
            

    

    <h4 class="name" id=".upgrade"><span class="type-signature type-signature-static">(static) </span>upgrade<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Upgrade a table with missing columns from the definition list, if after the upgrade new columns must be re-read from the database
then <code>info.affected_rows</code> must be non zero.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
    

    
</article>

</section>







<section>

<header>
    
        
            
        
            
        
    
</header>

<article>
    
        <div class="container-overview">
        
            
                <div class="description usertext"><p>Shell command interface for <code>bksh</code></p>
<p>This module is supposed to be extended with commands, the format is `shell.cmdNAME``</p>
<p>where <code>NAME</code> is he commnd name in camel case</p>
<p>For example:</p>
<pre class="prettyprint source lang-javascript"><code>const { shell } = require(&quot;backendjs&quot;);
const shell = bkjs.shell;

shell.cmdMyCommand = function(options) { console.log(&quot;hello&quot;); return &quot;continue&quot; }
</code></pre>
<p>Now if i call <code>bksh -my-command</code> it will print hello and launch the repl,
instead of retuning continue if the command must exit just call <code>process.exit()</code></p>
<p>Run <code>bksh -help</code> to see all registered shell commands</p>
<p>Any command may return special string to indicate how to treat the flow:</p>
<ul>
<li>stop - stop processing commands and create REPL</li>
<li>continue - do not exit and continue processing other commands or end with REPL</li>
<li>all other values will result in returning from the run assuming the command will decide what to do, exit or continue running, no REPL is created</li>
<li><code>-noexit</code> - in the command line keep the shell running after executing the command</li>
<li><code>-exit</code> - exit with error if no shell command found</li>
<li><code>-exit-timeout MS</code> - will be set to ms to wait before exit</li>
<li><code>-shell-delay MS</code> - will wait before running the command</li>
</ul></div>
            

            
                

    

    <h4 class="name" id="module:db"><span class="type-signature"></span>module:db<span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>The Database API, a thin abstraction layer on top of SQLite, PostgreSQL, DynamoDB, Elasticsearch.</p>
<p>The idea is to not introduce a new abstraction layer on top of all databases but to make
the API usable for common use cases.</p>
<p>On the source code level access to all databases will be possible using
this API but any specific usage like SQL queries syntax or data types available only for some databases will not be
unified or automatically converted. Instead it is passed to the database directly.</p>
<p>Only conversion between JavaScript types and
database types is unified to some degree meaning JavaScript data type will be converted into the corresponding
data type supported by any particular database and vice versa.</p>
<p>Basic CRUD operations are supported for all database and modelled after NoSQL usage, this means no SQL joins are supported
by the API, only single table access. SQL joins can be passed as SQL statements directly to the database using low level
<a href="module-db.html#.query">module:db.query</a> API call, all high level operations like add/put/del perform SQL generation for single table on the fly.</p>
<p>The common convention is to pass options object with flags that are common for all drivers along with specific,
this options object can be modified with new properties but all driver should try not to
modify or delete existing properties, so the same options object can be reused in subsequent operations.</p>
<p>All queries and update operations ignore properties that starts with underscore.</p>
<p>Before the DB functions can be used the <code>app.init</code> MUST be called first, the typical usage:</p>
<pre class="prettyprint source lang-js"><code>const { core, db } = require(&quot;backendjs&quot;);
app.init((err) => {
  db.add(...
  ...
});
</code></pre>
<p>All database methods can use default db pool or any other available db pool by using <code>pool: name</code> in the options. If not specified,
then default db pool is used, <code>none</code> is default if no -db-pool config parameter specified in the command line or the config file.</p>
<p>Even if the specified pool does not exist, the default pool will be returned, this allows to pre-confgure the app with different pools
in the code and enable or disable any particular pool at any time.</p>
<p>To use PostgreSQL db pool to get a record and update the current pool:</p>
<pre class="prettyprint source lang-js"><code>db.get(&quot;bk_user&quot;, { login: &quot;123&quot; }, { pool: &quot;pg&quot; }, (err, row) => {
  if (row) db.update(&quot;bk_user&quot;, row);
});
const user = await db.aget(&quot;bk_user&quot;, { login: &quot;123&quot; });
</code></pre>
<p>Most database pools can be configured with options <code>min</code> and <code>max</code> for number of connections to be maintained, so no overload will happen and keep warm connection for
faster responses. Even for DynamoDB which uses HTTPS this can be configured without hitting provisioned limits which will return an error but
put extra requests into the waiting queue and execute once some requests finished.</p>
<pre class="prettyprint source"><code>db-pg-pool-max = 100
db-dynamodb-pool-max = 100
</code></pre>
<p>Also, to spread functionality between different databases it is possible to assign some tables to the specific pools using <code>db-X-pool-tables</code> parameters
thus redirecting the requests to one or another databases depending on the table, this for example can be useful when using fast but expensive
database like DynamoDB for real-time requests and slower SQL database running on some slow instance for rare requests, reports or statistics processing.</p>
<p>To run the backend with default PostgreSQL database but keep all config parametrs in the DynamoDB table for availability:</p>
<pre class="prettyprint source"><code>db-pool = pg
db-dynamodb-pool = default
db-dynamodb-pool-tables = bk_config
</code></pre>
<p>The following databases are supported with the basic db methods: <code>Sqlite, PostgreSQL, DynamoDB, Elasticsearch</code></p>
<p>All public <code>db.get|put|update|del|select|list</code> operations have corresponding promisifed method starting with <code>a</code>, like <code>db.get</code> -&gt; <code>db.aget</code>,...</p>
<p>Multiple pools of the same type can be opened, just add <code>N</code> suffix to all database config parameters where N is a number,
referer to such pools in the code as <code>poolN</code> or by an alias.</p>
<pre class="prettyprint source"><code>db-sqlite1-pool = /path/billing
db-sqlite1-pool-max = 10
db-sqlite1-pool-options = journal_mode:OFF
db-sqlite1-pool-alias = billing
</code></pre>
<p>and in the Javascript:</p>
<pre class="prettyprint source lang-js"><code> db.select(&quot;bills&quot;, { status: &quot;ok&quot; }, { pool: &quot;billing&quot; }, lib.log)
 await db.aselect(&quot;bills&quot;, { status: &quot;ok&quot; }, { pool: &quot;billing&quot; })
</code></pre>
<p>To enable stats collection for a pool it must be explicitly set via config options,
additionally collect stats individually for a list of tables</p>
<pre class="prettyprint source"><code>db-dynamodb-pool-options = metrics:1
db-dynamodb-pool-metrics-tables = bk_config, bk_user
</code></pre></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>roles</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>additional roles to be used for DB config</p></td>
        </tr>

    
    </tbody>
</table>

































            
                




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Shell command interface for <code>bksh</code></p>
<p>This module is supposed to be extended with commands, the format is `shell.cmdNAME``</p>
<p>where <code>NAME</code> is he commnd name in camel case</p>
<p>For example:</p>
<pre class="prettyprint source lang-javascript"><code>const { shell } = require(&quot;backendjs&quot;);
const shell = bkjs.shell;

shell.cmdMyCommand = function(options) { console.log(&quot;hello&quot;); return &quot;continue&quot; }
</code></pre>
<p>Now if i call <code>bksh -my-command</code> it will print hello and launch the repl,
instead of retuning continue if the command must exit just call <code>process.exit()</code></p>
<p>Run <code>bksh -help</code> to see all registered shell commands</p>
<p>Any command may return special string to indicate how to treat the flow:</p>
<ul>
<li>stop - stop processing commands and create REPL</li>
<li>continue - do not exit and continue processing other commands or end with REPL</li>
<li>all other values will result in returning from the run assuming the command will decide what to do, exit or continue running, no REPL is created</li>
<li><code>-noexit</code> - in the command line keep the shell running after executing the command</li>
<li><code>-exit</code> - exit with error if no shell command found</li>
<li><code>-exit-timeout MS</code> - will be set to ms to wait before exit</li>
<li><code>-shell-delay MS</code> - will wait before running the command</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































            
        
        </div>
    

    

    

    
        <h3 class="subsection-title">Classes</h3>

        <dl>
            <dt><a href="module-db.DBPool.html">DBPool</a></dt>
            <dd></dd>
        
            <dt><a href="module-db.SqlPool.html">SqlPool</a></dt>
            <dd></dd>
        </dl>
    

    
        <h3 class="subsection-title">Type Definitions</h3>

        
                
<h4 class="name" id="~DBColumn">DBColumn</h4>





<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Database column definition</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>type</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>column type, supported types:</p>
<ul>
<li><code>int, bigint, log, real, float, number</code> -  numeric types</li>
<li><code>bool, boolean</code> -  stored as boolean type</li>
<li><code>text, string</code> -  text types</li>
<li><code>date, time, timestamp</code> -  Date stored in database supported type, usually as text in SQL</li>
<li><code>mtime</code> -  timestamp in milliseconds</li>
<li><code>clock</code> -  timestamp in nanoseconds</li>
<li><code>json</code> -  stored as JSON text but converted to/from native Javascript objects</li>
<li><code>obj, object</code> -  native JSON object type</li>
<li><code>array</code> -  native JSON array type</li>
<li><code>list, set</code> -  store a list of primitive types, strings and/or numbers</li>
<li><code>random</code> -  generates a random number in <a href="module-db.html#.add">module:db.add</a>/<a href="module-db.html#.put">module:db.put</a> methods</li>
<li><code>ttl</code> -  in add/put save as timestamp in the future to be expired by database (DynamoDB)</li>
<li><code>uuid, suuid, sfuuid</code> -  autogenerate the column value with UUID,
optional <code>prefix</code> property will be prepended, <code>{ type: &quot;uuid&quot;, prefix: &quot;u_&quot; }</code>,
see module:lib.uuid, module:lib.suuid, module:lib.tuuid</li>
<li><code>now</code> -  defines a column to be automatically filled with the current timestamp, <code>{ type: &quot;now&quot; }</code></li>
<li><code>counter</code> -  defines a columns that will be automatically incremented by the <a href="module-db.html#.incr">module:db.incr</a> command, on creation it is set with 0</li>
<li><code>uid</code> -  defines a columns to be automatically filled with the current user id, this assumes that user object is passed in the options from the API level</li>
<li><code>uname</code> -  defines a columns to be automatically filled with the current user name, this assumes that user object is passed in the options from the API level</li>
<li><code>ttl</code> -  mark the column to be auto expired, can be set directly to time in the future or use one of: <code>days</code>, <code>hours</code>, <code>minutes</code> as a interval in the future</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>primary</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>column is part of the primary key, for composite keys the number defines the place starting with 1</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>unique</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>column is part of an unique key, the number defines the order if it is composite key</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>index</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>column is part of an index, the value is a number for the column position in the index</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>uniqueN</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>additonal unique indexes where N is 1..25</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>indexN</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>additonal indexes where N is 1..25</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>foreign_key</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>foreign key reference</p>
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>reference table name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>name</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>reference table primary key</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ondelete</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>action on delete, cascade, ...</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>custom</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>additional SQL statements</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>value</code></td>
            

            <td class="type">
            
                
<span class="param-type">any</span>



            
            </td>

            

            

            <td class="description last"><p>default value for the column</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>len</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>column length (SQL)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>not_null</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>true if should be NOT NULL (SQL)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>not_zero</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>true if should be saved with 0 value</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>auto</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>true for AUTO_INCREMENT column (SQL)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>max</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>ignore the column if a <code>text</code>, <code>json</code> or <code>obj</code> value is greater than specified limit, unless <code>trunc</code> is provided</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>trunc</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>truncate the column value, the value will be truncated before saving into the DB, uses the <code>max</code> as the limit</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>maxlist</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>max number of items in the <code>list</code> or <code>array</code> column types</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pub</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>make a column as public, used by <a href="module-api.html#.sendJSON">module:api.sendJSON</a> in cleanup mode.
<strong>this is very important property because it allows anybody to see it when used with the default API functions, i.e. anybody with valid
credentials can retrieve all public columns from all other tables, and if one of the other tables is user table this may expose some personal information,
so by default only a few columns are marked as public in the <code>bk_user</code> table</strong></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pub_admin</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>a generic read permission requires <code>options.isAdmin</code> when used with <code>api.cleanResult</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pub_staff</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>a generic read permission requires <code>options.isStaff</code> when used with <code>api.cleanResult</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pub_types</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>a role or a list of roles which further restrict access to a public column to only users with specified roles</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>priv_types</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>a role or a list of roles which excplicitely deny access to a column for users with specified roles</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>priv</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>an opposite for the pub property, if defined this property should never be returned to the client by the API handlers</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>internal</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if set then this property can only be updated by admin/root or with `isInternal`` property</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>readonly</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>only add/put operations will use the value, incr/update will not affect the value</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>writeonly</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>only incr/update can change this value, add/put will ignore it</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noresult</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>delete this property from the result, mostly for joined artificial columns which used for indexes only</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>lower</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>make string value lowercase</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>upper</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>make string value uppercase</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>strip</code></td>
            

            <td class="type">
            
                
<span class="param-type">regexp</span>



            
            </td>

            

            

            <td class="description last"><p>if a regexp perform replace on the column value before saving</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>trim</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>strim string value of whitespace</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cap</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>capitalize into a title with lib.toTitle</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>word</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>if a number only save nth word from the value, split by <code>separator</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>clock</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>for <code>now</code> type use high resolution clock in nanoseconds</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>epoch</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>for <code>now</code> type save as seconds since the Epoch, not milliseconds</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>multiplier</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>for numeric columns apply this multipliers before saving</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>increment</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>for numeric columns add this value before saving</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>decimal</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>for numeric columns convert into fixed number using this number of decimals</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>format</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>a function (val, req) =&gt; {} that must return new value for the given column, for custom formatting</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>prefix</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>prefix to be prepended for autogenerated columns: <code>uuid</code>, <code>suuid</code>, <code>sfuuid</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>separator</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>to be used as a separator in join or lists depending on the column properties</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>list</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>splits the column value into an array, uses the <code>separator</code> property</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>not_empty</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>do not allow empty columns, if not provided it is filled with the default value, for SQL same as not_null</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>skip_empty</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>ignore the column if the value is empty, i.e. null or empty string</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>fail_ifempty</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>returtn an error if there is no  value for the column, this is checked during record preprocessing</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;any></span>



            
            </td>

            

            

            <td class="description last"><p>an array with allowed values, ignore the column if not present in the list</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>values_map</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;any></span>



            
            </td>

            

            

            <td class="description last"><p>an array of pairs to be checked for exact match and be replaced with the next item, [&quot;&quot;, null, &quot;&quot;, undefined, &quot;null&quot;, &quot;&quot;]
join properties below</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>allow_pools</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>to restrict to specific DB pools only, updates will skip this column if pool is not present</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>a list with property names that must be joined together before performing a db operation,
it will use the given record to produce new property, this will work both ways, to the db and when reading a
record from the db it will split joined property and assign individual
properties the value from the joined value. Empty properties will be still joined as empty strings.
It always uses the original value even if one of the properties has been joined already.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>unjoin</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>split the join column into respective columns on retrieval</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_keep</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>keep the joined column value, if not specified the joined column is deleted after unjoined</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_ops</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>an array with operations for which perform columns join only, if not specified it applies for all operations,
allowed values: <code>add, put, incr, update, del, get, select</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_ifempty</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>only join if the column value is not provided</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_skip</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>can be used to restrict joins, it is a list with columns that should not be joined</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_pools</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>can be an array with pool names which are allowed to do the join, other pools will skip joining this column.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_nopools</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>can be an array with pool names which are not allowed to do the join, other pools will skip joining this column</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_strict</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>can be used to perform join only if all columns in the list are not empty, so the join
is for all columns or none</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_all</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>can be used to proceed and join empty values, without it the any join stops on firtst empty value but
marked to be checked later in case the empty column is not empty anymore in case of uuid or other auto-generated column type.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_force</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>can be used to force the join regardless of the existing value, without it if the existing value contains the
separator it is skipped</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_hash</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>can be used to store a hash of the joined column to reduce the space and make the result value easier to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_cap|join_lower|join_upper</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>convert the joined value with toTitle, lower or upper case</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join_process</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>a function(req, value, obj, col) - must return a value to be used, the value is joined already</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>custom</code></td>
            

            <td class="type">
            
                
<span class="param-type">any</span>



            
            </td>

            

            

            <td class="description last"><p>database specific instructions to apply when creating a table or column</p>
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>sql</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>apply for all SQL databases</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>sqlite</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>SQLite specific instructions</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pg</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>PostgreSQL specific instructions</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>dynamodb</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>DynamoDB specific properties</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>elasticsearch</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>Elasticsearch specific properties</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>






<div class="description usertext">
    <p>Database column definition</p>
</div>



    <h5 class="h5-types">Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>



        </li>
    </ul>






            
                
<h4 class="name" id="~DBConfigOptions">DBConfigOptions</h4>





<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Common options for the pools that customize behaviour</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>upgrade</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>perform alter table instead of create</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>typesMap</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>type mapping, convert lowercase type into other type supported by any specific database</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noDefaults</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>ignore default value if not supported (Cassandra)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noNulls</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>NOT NULL restriction is not supported (Cassandra)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noMultiSQL</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>return as a list, the driver does not support multiple SQL commands</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noLengths</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>ignore column length for columns (Cassandra)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noIfExists</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>do not support IF EXISTS on table or indexes</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noCompositeIndex</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>does not support composite indexes (Cassandra)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noAuto</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>no support for auto increment columns</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>skipNull</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>object with operations which dont support null(empty) values</p></td>
        </tr>

    
    </tbody>
</table>






<div class="description usertext">
    <p>Common options for the pools that customize behaviour</p>
</div>








            
                
<h4 class="name" id="~DBRequest">DBRequest</h4>





<dl class="details">
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>op</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>DB operation, one of get, put, incr, update, select, ...</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pool</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>a DB pool used for this operation</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>a DB table name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>text</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                
                </td>
            

            

            <td class="description last"><p>native DB query, SQL or etc...</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>obj</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>a query object</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>an object with optional properties for the operation</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>keys</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>a list of table primary keys</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>custom</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>an object for custom columns</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>columns</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>an object with table's columns</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>column</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>returns a column object by name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>now</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            
                <td class="attributes">
                

                
                </td>
            

            

            <td class="description last"><p>timestamp when this is created, ms</p></td>
        </tr>

    
    </tbody>
</table>








    <h5 class="h5-types">Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>



        </li>
    </ul>






            
                
<h4 class="name" id="~DBRequestOptions">DBRequestOptions</h4>





<dl class="details">
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>may have the following properties:</p>
                <h6>Properties</h6>

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>pool</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>name of the database pool where to execute this query.
The difference with the high level functions that take a table name as their firt argument, this function must use pool
explicitely if it is different from the default. Other functions can resolve
the pool by table name if some tables are assigned to any specific pool by configuration parameters <code>db-pool-tables</code>.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>filterrows</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>function to filter rows not to be included in the result, returns a new result set, args are: function(req, rows)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>processrows</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>function to process rows in the result, returns a new result, args are: function(req, rows), this result will be put in cache
if requested so this may be used for preparing cached results, it must return an array</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>processasync</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>function to process result rows via async callback, return a new result in the callback, the function is: function(req, rows, callback),
the callback is function(err, rows)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>syncMode</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>skip columns preprocessing and dynamic values for pool sync and backup restore</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>logger_db</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>log results at the end with this level or <code>debug</code> by default</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>logger_error</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>log errors with this level instead  of <code>error</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>logger_error</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>a log level to report about the errors, default is 'error', if an object it can specify different log levels by err.code, * is default level for not matched codes</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ignore_error</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>
|

<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>clear errors occurred as it never happen, do not report in the log, if an array then only matched codes will be cleared</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noprocessrows</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if true then skip post processing result rows, return the data as is, this will result in returning combined columns as it is</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>noconvertrows</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if true skip converting the data from the database format into Javascript data types, it uses column definitions</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>nopreparerow</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if true skip row preparation and columns processing, the req.obj is passed as is, useful for syncing between pools
for the table to convert values returned from the db into the the format defined by the column</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>total</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if true then it is supposed to return only one record with property <code>count</code>, skip all post processing and convertion</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>info_obj</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>to return the record just processed in the info object as <code>obj</code> property, it will include all generated and updated columns</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>result_obj</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>to return the query record as result including all post processing and new generated columns, this is not what <code>returning</code> property does, it only
returns the query record with new columns from memory</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>keep_req</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>on return do not clear out the request object, by default all properties are deleted to free up memory</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>keep_obj</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>only preserve op, obj, table properties in the reqest after return</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cached</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if true then run getCached version directly</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>nocache</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>disable caching even if configured for the table</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>ops</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>operators to use for comparison for properties, an object with column name and operator.
Common operators are, some databases may support other specific ops:</p>
<pre class="prettyprint source lang->,"><code>between, match, regexp, iregexp, begins_with, not_begins_with, ends_with, not_ends_with,
like, like%, ilike%, contains, not_contains```</code></pre></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>opsMap</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>operator mapping between supplied operators and actual operators supported by the db</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>typesMap</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>type mapping between supplied and actual column types, an object</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>select</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>a list of columns or expressions to return or all columns if not specified, only existing columns will be returned</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>select_all</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>a list of columns or expressions to return, passed as is to the underlying driver</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>start</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>
|

<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>start records with this primary key, this is the next_token passed by the previous query</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>count</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>how many records to return</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>first</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>a convenient option to return the first record from the result or null (similar to <code>db.get</code> method)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>last</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>similar to first but return last record</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>join</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>how to join condition expressions, default is AND</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>joinOps</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>operators to use to combine several expressions in case when an array of values is given, supports `and|or|AND|OR``</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>sort</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>sort by this column. if null then no sorting must be done at all, records will be returned in the order they are kept in the DB.
<em>NOTE: For DynamoDB this may affect the results if columns requsted are not projected in the index, with sort
<code>select</code> property might be used to get all required properties. For Elasticsearch if sort is null then scrolling scan will be used,
if no <code>timeout</code> or <code>scroll</code> are given the default is 1m.</em></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>sort_timeout</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>for pagination how long to keep internal state in millisecons, depends on the DB, for example for Elasticsearch it corresponds
to the scroll param and defaults to 60000 (1m)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>desc</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if sorting, do in descending order</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>page</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>starting page number for pagination, uses count to find actual record to start, for SQL databases mostly</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>unique</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>specified the column name to be used in determining unique records, if for some reasons there are multiple records in the location
table for the same id only one instance will be returned</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cacheKey</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>exlicit key for caching, return from the cache or from the DB and then cache it with this key, works the same as <code>get</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cacheKeyName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>a name of one of the cache keys to use, it must be defined by a <code>db-cache-keys-table-name</code> parameter</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>aliases</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>an object with mapping between artificial name to real column name, useful in or_$/and_$ conditions with same column but different values,
alternative is to append aliases with <em>$, like name</em>$ or name_$$, the name must be a valid column name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>custom_columns</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>an array of pairs to define global or artificial columns, the format is: [ RegExp, type, ...], useful with aliases</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>no_columns</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>do not check for actual columns defined in the pool tables and add all properties from the obj, only will work for NoSQL dbs,
by default all properties in the obj not described in the table definition for the given table will be ignored.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>skip_columns</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            

            

            <td class="description last"><p>ignore properties by name listed in the this array, the most use case is to skip autogeneratd columns like &quot;now&quot;</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>








    <h5 class="h5-types">Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>



        </li>
    </ul>






            
                

    

    <h4 class="name" id="~DBResultCallback"><span class="type-signature"></span>DBResultCallback<span class="signature">(err, rows, info)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>This callback is called by all DB methods</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>err</code></td>
            

            <td class="type">
            
                
<span class="param-type">Error</span>



            
            </td>

            

            

            <td class="description last"><p>and error object or null i fno errors</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>rows</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;object></span>



            
            </td>

            

            

            <td class="description last"><p>a list of result rows, in case of error it is an empty list</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>info</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>an object with information about the last query:</p>
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>inserted_oid</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>new generated ID</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>affected_rows</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>how many rows were affected by this operation</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>next_token</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>next to ken to pass for pagination</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>consumed_capacity</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>DynamoDB specific about capacity consumed</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>























            
                
<h4 class="name" id="~DBTable">DBTable</h4>





<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Database table object, each property represents a column</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>



    <h5 class="subsection-title">Properties:</h5>

    

<table class="props">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>name1</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBColumn</span>



            
            </td>

            

            

            <td class="description last"><p>column1</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>name2</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBColumn</span>



            
            </td>

            

            

            <td class="description last"><p>column2</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>...</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBColumn</span>



            
            </td>

            

            

            <td class="description last"><p>more columns</p></td>
        </tr>

    
    </tbody>
</table>






<div class="description usertext">
    <p>Database table object, each property represents a column</p>
</div>



    <h5 class="h5-types">Type:</h5>
    <ul>
        <li>
            
<span class="param-type">object</span>



        </li>
    </ul>






            
    
    
    

     

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="~args"><span class="type-signature type-signature-inner">(inner) </span>args<span class="type-signature"> :Array.&lt;ConfigOptions></span></h4>





<dl class="details">
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>







    <h5 class="h5-types">Type:</h5>
    <ul>
        <li>
            
<span class="param-type">Array.&lt;ConfigOptions></span>



        </li>
    </ul>






        
            
<h4 class="name" id="~bk_config"><span class="type-signature type-signature-inner, constant">(inner, constant) </span>bk_config<span class="type-signature"></span></h4>





<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Config table schema</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





<div class="description usertext">
    <p>Config table schema</p>
</div>








        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    <h4 class="name" id=".aadd"><span class="type-signature type-signature-static">(static) </span>aadd<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.add</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data, info } = await db.aadd("bk_user", { id: '123', login: 'admin', name: 'test' })</code></pre>





        
            

    

    <h4 class="name" id=".abatch"><span class="type-signature type-signature-static">(static) </span>abatch<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.batch</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".abulk"><span class="type-signature type-signature-static">(static) </span>abulk<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.bulk</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".acopy"><span class="type-signature type-signature-static">(static) </span>acopy<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.copy</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".acreate"><span class="type-signature type-signature-static">(static) </span>acreate<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.create</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".add"><span class="type-signature type-signature-static">(static) </span>add<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Insert new object into the database
Note: SQL, DynamoDB drivers are fully atomic but other drivers may be subject to race conditions</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an actual record to be updated, primary key properties must be specified</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.add("bk_user", { id: '123', login: 'admin', name: 'test' }, (err, rows, info) => {
 });</code></pre>





        
            

    

    <h4 class="name" id=".adel"><span class="type-signature type-signature-static">(static) </span>adel<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.del</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, info } = db.adel("bk_user", { login: '123' });
console.log('deleted:', info.affected_rows);</code></pre>





        
            

    

    <h4 class="name" id=".adelAll"><span class="type-signature type-signature-static">(static) </span>adelAll<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.delAll</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".adrop"><span class="type-signature type-signature-static">(static) </span>adrop<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.drop</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".aget"><span class="type-signature type-signature-static">(static) </span>aget<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.get</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data } = await db.aget("bk_user", { login: '12345' });</code></pre>





        
            

    

    <h4 class="name" id=".aincr"><span class="type-signature type-signature-static">(static) </span>aincr<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.incr</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data, info } = await db.aincr("bk_counter", { id: '123', like0: 1, invite0: 1 })</code></pre>





        
            

    

    <h4 class="name" id=".ajoin"><span class="type-signature type-signature-static">(static) </span>ajoin<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.join</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".alist"><span class="type-signature type-signature-static">(static) </span>alist<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.list</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data } = db.alist("bk_user", ["id1", "id2"]);
console.log(data);</code></pre>





        
            

    

    <h4 class="name" id=".applyPoolOptions"><span class="type-signature type-signature-static">(static) </span>applyPoolOptions<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Apply a config parameter to live DB pool, used in config args <code>update</code> callback to make a config value live</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".aput"><span class="type-signature type-signature-static">(static) </span>aput<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.put</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data } = await db.aput("bk_user", { id: '123', login: 'test', name: 'test' })</code></pre>





        
            

    

    <h4 class="name" id=".aquery"><span class="type-signature type-signature-static">(static) </span>aquery<span class="signature">(req, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"> &rarr; {Promise}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of <a href="module-db.html#.query">module:db.query</a> with the same parameters,
no exceptions are raised or reject, only resolve is called with an object <code>{ err, data, info }</code></p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>req</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequest</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>
















<h5 class="h5-returns">Returns:</h5>

        


<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Promise</span>



    </dd>
</dl>

    




    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data } = await db.aquery({ text: "SELECT ....." }, { pool: "sqlite" });</code></pre>





        
            

    

    <h4 class="name" id=".ascan"><span class="type-signature type-signature-static">(static) </span>ascan<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.scan</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".asearch"><span class="type-signature type-signature-static">(static) </span>asearch<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.search</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".aselect"><span class="type-signature type-signature-static">(static) </span>aselect<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.select</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data } = await db.aselect("bk_user", { type: 'admin' });</code></pre>





        
            

    

    <h4 class="name" id=".asql"><span class="type-signature type-signature-static">(static) </span>asql<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.sql</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".atransaction"><span class="type-signature type-signature-static">(static) </span>atransaction<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.transaction</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".aupdate"><span class="type-signature type-signature-static">(static) </span>aupdate<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.update</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>const { err, data, info } = await db.aupdate("bk_user", { login: 'test', name: 'Test')
 if (!err &amp;&amp; !info?.affected_rows) logger.error("no updates")</code></pre>





        
            

    

    <h4 class="name" id=".aupdateAll"><span class="type-signature type-signature-static">(static) </span>aupdateAll<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.updateAll</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".aupgrade"><span class="type-signature type-signature-static">(static) </span>aupgrade<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Async version of db.upgrade</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".batch"><span class="type-signature type-signature-static">(static) </span>batch<span class="signature">(list`)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Perform a batch of operations at the same time, all operations for the same table will be run
together one by one but different tables will be updated in parallel.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        
        <th>Default</th>
        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>list`</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>an array of objects to get/put/delete from the database in the format:</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.op</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            
                <td class="default">
                
                    <code>add</code>
                
                </td>
            

            <td class="description last"><p>is one of get, add, incr, put, update, del</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.table</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>which table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.obj</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>an object with data</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.options</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>params for the operation, optional</p>
<ul>
<li>options can have the following:</li>
</ul></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.concurrency</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>number of how many operations to run at the same time, 1 means sequential</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.no_errors</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>will stop on first error, because operations will be run in parallel some operations still may be performed</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.factorCapacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            
                <td class="default">
                
                </td>
            

            <td class="description last"><p>a capacity factor to apply to the write capacity if present, by default it is used write capacity at 100%</p>
<p>On return the second arg to the callback is a list of records with errors as the input record with added property <code>errstatus</code> and <code>errmsg</code>,
for get ops the result will be retrieved record if exists.</p>
<p>One advantage using this with <code>op: get</code> over <a href="module-db.html#.list">module:db.list</a> is caching,
<a href="module-db.html#.get">module:db.get</a> may use both local and remote caches but db.list always hits the database.</p></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>var ops = [ { table: "bk_counter", obj: { id:1, like:1 } },
             { op: "put", table: "bk_user", obj: { login: "test", id:1, name:"test" }]
 db.batch(ops, { factorCapacity: 0.5 }, lib.log);</code></pre>





        
            

    

    <h4 class="name" id=".bulk"><span class="type-signature type-signature-static">(static) </span>bulk<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Bulk operations, it will be noop if the driver does not support it.
The input format is the same as for the <code>db.batch</code> method.</p>
<p>On return the second arg to the callback is a list of records with errors, same input record with added property <code>errstatus</code> and <code>errmsg</code></p>
<p>NOTE: DynamoDB only supports add/put/del only and 25 at a time, if more specified it will send multiple batches</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>var ops = [ { table: "bk_counter", obj: { id:1, like:1 } },
            { op: "del", table: "bk_user", obj: { login: "test1" } },
            { op: "incr", table: "bk_counter", obj: { id:2, like:1 } },
            { table: "bk_user", obj: { login: "test2", id:2, name:"test2" } }]
db.bulk(ops, { pool: "elasticsearch" }, lib.log);</code></pre>





        
            

    

    <h4 class="name" id=".cacheColumns"><span class="type-signature type-signature-static">(static) </span>cacheColumns<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Reload all columns into the cache for the pool, options can be a pool name or an object like <code>{ pool: name }</code>.
if <code>tables</code> property is an arary it asks to refresh only specified tables if that is possible.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".configTypes"><span class="type-signature type-signature-static">(static) </span>configTypes<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build a list of all config types we want to retrieve, based on the <code>db-config-map</code> parameters that defines which fields to use for config types.</p>
<ul>
<li>for each <code>top</code> item it create a mix of all main items below</li>
<li>for each <code>main</code> item it creates a mix of all `other`` items</li>
</ul>
<p>top... -&gt; each of top-main... -&gt; each of top-main-other...</p>
<p>Most common config parameters: runMode, appName, role, roles, tag, region</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>top is runMode(prod), main is role(shell),tag(local), other is region(none)
 - prod
 - prod-shell
 - prod-shell-none
 - prod-local
 - prod-local-none</code></pre>





        
            

    

    <h4 class="name" id=".convertError"><span class="type-signature type-signature-static">(static) </span>convertError<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Convert native database error in some generic human readable string</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".convertRows"><span class="type-signature type-signature-static">(static) </span>convertRows<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Convert rows returned by the database into the Javascript format or into the format
defined by the table columns.
The following special properties in the column definition chnage the format:</p>
<ul>
<li>
<p>type = json - if a column type is json and the value is a string returned will be converted into a Javascript object</p>
</li>
<li>
<p>dflt property is defined for a json type and record does not have a value it will be set to specified default value</p>
</li>
<li>
<p>list - split the value into an array, optional .separator property can be specified</p>
</li>
<li>
<p>unjoin - a true value or a list of names, it produces new properties by splitting the value by a separator and assigning pieces to
separate properties using names from the list, this is the opposite of the <code>join</code> property and is used separately if
splitting is required, if joined properties already in the record then no need to split it. If not a list
the names are used form the join property.</p>
<p>Example:
db.describeTables([ { user: { id: {}, name: {}, pair: { join: [&quot;left&quot;,&quot;right&quot;], unjoin: 1 } } ]);</p>
<pre><code>      db.put(&quot;test&quot;, { id: &quot;1&quot;, type: &quot;user&quot;, name: &quot;Test&quot;, left: &quot;123&quot;, right: &quot;000&quot; })
      db.select(&quot;test&quot;, {}, lib.log)
</code></pre>
</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".copy"><span class="type-signature type-signature-static">(static) </span>copy<span class="signature">(table, query, options<span class="signature-attributes">opt</span>, callback<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Copy records from one table to another between different DB pools or regions
Returns stats how many copied or errors</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>name of the table to copy</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>a query condition for the table</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>sort</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>index to use for query</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>minCapacity</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>capacity minimum for read/writes, it will override actual DB capacity</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>factorCapacity</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>factor the actual capacity for reads/writes</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>stopOnError</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>stop the copy on first DB error, otherwise ignore errors</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>region</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>other region where to copy</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>sourcePool</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>original pool, default if not provided</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>pool</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>other DB pool</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>file</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            

            

            <td class="description last"><p>dump the data into a file as JSON</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>preprocess</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>a function(table, row, options) to be called before the update, if it returns true the record will be skipped</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>posprocess</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            

            

            <td class="description last"><p>a function(table, row, options, next) to be called after the record is copied, for recursive or joined cases</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>reget</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if set the actual record will read using db.get, for cases when db.scan returns only partial record as in DynamoDB cases with indexes</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>incremental</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if set, try to read the latest record in the other table and continue from there, uses <code>sort</code> index in desc order</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>batch</code></td>
            

            <td class="type">
            
                
<span class="param-type">int</span>



            
            </td>

            

            

            <td class="description last"><p>a number of records to copy at once using the bulk operation</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>syncMode</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            

            

            <td class="description last"><p>if set enabled the update mode in which all values are preserved and not pre-processed, default is 1</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>queryOptions</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>pass options to scan operations</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>updateOptions</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>pass options to update/bulk operations</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBResultCallback</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>























        
            

    

    <h4 class="name" id=".create"><span class="type-signature type-signature-static">(static) </span>create<span class="signature">(table, schema, options<span class="signature-attributes">opt</span>, callback)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Create a table using column definitions represented as a list of objects. Each column definition may
contain the following properties:</p>
<p>Some properties may be defined multiple times with number suffixes like: <code>unique1, unique2, index1, index2</code> to create more than one index for the table, same
properties define a composite key in the order of definition or sorted by the property value, for example: <code>{ a: { index:2 }, b: { index:1 } }</code> will create index (b,a)
because of the <code>index:</code> property value being not the same. If all index properties are set to 1 then a composite index will use the order of the properties.*</p>
<p>NOTE: Index creation is not required and all index properties can be omitted, it can be done more effectively using native tools for any specific database,
this format is for simple and common use cases without using any other tools but it does not cover all possible variations for every database. But all indexes and
primary keys created outside of the backend application will be detected properly by <a href="module-db.html#.cacheColumns">module:db.cacheColumns</a> and by each pool <code>cacheIndexes</code> methods.</p>
<p>Each database pool also can support native options that are passed directly to the driver in the options, these properties are
defined in the object with the same name as the db driver, all properties are combined, for example to define provisioned throughput for the DynamoDB index:</p>
<p>DynmamoDB:</p>
<p>To create a DynamoDB table with global secondary index, the first index property if not the same as primary key hash defines global index, if it is the same then local,
or if the second key column contains <code>global</code> property then it is a global index as well, below we create global secondary index on property 'name' only,
in the example above it was local secondary index for id and name. Also a local secondary index is created on <code>id,title</code>.</p>
<p>DynamoDB projection is defined by a <code>projections</code> property, can be a number/boolean or an array with index numbers for regular columns
but the hash property can provide its own projections for whole index at once, can be ALL or a list of attributes.</p>
<p>When using real DynamoDB creating a table may take some time, for such cases if <code>options.waitTimeout</code> is not specified it defaults to 1min,
so the callback is called as soon as the table is active or after the timeout whichever comes first.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table name</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>schema</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBTable</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an object with table schema</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBConfigOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>options for the database driver</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>response handler</p></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.create("test_table", {
     id: { primary: 1, type: "int", index: 1, custom: { dynamodb: { readCapacity: 50, writeCapacity: 50 } } },
     type: { primary: 2, pub: 1, projections: 1 },
     name: { index: 1, pub: 1 } }
 });

 db.create("test_table", {
     id: { primary: 1, type: "int", index1: 1 },
     type: { primary: 2, projections: [0] },
     name: { index: 1, projections: 1 },
     title: { index1: 1, projections: [1] } },
     descr: { index: 2, projections: [0, 1] },
 });</code></pre>





        
            

    

    <h4 class="name" id=".createTables"><span class="type-signature type-signature-static">(static) </span>createTables<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Create or upgrade the tables for the given pool</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".del"><span class="type-signature type-signature-static">(static) </span>del<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Delete an object in the database, no error if the object does not exist</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>object with column values</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.del("bk_user", { login: '123' }, (err, rows, info) => {
    console.log('deleted:', info.affected_rows);
 });</code></pre>





        
            

    

    <h4 class="name" id=".delAll"><span class="type-signature type-signature-static">(static) </span>delAll<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Delete all records that match given condition, one by one, the input is the same as for <code>db.select</code> and every record
returned will be deleted using <code>db.del</code> call. The callback will receive on completion the err and all rows found and deleted.
Special properties that can be in the options for this call:</p>
<ul>
<li>ops - query operations to retrieve records to be deleted</li>
<li>count - how many matching records to delete</li>
<li>delScan - if true force to use db.scan instead of native <code>delAll</code> for the given pool</li>
<li>delOptions - options to be passed to the db.del if needed, this is useful so select and del options will not be mixed up</li>
<li>delCollect - if true return all deleted rows in the callback, oherwise just the number of rows deleted</li>
<li>factorCapacity - write capqcity factor for delete operations, default is 0.35</li>
<li>concurrency - how many delete requests to execute at the same time by using lib.forEachLimit.</li>
<li>ignore_error - continue deleting records even after an error</li>
<li>delProcess - a function callback that will be called for each row before deleting it, this is for some transformations of the record properties
in case of complex columns that may contain concatenated values as in the case of using DynamoDB. The callback will be called
as <code>options.delProcess(row, options, info)</code>. If it returns non-empty value the scan will stop and return it as the error.</li>
<li>delFilter - a function that must return something to the callback in order to skip the current record. <code>options.delFilter(row, options, (skip) =&gt; {})</code></li>
<li>batch - delete using bulk operations, all functions must accept an array of rows instead</li>
</ul>
<p>If no <code>options.select</code> is specified only the primary keys will be returned or collected</p>
<p>If <code>db-skip-drop</code> matches the table name and there is no query provided it will exit with error</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".describeTables"><span class="type-signature type-signature-static">(static) </span>describeTables<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Define new tables or extend/customize existing tables. Table definitions are used with every database operation,
on startup, the backend read all existing table columns from the database and cache them in the memory but some properties
like public columns are only specific to the backend so to mark such columns the table with such properties must be described
using this method. Only columns with changed properties need to be specified, other columns will be left as it is.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.describeTables({
             bk_user: { name: { pub: 1 },
                        test: { id: { primary: 1, type: "int" },
                        name: { pub: 1, index: 1 }
         }});</code></pre>





        
            

    

    <h4 class="name" id=".drop"><span class="type-signature type-signature-static">(static) </span>drop<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Drop a table</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".dropTables"><span class="type-signature type-signature-static">(static) </span>dropTables<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Delete all specified tables from the specific pool or all active pools if <code>options.pool</code> is empty, <code>tables</code> can be a list of tables or an
object with table definitions</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".get"><span class="type-signature type-signature-static">(static) </span>get<span class="signature">(table, query, options<span class="signature-attributes">opt</span>, callback)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Retrieve one record from the database by primary key, returns found record or null if not found</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to read</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an object with primary key(s)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBResultCallback</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>NOTE: On return the <code>info.cached</code> will be set to</p>
<ul>
<li>1 if retrieved from top level cache</li>
<li>2 if retrieved from level 2 cache</li>
<li>0 if retrieved from db and put in the cache</li>
</ul></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.get("bk_user", { login: '12345' }, function(err, row) {
   if (row) console.log(row.name);
});</code></pre>





        
            

    

    <h4 class="name" id=".getCached"><span class="type-signature type-signature-static">(static) </span>getCached<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Retrieve cached result or put a record into the cache prefixed with table:key[:key...]
Options accept the same parameters as for the usual get action but it is very important that all the options
be the same for every call, especially <code>select</code> parameters which tells which columns to retrieve and cache.
Additional options:</p>
<ul>
<li>prefix - prefix to be used for the key instead of table name</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.getCached("get", "bk_user", { login: req.query.login }, { select: "latitude,longitude" }, function(err, row) {
     var distance = lib.geoDistance(req.query.latitude, req.query.longitude, row.latitude, row.longitudde);
 });</code></pre>





        
            

    

    <h4 class="name" id=".getConfig"><span class="type-signature type-signature-static">(static) </span>getConfig<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return all config records for the given instance, the result will be sorted most relevant at the top</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".getPool"><span class="type-signature type-signature-static">(static) </span>getPool<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return database pool by name or default pool, options can be a pool name or an object with { pool: name } to return
the pool by given name. This call always returns a valid pool object, in case no requested pool found, it returns
the default pool, in case of invalid pool name it returns <code>none</code> pool.
A special pool <code>none</code> always returns empty result and no errors.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".getPoolTables"><span class="type-signature type-signature-static">(static) </span>getPoolTables<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return all tables know to the given pool, returned tables are in the object with
column information merged from cached columns from the database with description columns
given by the application. If <code>options.names</code> is 1 then return just table names as a list.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".getPools"><span class="type-signature type-signature-static">(static) </span>getPools<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return a list of all active database pools, returns list of objects with name: and type: properties</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".getProcessRows"><span class="type-signature type-signature-static">(static) </span>getProcessRows<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Returns a list of hooks to be used for processing rows for the given table</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".incr"><span class="type-signature type-signature-static">(static) </span>incr<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Counter operation, increase or decrease column values, similar to update but all specified columns except primary
key will be incremented, use negative value to decrease the value.
If no <code>options.updateOps</code> object specified or no 'incr' operations are provided then
all columns with type 'counter' will be used for the action <code>incr</code></p>
<p><em>Note: The record must exist already for SQL databases, for DynamoDB and Cassandra a new record will be created
if does not exist yet.</em> To disable upsert pass <code>noupsert</code> in the options.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an actual record to be updated, primary key properties must be specified</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.incr("bk_counter", { id: '123', like0: 1, invite0: 1 }, (err, rows, info) => {
  });</code></pre>





        
            

    

    <h4 class="name" id=".init"><span class="type-signature type-signature-static">(static) </span>init<span class="signature">(callback)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Initialize all database pools. the options may containt the following properties:</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options.createTables</code></td>
            

            <td class="type">
            
                
<span class="param-type">boolean</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>if true then create new tables or upgrade tables with new columns</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>























        
            

    

    <h4 class="name" id=".initColumns"><span class="type-signature type-signature-static">(static) </span>initColumns<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Merge cached columns into tables</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".initConfig"><span class="type-signature type-signature-static">(static) </span>initConfig<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Load configuration from the config database, must be configured with <code>db-config</code> pointing to the database pool where bk_config table contains
configuration parameters.</p>
<p>The priority of the parameters goes from the most broad to the most specific, most specific always wins, this allows
for very flexible configuration policies defined by the app or place where instances running and separated by the run mode.
See `db.getConfigTypes`` for more details.</p>
<p>The options takes the following properties:</p>
<ul>
<li>force - if true then force to refresh and reopen all db pools</li>
<li>table - a table where to read the config parameters, default is bk_config</li>
</ul>
<p>Do not create/upgrade tables and indexes when reloading the config, this is to
avoid situations when maintenance is being done and any process reloading the config may
create indexes/columns which are not missing but being provisioned or changed.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".initTables"><span class="type-signature type-signature-static">(static) </span>initTables<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Merge all tables from all modules</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".join"><span class="type-signature type-signature-static">(static) </span>join<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Join the given list of records with the records from other table by primary key.
The properties from the joined table will be merged with the original rows preserving the existing properties</p>
<ul>
<li>options.keys defines custom primary key to use instead of table's primary key</li>
<li>options.keysMap - an object that defines which property should be used for a key in the given rows, this is
for cases when actual primary keys in the table are different from the rows properties.</li>
<li>options.columnsMap - save properties with a different name using this mapping object</li>
<li>options.existing is 1 then return only joined records.</li>
<li>options.override - joined table properties will replace the original table existing properties</li>
<li>options.attach - specifies a property name which will be used to attach joined record to the original record, no merging will occur, for
non-existing records an empty object will be attached</li>
<li>options.incr can be a list of property names that need to be summed up with each other, not overriden</li>
<li>options.nomerge - do not merge lists, just return new rows as is</li>
</ul>
<p>A special case when table is empty <code>db.join</code> just returns same rows to the callback, this is
for convenience of doing joins on some conditions and trigger it by setting the table name or skip the join completely.</p>
<p>Example:</p>
<pre><code>     db.join(&quot;bk_user&quot;, [{id:&quot;123&quot;,key1:1},{id:&quot;234&quot;,key1:2}], lib.log)
     db.join(&quot;bk_user&quot;, [{aid:&quot;123&quot;,key1:1},{aid:&quot;234&quot;,key1:2}], { keysMap: { id: &quot;aid&quot; }}, lib.log)
     db.join(&quot;bk_user&quot;, [{id:&quot;123&quot;,state:&quot;NY&quot;},{id:&quot;234&quot;,state:&quot;VA&quot;}], { columnsMap: { state: &quot;astate&quot; }}, lib.log)
</code></pre></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".list"><span class="type-signature type-signature-static">(static) </span>list<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Convenient helper to retrieve all records by primary key, the obj must be a list with key property or a string with list of primary key column</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>
|

<span class="param-type">Array.&lt;object></span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>list of records</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.list("bk_user", ["id1", "id2"], (err, rows) => { console.log(err, rows) });
 db.list("bk_user", "id1,id2", (err, rows) => { console.log(err, rows) });</code></pre>





        
            

    

    <h4 class="name" id=".prepare"><span class="type-signature type-signature-static">(static) </span>prepare<span class="signature">()</span><span class="type-signature"> &rarr; {DBRequest}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Prepare for execution for the given operation: add, del, put, update,...
Returns prepared object to be passed to the driver's .query method.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>

























<h5 class="h5-returns">Returns:</h5>

        
<div class="param-desc">
    <ul>
<li>a request object</li>
</ul>
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">DBRequest</span>



    </dd>
</dl>

    







        
            

    

    <h4 class="name" id=".prepareColumn"><span class="type-signature type-signature-static">(static) </span>prepareColumn<span class="signature">()</span><span class="type-signature"> &rarr; {object}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Prepare a column for an operation, convert aliases, types and ops according to the request and pool mapping</p>
<p>The op in the name after _$ takes precedence over the options.ops</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>

























<h5 class="h5-returns">Returns:</h5>

        
<div class="param-desc">
    <ul>
<li>an object with final column details: { name, type, op, value, join }</li>
</ul>
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">object</span>



    </dd>
</dl>

    




    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>{ name_$contains: "cat" } // means use the `contains` op for the column `name`</code></pre>





        
            

    

    <h4 class="name" id=".prepareReq"><span class="type-signature type-signature-static">(static) </span>prepareReq<span class="signature">()</span><span class="type-signature"> &rarr; {DBRequest}</span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Prepare a DB request object with required properties</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>

























<h5 class="h5-returns">Returns:</h5>

        
<div class="param-desc">
    <ul>
<li>a request object</li>
</ul>
</div>



<dl class="param-type">
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">DBRequest</span>



    </dd>
</dl>

    







        
            

    

    <h4 class="name" id=".prepareRow"><span class="type-signature type-signature-static">(static) </span>prepareRow<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Preprocess an object for a given operation, convert types, assign defaults...</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".put"><span class="type-signature type-signature-static">(static) </span>put<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Add/update an object in the database, if object already exists it will be replaced with all new properties from the obj</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an actual record to be updated, primary key properties must be specified</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.put("bk_user", { id: '123', login: 'test', name: 'test' }, function(err, rows, info) {
 });</code></pre>





        
            

    

    <h4 class="name" id=".query"><span class="type-signature type-signature-static">(static) </span>query<span class="signature">(req, options<span class="signature-attributes">opt</span>, callback<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Execute query using native database driver, the query is passed directly to the driver.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>req</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequest</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an object with request required data</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>optional properties customizations</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBResultCallback</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>an error or result</p></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.query({ text: "SELECT a.id,c.type FROM bk_user a,bk_icon c WHERE a.id=c.id and a.id=?", values: ['123'] }, { pool: 'pg' }, (err, rows, info) => {
    ...
});</code></pre>





        
            

    

    <h4 class="name" id=".queryProcessSync"><span class="type-signature type-signature-static">(static) </span>queryProcessSync<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Post process hook to be used for replicating records to another pool, this is supposed to be used as this:</p>
<p>The conditions when to use it is up to the application logic.</p>
<p>It does not deal with the destination pool to be overloaded, all errors will be ignored, this is for simple and light load only</p>
<p>The destination poll must have tables to be synced configured:</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db-elasticsearch-pool-tables=table1,table2
db.setProcessRow("post", "*", (req, row) => { db.queryProcessSync("elasticsearch", req, row) });</code></pre>





        
            

    

    <h4 class="name" id=".refreshColumns"><span class="type-signature type-signature-static">(static) </span>refreshColumns<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Refresh columns for all pools which need it</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".runProcessRows"><span class="type-signature type-signature-static">(static) </span>runProcessRows<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Run registered pre- or post- process callbacks.</p>
<ul>
<li><code>type</code> is one of the <code>pre</code> or 'post`</li>
<li><code>table</code> - the table to run the hooks for, usually the same as req.table but can be '*' for global hooks</li>
<li><code>req</code> is the original db request object with the following required properties: <code>op, table, obj, options, info</code>,</li>
<li><code>rows</code> is the result rows for post callbacks and the same request object for pre callbacks.</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".scan"><span class="type-signature type-signature-static">(static) </span>scan<span class="signature">(rowCallback, endCallback<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Convenient helper for scanning a table for some processing, rows are retrieved in batches and passed to the callback until there are no more
records matching given criteria. The obj is the same as passed to the <code>db.select</code> method which defined a condition which records to get.
The rowCallback must be present and is called for every row or batch retrieved and second parameter which is the function to be called
once the processing is complete. At the end, the callback will be called just with 1 argument, err, this indicates end of scan operation.
Basically, db.scan is the same as db.select but can be used to retrieve large number of records in batches and allows async processing of such records.
To hint a driver that scanning is in progress the <code>options.scanning</code> will be set to true.</p>
<p>Parameters:</p>
<ul>
<li>table - table to scan</li>
<li>query - an object with query conditions, same as in <code>db.select</code></li>
<li>options - same as in <code>db.select</code>, with the following additions:</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options.count</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>size of every batch, default is 100</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.limit</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>total number of records to scan</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.start</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>the primary key to start the scan from</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.search</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>use search instead of select, for ElasticSearch,...</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.batch</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>if true rowCallback will be called with all rows from the batch, not every row individually, batch size is defined by the count property</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.sync</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>as batch mode but the rowCallback is called synchronously as <code>rowCallback(row, info)</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.concurrency</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>how many rows to process at the same time, if not given process sequentially</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.noscan</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>if 1 no scan will be performed if no primary keys are specified</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.emptyscan</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>if 0 no empty scan will be performed when no table columns in the query to be used as a filter</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.fullscan</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>if 1 force to scan full table without using any primary key conditons, use all query properties for all records (DynamoDB)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.useCapacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>triggers to use specific capacity, default is <code>read</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.factorCapacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>a factor to apply for the read capacity limit and triggers the capacity check usage, default is <code>0.9</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.tableCapacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>use a different table for capacity throttling instead of the <code>table</code>, useful for cases when the row callback performs
writes into that other table and capacity is different</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.capacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>a full capacity object to pass to select calls</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>rowCallback</code></td>
            

            <td class="type">
            
                
<span class="param-type">function</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>process records when called like this `callback(rows, next, info)</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>endCallback</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBResultCallback</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>end of scan when called like this: `callback(err)</p></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>// Copy all users from one db into another
  db.scan("bk_user", {}, { count: 10, pool: "dynamodb" }, (row, next) => {
     db.add("bk_user", row, { pool: "pg" }, next);
  }, (err) => { });</code></pre>





        
            

    

    <h4 class="name" id=".search"><span class="type-signature type-signature-static">(static) </span>search<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Perform full text search on the given table, the database implementation may ignore table name completely
in case of global text index.</p>
<p>Query in general is a text string with the format that is supported by the underlying driver,
the db module <em>DOES NOT PARSE</em> the query at all if the driver supports full text search, otherwise it behaves like <code>select</code>.</p>
<p>Options make take the same properties as in the <code>select</code> method.</p>
<p>A special query property <code>q</code> may be used for generic search in all fields.</p>
<p>Without full text search support in the driver this may return nothing or an error.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.search("bk_user", { type: "admin", q: "john*" }, { pool: "elasticsearch" }, lib.log);
 db.search("bk_user", "john*", { pool: "elasticsearch" }, lib.log);
 await db.asearch("bk_user", "john*", { pool: "elasticsearch" });</code></pre>





        
            

    

    <h4 class="name" id=".select"><span class="type-signature type-signature-static">(static) </span>select<span class="signature">(table, query, options<span class="signature-attributes">opt</span>, callback)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Select objects from the database that match supplied conditions.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to read</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an object with properties for the condition, all matching records will be returned.
Columns may contain deep property path can be used as well, like <code>prop.subprop</code>,
the top level column must be defined to work, this is for DBs that support JSON objects like DymamoDB, Elasticsearch.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>callback</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBResultCallback</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>// get by primary key

db.select("bk_message", { id: '123' }, { count: 2 }, (err, rows) => {  });

// async version
const rows = await db.aselect("bk_message", { id: '123' }, { count: 2 });

// get all icons with type greater or equal to 2

db.select("bk_icon", { id: '123', type: '2' }, { select: 'id,type', ops: { type: 'ge' } }, (err, rows) => { });

// get unread msgs sorted by time, recent first

db.select("bk_message", { id: '123', status: 'N:' }, { sort: "status", desc: 1, ops: { status: "begins_with" } }, (err, rows) => { });

// scan users with custom filter, not by primary key: by exact zipcode

db.select("bk_user", { zipcode: '20000' }, (err, rows) => { });

// select users by type for the last day

db.select("bk_user", { type: 'admin', mtime: Date.now()-86400000 }, { ops: { type: "contains", mtime: "gt" } }, (err, rows) => { });

// select users by JSON sub property using Elasticsearch

db.select("bk_user", { "settings.status": "ok" }, { pool: "elasticsearch" }, (err, rows) => { });</code></pre>





        
            

    

    <h4 class="name" id=".setConfig"><span class="type-signature type-signature-static">(static) </span>setConfig<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Update and create a DB config record for the given name/type, updates the last record only</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".setProcessColumns"><span class="type-signature type-signature-static">(static) </span>setProcessColumns<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Add a callback to be called after each cache columns event, it will be called for each pool separately.
The callback to be called may take options argument and it is called in the context of the pool.</p>
<p>The primary goal for this hook is to allow management of the existing tables which are not own by the
backendjs application. For such tables, because we have not created them, we need to define column properties
after the fact and to keep column definitions in the app for such cases is not realistic. This callback will
allow to handle such situations and can be used to set necessary propeties to the table columns.</p>
<p>Example, a few public columns, allow an admin to see all the columns</p>
<pre><code>    db.setProcessColumns(function() {
        var cols = db.getColumns(&quot;users&quot;, { pool: this.name });
        for (var p in  cols) {
            if ([&quot;id&quot;,&quot;name&quot;].indexOf(p) &gt; -1) cols[p].pub = 1; else cols[p].admin = 1;
        }
    })
</code></pre></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".setProcessRow"><span class="type-signature type-signature-static">(static) </span>setProcessRow<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Assign a processRow callback for a table, this callback will be called for every row on every result being retrieved from the
specified table thus providing an opportunity to customize the result.</p>
<p>type defines at what time the callback will be called:</p>
<ul>
<li><code>pre</code> - making a request to the db on the query record</li>
<li><code>post</code> - after the request finished to be called on the result rows</li>
</ul>
<p>All assigned callback to this table will be called in the order of the assignment.</p>
<p>The callback accepts 2 arguments: function(req, row)
where:</p>
<ul>
<li><code>req</code> - the original request for a db operation with required
<ul>
<li><code>op</code> - current db operation, like add, put, ....</li>
<li><code>table</code> -  current table being updated</li>
<li><code>obj</code> - the record with data</li>
<li><code>pool</code> - current request db pool name</li>
<li><code>options</code> - current request db options</li>
<li><code>info</code> - an object returned with special properties like affected_rows, next_token, only passed to the <code>post</code> callbacks</li>
</ul>
</li>
<li><code>row</code> - a row from the result</li>
</ul>
<p>When producing complex properties by combining other properties it needs to be synchronized using both pre and post
callbacks to keep the record consistent.</p>
<p><strong>For queries returning rows, if the callback returns true for a row it will be filtered out and not included in the final result set.</strong></p>
<p>Example</p>
<pre><code> db.setProcessRow(&quot;post&quot;, &quot;bk_user&quot;, (req, row) =&gt; {
     if (row.birthday) row.age = Math.floor((Date.now() - lib.toDate(row.birthday))/(86400000*365));
 });

 db.setProcessRow(&quot;post&quot;, &quot;icons&quot;, (req, row) =&gt; {
     if (row.type == &quot;private&quot; &amp;&amp; row.id != req.options.user.id) return true;
 });
</code></pre></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sql"><span class="type-signature type-signature-static">(static) </span>sql<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Execute arbitrary SQL-like statement if the pool supports it, values must be an Array with query parameters or can be omitted.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>





























    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.sql("SELECT * FROM bk_property WHERE value=? LIMIT 1", [1], { pool: "sqlite", count: 10 }, lib.log)
 db.sql("SELECT * FROM bk_property", { pool: "dynamodb" }, lib.log)
 db.sql("SELECT * FROM bk_property", { pool: "dynamodb", count: 10 }, lib.log)</code></pre>





        
            

    

    <h4 class="name" id=".sqlCacheColumns"><span class="type-signature type-signature-static">(static) </span>sqlCacheColumns<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Cache columns using the information_schema</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlColumn"><span class="type-signature type-signature-static">(static) </span>sqlColumn<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return properly quoted column name if it is a keyword</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlCreate"><span class="type-signature type-signature-static">(static) </span>sqlCreate<span class="signature">(pool, req)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Create SQL table using table definition</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>pool</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            

            

            <td class="description last"><p>database pool</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>req</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequest</span>



            
            </td>

            

            

            <td class="description last"><p>request object</p></td>
        </tr>

    
    </tbody>
</table>























        
            

    

    <h4 class="name" id=".sqlDelete"><span class="type-signature type-signature-static">(static) </span>sqlDelete<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL statement for delete</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlDrop"><span class="type-signature type-signature-static">(static) </span>sqlDrop<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Create SQL DROP TABLE statement</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlExpr"><span class="type-signature type-signature-static">(static) </span>sqlExpr<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL expressions for the column and value
options may contain the following properties:</p>
<ul>
<li>op - SQL operator, default is =</li>
<li>type - can be data, string, number, float, expr, default is string</li>
<li>value - default value to use if passed value is null or empty</li>
<li>min, max - are used for numeric values for validation of ranges</li>
<li>expr - for op=expr, contains sprintf-like formatted expression to be used as is with all '%s' substituted with actual value</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlGet"><span class="type-signature type-signature-static">(static) </span>sqlGet<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Get one object from the database,
options may define the following properties:</p>
<ul>
<li>select is list of columns or expressions to return</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlInsert"><span class="type-signature type-signature-static">(static) </span>sqlInsert<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL insert statement</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlLimit"><span class="type-signature type-signature-static">(static) </span>sqlLimit<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL orderby/limit/offset conditions, config can define defaults for sorting and paging</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlPrepare"><span class="type-signature type-signature-static">(static) </span>sqlPrepare<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Prepare SQL statement for the given operation</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlQuery"><span class="type-signature type-signature-static">(static) </span>sqlQuery<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Execute a SQL statements</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlQuote"><span class="type-signature type-signature-static">(static) </span>sqlQuote<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Quote value to be used in SQL expressions</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlSelect"><span class="type-signature type-signature-static">(static) </span>sqlSelect<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Select object from the database,
options may define the following properties:</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>req.options.select</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>is list of columns or expressions to return</p></td>
        </tr>

    
    </tbody>
</table>























        
            

    

    <h4 class="name" id=".sqlTime"><span class="type-signature type-signature-static">(static) </span>sqlTime<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return time formatted for SQL usage as ISO, if no date specified returns current time</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlUpgrade"><span class="type-signature type-signature-static">(static) </span>sqlUpgrade<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Create ALTER TABLE ADD COLUMN statements for missing columns</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlUpgrade"><span class="type-signature type-signature-static">(static) </span>sqlUpgrade<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL statement for update</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlValue"><span class="type-signature type-signature-static">(static) </span>sqlValue<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return properly quoted value to be used directly in SQL expressions, format according to the type</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlValueIn"><span class="type-signature type-signature-static">(static) </span>sqlValueIn<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Return list in format to be used with SQL IN ()</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".sqlWhere"><span class="type-signature type-signature-static">(static) </span>sqlWhere<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Build SQL where condition from the keys and object values, returns SQL statement to be used in WHERE</p>
<ul>
<li>query - properties for the condition, in case of an array the primary keys for IN condition will be used only,
a property named or$ or and$ will be treated as a sub-expression if it is an object. Add a number if need multiple OR/AND conditions like
or$$, or$$,...</li>
<li>options may contains the following properties:
<ul>
<li>pool - pool to be used for driver specific functions</li>
<li>ops - an object for comparison operators for primary key, default is equal operator</li>
<li>aliases - an object with column aliases, for cases when more than one time the same column mut be used</li>
</ul>
</li>
<li>join - how to join all expressions, default is AND</li>
</ul></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".transaction"><span class="type-signature type-signature-static">(static) </span>transaction<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Same as the <code>db.bulk</code> but in transaction mode, all operations must succeed or fail. Not every driver can support it,
in DynamoDB case only 10 operations can be done at the same time, if the list is larger then it will be sequentially run with batches of 25 records.</p>
<p>In case of error the second arg will contain the records of the failed batch</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
            

    

    <h4 class="name" id=".update"><span class="type-signature type-signature-static">(static) </span>update<span class="signature">(table, query, options<span class="signature-attributes">opt</span>)</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Update existing object in the database.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>table</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>table to use</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>query</code></td>
            

            <td class="type">
            
                
<span class="param-type">object</span>



            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>an actual record to be updated, primary key properties must be specified</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options</code></td>
            

            <td class="type">
            
                
<span class="param-type">DBRequestOptions</span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last">
                <h6>Properties</h6>
                

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>ops</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>object for comparison operators for primary key, default is equal operator</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>opsMap</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>operator mapping into supported by the database</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>typesMap</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>type mapping for properties to be used in the condition</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>aliases</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>an object to map column aliases in the query in case the same column is used ultiple times</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>expected</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>an object with the condition for the update, it is used in addition to the primary keys condition from the <code>obj</code>,
a property named $or/$and will be treated as a sub-expression if it is an object. For multiple OR/AND use
$$or, $$$or,...</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>expectedJoin</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>how to join expected expressions: OR, AND, default is AND</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>upsert</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>create a new record if it does not exist</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>syncMode</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>skip columns preprocessing and dynamic values for pool sync and backup restore</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>updateOps</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>an object with column names and operations to be performed on the named column</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>incr</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>increment by given value</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>add</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>add an item to the list</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>del</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>remove an item from the list</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>set</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>to update as it is, for reseting counters forexample</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>concat</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>concatenate given value, for strings if the database supports it</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>append</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>append to the list of values, only for lists if the database supports it</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>prepend</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>insert at the beginning of the list, depends on the database</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>not_exists</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>only update if not exists or null</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>typesOps</code></td>
            

            <td class="type">
            
            </td>

            

            

            <td class="description last"><p>an object that defines updateOps operation by column type, for example <code>typesOps: { list: &quot;add&quot; }</code> will
make sure all lists will have updateOps set as add if not specified explicitly</p></td>
        </tr>

    
    </tbody>
</table>

            </td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>db.update("bk_user", { login: 'test', id: '123' }, (err, rows, info) => {
   console.log('updated:', info.affected_rows);
 });

 db.update("bk_user", { login: 'test', id: '123', first_name: 'Mr' }, { pool: pg' }, (err, rows, info) => {
    console.log('updated:', info.affected_rows);
 });

 db.update("bk_user", { login: 'test', first_name: 'John' }, { expected: { first_name: "Carl" } }, (err, rows, info) => {
    console.log('updated:', info.affected_rows);
 });

 db.update("bk_user", { login: 'test', first_name: 'John' }, { expected: { or$: { first_name: "Carl", g1: null }, aliases: { g1: "first_name" } }, (err, rows, info) => {
    console.log('updated:', info.affected_rows);
 });</code></pre>





        
            

    

    <h4 class="name" id=".updateAll"><span class="type-signature type-signature-static">(static) </span>updateAll<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Update all records that match given condition in the <code>query</code>, one by one, the input is the same as for <code>db.select</code> and every record
returned will be updated using <code>db.update</code> call by the primary key, so make sure options.select include the primary key for every row found by the select.</p>
<p>All properties from the <code>obj</code> will be set in every matched record.</p>
<p>The callback will receive on completion the err and all rows found and updated. This is mostly for non-SQL databases and for very large range it may take a long time
to finish due to sequential update every record one by one.
Special properties that can be in the options for this call:</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>











    <h5 class="h5-parameters">Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        
        <th>Attributes</th>
        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>options.select</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;string></span>



            
            </td>

            
                <td class="attributes">
                
                    &lt;optional><br>
                

                

                
                </td>
            

            

            <td class="description last"><p>select columns, if not specified only the primary keys will be returned or collected</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.updateOptions</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>options to be passed to the db.update if needed, this is useful so select and update options will not be mixed up</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.updateCollect</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>if true return all updated rows in the callback otherwise just the number of updated rows</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.factorCapacity</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>write capacity factor for update operations, default is 0.25</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.op</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>by default it uses db.update but the <code>op</code> can be set to <code>put</code> or <code>add</code></p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.updateProcess</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>a function callback that will be called for each row before updating it, this is for some transformations of the record properties
in case of complex columns that may contain concatenated values as in the case of using DynamoDB. The callback will be called
as <code>options.updateProcess(row, options)</code>. If it returns non-empty value the update will stop and return it as the error.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>options.updateFilter</code></td>
            

            <td class="type">
            
            </td>

            
                <td class="attributes">
                

                

                
                </td>
            

            

            <td class="description last"><p>a function that must return something to the callback in order to skip the current record. <code>options.updateFilter(row, options, (skip) =&gt; {})</code></p></td>
        </tr>

    
    </tbody>
</table>




















    <h5 class="h5-examples">Example</h5>
    
    <pre class="prettyprint"><code>// update birthday format if not null

 db.updateAll("bk_user",
     { birthday: 1 },
     { mtime: Date.now() },
     { ops: { birthday: "not null" },
     updateProcess: function(r, o) {
        r.birthday = lib.strftime(new Date(r.birthday, "%Y-%m-D"));
     },
     updateFilter: function(r, o, cb) {
       cb(r.status == 'ok');
  } }, (err, count) => {
    console.log(count, "rows updated");
  });</code></pre>





        
            

    

    <h4 class="name" id=".upgrade"><span class="type-signature type-signature-static">(static) </span>upgrade<span class="signature">()</span><span class="type-signature"></span></h4>

    




<dl class="details">
    
    <dt class="tag-description">Description:</dt>
    <dd class="tag-description"><ul class="dummy"><li><p>Upgrade a table with missing columns from the definition list, if after the upgrade new columns must be re-read from the database
then <code>info.affected_rows</code> must be non zero.</p></li></ul></dd>
    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    

    
</dl>
































        
    

    
</article>

</section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.5</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>